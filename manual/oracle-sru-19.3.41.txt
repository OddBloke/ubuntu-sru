#!/bin/bash
# Manual Oracle upgrade and clean install validation

SRU_SERIES="xenial bionic"  # no disco or eoan images yet on oracle cloud

# local values
LP_USER="chad.smith"

cat > sethostname.yaml << EOF
## template: jinja
#cloud-config
ssh_import_id : [$LP_USER]
hostname: SRU-worked-{{v1.cloud_name}}
EOF

cat > setup_proposed.sh <<EOF
#/bin/bash
mirror=http://archive.ubuntu.com/ubuntu
echo deb \$mirror \$(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init
EOF

sshopts=( -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR )
for series in $SRU_SERIES; do
  echo "### BEGIN $series"
  if [ "$series" = "xenial" ]; then
    netcfg="/etc/network/interfaces.d/50-cloud-init.cfg"
  else
    netcfg="/etc/netplan/50-cloud-init.yaml"
  fi

  # TODO: Use the Oracle CLI
  echo "Please manually launch a $series instance in Oracle and enter its IP address"
  echo "(Don't forget to add your SSH public key to the instance when you launch it.)"
  read -p "$series IP address: " VM_IP

  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 5
  done

  # Capture current state
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cat /run/cloud-init/result.json
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- grep Trace /var/log/cloud-init.log
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg

  # Upgrade to -proposed cloud-init and reboot
  scp "${sshopts[@]}" setup_proposed.sh ubuntu@$VM_IP:.
  ssh "${sshopts[@]}" ubuntu@$VM_IP sudo bash ./setup_proposed.sh 2>&1 | egrep 'cloud-init'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo hostname SRU-didnt-work
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo rm -f $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cloud-init clean --logs --reboot
  ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R $VM_IP

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 1
  done

  ssh "${sshopts[@]}" ubuntu@$VM_IP -- hostname
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep Trace /var/log/cloud-init*"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'After upgrade Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init query --format "'cloud-region: {{cloud_name}}-{{region}}'"
  echo "Get cloud-id"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-id
  echo 'Validating whether metadata is being updated per boot LP:1819913'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo reboot || true

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 1
  done
  echo 'After reboot'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
done

echo "Don't forget to clean up your instances!"


### BEGIN SRU Verification logs xenial/bionic
root@publishing:~# ./oracle-sru-19.3.41.txt
### BEGIN xenial
Please manually launch a xenial instance in Oracle and enter its IP address
(Don't forget to add your SSH public key to the instance when you launch it.)
xenial IP address: 129.146.128.234

status: done
time: Wed, 11 Dec 2019 19:59:12 +0000
detail:
DataSourceOpenStack [net,ver=2]
cloud-init	19.2-36-g059d049c-0ubuntu2~16.04.1
{
 "v1": {
  "datasource": "DataSourceOpenStack [net,ver=2]",
  "errors": []
 }
}
### NOTICE: bbsw verified that these traces are known shortcomings in accessing non-existent meta-data routes becaues Oracle CPC images still set OpenStack as datasource_list: [OpenStack] in /etc/cloud/cloud.cfg.d/99*oracle.cfg
Failed fetching meta-data/ from url http://169.254.169.254/latest/meta-data/
CPC images will be dropping the hardcoded Openstack datasource_list in favor of Oracle which does not have these traces
### END NOTICE
Traceback (most recent call last):
Traceback (most recent call last):
Startup finished in 18.686s (kernel) + 25.305s (userspace) = 43.992s
         10.676s snapd.seeded.service
          6.551s cloud-init.service
          3.478s cloud-config.service
          1.840s apparmor.service
          1.781s cloud-init-local.service
          1.289s console-setup.service
          1.219s pollinate.service
          1.138s snapd.service
          1.007s dev-sda1.device
           569ms cloud-final.service
           490ms netfilter-persistent.service
           436ms accounts-daemon.service
           383ms lxd-containers.service
           352ms lvm2-monitor.service
           289ms grub-common.service
           258ms keyboard-setup.service
           214ms iscsid.service
           206ms irqbalance.service
           192ms apport.service
           187ms mdadm.service
           175ms systemd-udev-trigger.service
           162ms systemd-modules-load.service
           154ms polkitd.service
           151ms systemd-logind.service
           140ms systemd-timesyncd.service
           140ms rc-local.service
           127ms resolvconf.service
           121ms systemd-journald.service
           119ms networking.service
           105ms ufw.service
           103ms dev-hugepages.mount
           102ms kmod-static-nodes.service
            97ms rsyslog.service
            83ms run-rpc_pipefs.mount
            82ms systemd-tmpfiles-setup-dev.service
            80ms dev-mqueue.mount
            69ms systemd-udevd.service
            69ms systemd-remount-fs.service
            65ms systemd-tmpfiles-clean.service
            65ms systemd-journal-flush.service
            64ms systemd-tmpfiles-setup.service
            61ms systemd-machine-id-commit.service
            58ms open-iscsi.service
            57ms ondemand.service
            51ms systemd-sysctl.service
            51ms systemd-user-sessions.service
            50ms snap-core-8039.mount
            36ms snap-oracle\x2dcloud\x2dagent-5.mount
            33ms ssh.service
            30ms plymouth-read-write.service
            30ms nfs-config.service
            29ms systemd-update-utmp.service
            27ms systemd-random-seed.service
            25ms snapd.socket
            19ms user@1000.service
            18ms sys-fs-fuse-connections.mount
            17ms setvtrgb.service
            17ms systemd-update-utmp-runlevel.service
            17ms boot-efi.mount
            16ms sys-kernel-config.mount
            16ms sys-kernel-debug.mount
            15ms plymouth-quit.service
            15ms plymouth-quit-wait.service
            13ms lxd.socket
             8ms dev-loop0.device
             6ms iscsi-cleanup.service
             5ms dev-loop1.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00900s +00.00100s
|`->no local data found from DataSourceOpenStackLocal @00.03200s +00.12700s
Finished stage: (init-local) 00.22400 seconds

Starting stage: init-network
|`->no cache found @00.87000s +00.00000s
|`->found network data from DataSourceOpenStack @00.87700s +05.14000s
|`->setting up datasource @06.20300s +00.00000s
|`->reading and applying user-data @06.21600s +00.00800s
|`->reading and applying vendor-data @06.22400s +00.00000s
|`->activating datasource @06.25300s +00.00200s
|`->config-migrator ran successfully @06.27900s +00.00100s
|`->config-seed_random ran successfully @06.28000s +00.00100s
|`->config-bootcmd ran successfully @06.28100s +00.00000s
|`->config-write-files ran successfully @06.28200s +00.00000s
|`->config-growpart ran successfully @06.28300s +00.11500s
|`->config-resizefs ran successfully @06.39900s +00.07000s
|`->config-disk_setup ran successfully @06.47000s +00.00100s
|`->config-mounts ran successfully @06.47100s +00.03100s
|`->config-set_hostname ran successfully @06.50300s +00.00500s
|`->config-update_hostname ran successfully @06.50900s +00.00100s
|`->config-update_etc_hosts ran successfully @06.51000s +00.00200s
|`->config-ca-certs ran successfully @06.51200s +00.00100s
|`->config-rsyslog ran successfully @06.51300s +00.00100s
|`->config-users-groups ran successfully @06.51400s +00.13200s
|`->config-ssh ran successfully @06.64600s +00.21600s
Finished stage: (init-network) 06.00800 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @19.31800s +00.00800s
|`->config-snap ran successfully @19.32700s +00.00100s
|`->config-snap_config ran successfully @19.32900s +00.00100s
|`->config-ssh-import-id ran successfully @19.33000s +01.12700s
|`->config-locale ran successfully @20.45700s +01.02000s
|`->config-set-passwords ran successfully @21.47700s +00.00200s
|`->config-grub-dpkg ran successfully @21.47900s +00.25000s
|`->config-apt-pipelining ran successfully @21.73000s +00.00100s
|`->config-apt-configure ran successfully @21.73100s +00.10800s
|`->config-ubuntu-advantage ran successfully @21.84000s +00.00100s
|`->config-ntp ran successfully @21.84200s +00.00100s
|`->config-timezone ran successfully @21.84300s +00.00100s
|`->config-disable-ec2-metadata ran successfully @21.84400s +00.00000s
|`->config-runcmd ran successfully @21.84500s +00.00000s
|`->config-byobu ran successfully @21.84600s +00.00000s
Finished stage: (modules-config) 02.59800 seconds

Starting stage: modules-final
|`->config-snappy ran successfully @22.32000s +00.00100s
|`->config-package-update-upgrade-install ran successfully @22.32200s +00.00000s
|`->config-fan ran successfully @22.32300s +00.00100s
|`->config-landscape ran successfully @22.32400s +00.00000s
|`->config-lxd ran successfully @22.32500s +00.00000s
|`->config-ubuntu-drivers ran successfully @22.32600s +00.00000s
|`->config-puppet ran successfully @22.32700s +00.00000s
|`->config-chef ran successfully @22.32800s +00.00000s
|`->config-mcollective ran successfully @22.32900s +00.00000s
|`->config-salt-minion ran successfully @22.33000s +00.00000s
|`->config-rightscale_userdata ran successfully @22.33100s +00.00000s
|`->config-scripts-vendor ran successfully @22.33200s +00.00000s
|`->config-scripts-per-once ran successfully @22.33300s +00.00000s
|`->config-scripts-per-boot ran successfully @22.33300s +00.00100s
|`->config-scripts-per-instance ran successfully @22.33400s +00.00100s
|`->config-scripts-user ran successfully @22.33500s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @22.33600s +00.02300s
|`->config-keys-to-console ran successfully @22.35900s +00.05200s
|`->config-phone-home ran successfully @22.41100s +00.00100s
|`->config-final-message ran successfully @22.41300s +00.00500s
|`->config-power-state-change ran successfully @22.41800s +00.00100s
Finished stage: (modules-final) 00.13100 seconds

Total Time: 8.96100 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.14000s (init-network/search-OpenStack)
     01.12700s (modules-config/config-ssh-import-id)
     01.02000s (modules-config/config-locale)
     00.25000s (modules-config/config-grub-dpkg)
     00.21600s (init-network/config-ssh)
     00.13200s (init-network/config-users-groups)
     00.12700s (init-local/search-OpenStackLocal)
     00.11500s (init-network/config-growpart)
     00.10800s (modules-config/config-apt-configure)
     00.07000s (init-network/config-resizefs)
     00.05200s (modules-final/config-keys-to-console)
     00.03100s (init-network/config-mounts)
     00.02300s (modules-final/config-ssh-authkey-fingerprints)
     00.00800s (modules-config/config-emit_upstart)
     00.00800s (init-network/consume-user-data)
     00.00500s (modules-final/config-final-message)
     00.00500s (init-network/config-set_hostname)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (init-network/config-update_etc_hosts)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-snappy)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-scripts-per-boot)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-ubuntu-drivers)
     00.00000s (modules-final/config-scripts-vendor)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-salt-minion)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-final/config-puppet)
     00.00000s (modules-final/config-package-update-upgrade-install)
     00.00000s (modules-final/config-mcollective)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-final/config-chef)
     00.00000s (modules-config/config-runcmd)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (modules-config/config-byobu)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-write-files)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

# control-manual ens3
iface ens3 inet dhcp
    broadcast 10.0.0.255
    dns-nameservers 169.254.169.254
    gateway 10.0.0.1
setup_proposed.sh                             100%  194     3.3KB/s   00:00
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 19.3-41-gc4735dd3-0ubuntu1~16.04.1 [414 kB]
Preparing to unpack .../cloud-init_19.3-41-gc4735dd3-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (19.3-41-gc4735dd3-0ubuntu1~16.04.1) over (19.2-36-g059d049c-0ubuntu2~16.04.1) ...
Setting up cloud-init (19.3-41-gc4735dd3-0ubuntu1~16.04.1) ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
cloud-init	19.3-41-gc4735dd3-0ubuntu1~16.04.1
sudo: unable to resolve host SRU-didnt-work
sudo: unable to resolve host SRU-didnt-work
Connection to 129.146.128.234 closed by remote host.
Host 129.146.128.234 not found in /home/ubuntu/.ssh/known_hosts

status: done
time: Wed, 11 Dec 2019 20:18:54 +0000
detail:
DataSourceOpenStack [net,ver=2]
SRU-worked-openstack
### NOTICE: bbsw verified that these traces are known shortcomings in accessing non-existent meta-data routes becaues Oracle CPC images still set OpenStack as datasource_list: [OpenStack] in /etc/cloud/cloud.cfg.d/99*oracle.cfg
Failed fetching meta-data/ from url http://169.254.169.254/latest/meta-data/
CPC images will be dropping the hardcoded Openstack datasource_list in favor of Oracle which does not have these traces
### END NOTICE
/var/log/cloud-init.log:Traceback (most recent call last):
/var/log/cloud-init.log:Traceback (most recent call last):
Startup finished in 18.725s (kernel) + 15.499s (userspace) = 34.224s
          6.462s cloud-init.service
          2.717s cloud-config.service
          1.825s snapd.service
          1.595s dev-sda1.device
          1.255s cloud-init-local.service
           825ms cloud-final.service
           546ms lxd-containers.service
           515ms netfilter-persistent.service
           478ms accounts-daemon.service
           413ms apparmor.service
           375ms lvm2-monitor.service
           348ms ssh.service
           329ms keyboard-setup.service
           297ms console-setup.service
           267ms systemd-modules-load.service
           250ms dev-loop0.device
           233ms dev-loop1.device
           232ms systemd-timesyncd.service
           229ms irqbalance.service
           194ms mdadm.service
           186ms systemd-udev-trigger.service
           185ms grub-common.service
           180ms apport.service
           178ms systemd-logind.service
           168ms iscsid.service
           155ms ondemand.service
           150ms systemd-journald.service
           143ms rsyslog.service
           114ms networking.service
            91ms rc-local.service
            91ms systemd-udevd.service
            89ms run-rpc_pipefs.mount
            83ms resolvconf.service
            82ms snapd.seeded.service
            73ms polkitd.service
            72ms systemd-remount-fs.service
            66ms systemd-tmpfiles-setup-dev.service
            66ms open-iscsi.service
            61ms kmod-static-nodes.service
            49ms nfs-config.service
            49ms sys-kernel-debug.mount
            47ms plymouth-read-write.service
            46ms snap-oracle\x2dcloud\x2dagent-5.mount
            46ms systemd-journal-flush.service
            44ms snap-core-8039.mount
            37ms systemd-tmpfiles-setup.service
            37ms ufw.service
            37ms dev-hugepages.mount
            36ms systemd-update-utmp.service
            32ms dev-mqueue.mount
            28ms snapd.socket
            28ms systemd-sysctl.service
            26ms setvtrgb.service
            25ms systemd-random-seed.service
            24ms plymouth-quit.service
            20ms sys-fs-fuse-connections.mount
            19ms user@1000.service
            16ms systemd-update-utmp-runlevel.service
            14ms boot-efi.mount
            13ms sys-kernel-config.mount
            12ms systemd-user-sessions.service
            11ms iscsi-cleanup.service
            10ms lxd.socket
             8ms plymouth-quit-wait.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00600s +00.00000s
|`->no local data found from DataSourceOpenStackLocal @00.02000s +00.08900s
Finished stage: (init-local) 00.14800 seconds

Starting stage: init-network
|`->no cache found @00.67800s +00.00000s
|`->found network data from DataSourceOpenStack @00.68400s +05.10200s
|`->setting up datasource @05.91400s +00.00000s
|`->reading and applying user-data @05.93000s +00.00800s
|`->reading and applying vendor-data @05.93800s +00.00000s
|`->activating datasource @05.96800s +00.00100s
|`->config-migrator ran successfully @05.99400s +00.00000s
|`->config-seed_random ran successfully @05.99500s +00.00100s
|`->config-bootcmd ran successfully @05.99600s +00.00000s
|`->config-write-files ran successfully @05.99600s +00.00100s
|`->config-growpart ran successfully @05.99700s +00.07400s
|`->config-resizefs ran successfully @06.07200s +00.02200s
|`->config-disk_setup ran successfully @06.09400s +00.00300s
|`->config-mounts ran successfully @06.09700s +00.04900s
|`->config-set_hostname ran successfully @06.14700s +00.00600s
|`->config-update_hostname ran successfully @06.15300s +00.00200s
|`->config-update_etc_hosts ran successfully @06.15500s +00.00100s
|`->config-ca-certs ran successfully @06.15600s +00.00100s
|`->config-rsyslog ran successfully @06.15700s +00.00100s
|`->config-users-groups ran successfully @06.15800s +00.04100s
|`->config-ssh ran successfully @06.19900s +00.40400s
Finished stage: (init-network) 05.94100 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @09.94800s +00.00000s
|`->config-snap ran successfully @09.94900s +00.00100s
|`->config-snap_config ran successfully @09.95100s +00.00100s
|`->config-ssh-import-id ran successfully @09.95200s +01.09800s
|`->config-locale ran successfully @11.05200s +00.00500s
|`->config-set-passwords ran successfully @11.05800s +00.00400s
|`->config-grub-dpkg ran successfully @11.06300s +00.28400s
|`->config-apt-pipelining ran successfully @11.34800s +00.00100s
|`->config-apt-configure ran successfully @11.34900s +00.11400s
|`->config-ubuntu-advantage ran successfully @11.46400s +00.00200s
|`->config-ntp ran successfully @11.46600s +00.00100s
|`->config-timezone ran successfully @11.46800s +00.00100s
|`->config-disable-ec2-metadata ran successfully @11.46900s +00.00000s
|`->config-runcmd ran successfully @11.47000s +00.00000s
|`->config-byobu ran successfully @11.47000s +00.00100s
Finished stage: (modules-config) 01.59000 seconds

Starting stage: modules-final
|`->config-snappy ran successfully @12.10600s +00.00300s
|`->config-package-update-upgrade-install ran successfully @12.11000s +00.00500s
|`->config-fan ran successfully @12.11500s +00.00200s
|`->config-landscape ran successfully @12.11700s +00.00100s
|`->config-lxd ran successfully @12.11900s +00.00100s
|`->config-ubuntu-drivers ran successfully @12.12000s +00.00200s
|`->config-puppet ran successfully @12.12200s +00.01000s
|`->config-chef ran successfully @12.13300s +00.00100s
|`->config-mcollective ran successfully @12.13500s +00.00100s
|`->config-salt-minion ran successfully @12.13600s +00.00100s
|`->config-rightscale_userdata ran successfully @12.13800s +00.00100s
|`->config-scripts-vendor ran successfully @12.14000s +00.00100s
|`->config-scripts-per-once ran successfully @12.14100s +00.00100s
|`->config-scripts-per-boot ran successfully @12.14300s +00.00000s
|`->config-scripts-per-instance ran successfully @12.14400s +00.00100s
|`->config-scripts-user ran successfully @12.14600s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @12.14700s +00.03000s
|`->config-keys-to-console ran successfully @12.17700s +00.10700s
|`->config-phone-home ran successfully @12.28500s +00.00100s
|`->config-final-message ran successfully @12.28600s +00.00500s
|`->config-power-state-change ran successfully @12.29100s +00.00100s
Finished stage: (modules-final) 00.25500 seconds

Total Time: 7.93400 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.10200s (init-network/search-OpenStack)
     01.09800s (modules-config/config-ssh-import-id)
     00.40400s (init-network/config-ssh)
     00.28400s (modules-config/config-grub-dpkg)
     00.11400s (modules-config/config-apt-configure)
     00.10700s (modules-final/config-keys-to-console)
     00.08900s (init-local/search-OpenStackLocal)
     00.07400s (init-network/config-growpart)
     00.04900s (init-network/config-mounts)
     00.04100s (init-network/config-users-groups)
     00.03000s (modules-final/config-ssh-authkey-fingerprints)
     00.02200s (init-network/config-resizefs)
     00.01000s (modules-final/config-puppet)
     00.00800s (init-network/consume-user-data)
     00.00600s (init-network/config-set_hostname)
     00.00500s (modules-final/config-package-update-upgrade-install)
     00.00500s (modules-final/config-final-message)
     00.00500s (modules-config/config-locale)
     00.00400s (modules-config/config-set-passwords)
     00.00300s (modules-final/config-snappy)
     00.00300s (init-network/config-disk_setup)
     00.00200s (modules-final/config-ubuntu-drivers)
     00.00200s (modules-final/config-fan)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (init-network/config-update_hostname)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-config/config-runcmd)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

# control-manual ens3
iface ens3 inet dhcp
    broadcast 10.0.0.255
    dns-nameservers 169.254.169.254
    gateway 10.0.0.1
cloud-region: openstack-None
Get cloud-id
openstack
Validating whether metadata is being updated per boot LP:1819913
2019-12-11 20:18:42,035 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:18:42,700 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
Connection to 129.146.128.234 closed by remote host.

status: done
time: Wed, 11 Dec 2019 20:20:17 +0000
detail:
DataSourceOpenStack [net,ver=2]
After reboot
2019-12-11 20:18:42,035 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:18:42,700 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:20:07,415 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:20:08,117 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
### BEGIN bionic
Please manually launch a bionic instance in Oracle and enter its IP address
(Don't forget to add your SSH public key to the instance when you launch it.)
bionic IP address: 129.146.186.70

status: done
time: Wed, 11 Dec 2019 20:20:05 +0000
detail:
DataSourceOpenStack [net,ver=2]
cloud-init	19.2-36-g059d049c-0ubuntu2~18.04.1
{
 "v1": {
  "datasource": "DataSourceOpenStack [net,ver=2]",
  "errors": []
 }
}
Traceback (most recent call last):
Traceback (most recent call last):
Startup finished in 15.335s (kernel) + 27.838s (userspace) = 43.173s
graphical.target reached after 23.984s in userspace
         10.740s snapd.seeded.service
          7.565s cloud-init.service
          3.139s cloud-config.service
          1.598s cloud-init-local.service
          1.419s pollinate.service
          1.182s dev-sda1.device
          1.134s snapd.service
          1.091s apparmor.service
           722ms cloud-final.service
           682ms lxd-containers.service
           632ms networkd-dispatcher.service
           551ms iscsid.service
           488ms accounts-daemon.service
           473ms netfilter-persistent.service
           447ms grub-common.service
           389ms systemd-logind.service
           334ms keyboard-setup.service
           320ms systemd-udev-trigger.service
           273ms lvm2-monitor.service
           233ms systemd-journald.service
           222ms systemd-timesyncd.service
           212ms apport.service
           188ms polkit.service
           183ms ebtables.service
           164ms dev-hugepages.mount
           164ms run-rpc_pipefs.mount
           162ms kmod-static-nodes.service
           162ms dev-mqueue.mount
           161ms systemd-resolved.service
           159ms systemd-modules-load.service
           158ms systemd-remount-fs.service
           142ms sys-kernel-debug.mount
           128ms rsyslog.service
           107ms systemd-udevd.service
           106ms systemd-tmpfiles-setup-dev.service
            96ms systemd-sysctl.service
            81ms systemd-tmpfiles-setup.service
            73ms nfs-config.service
            72ms rpcbind.service
            71ms iscsi-cleanup.service
            68ms blk-availability.service
            68ms systemd-machine-id-commit.service
            66ms ufw.service
            58ms systemd-journal-flush.service
            53ms plymouth-read-write.service
            53ms console-setup.service
            53ms systemd-networkd.service
            53ms ssh.service
            40ms systemd-user-sessions.service
            37ms lxd.socket
            36ms user@1001.service
            33ms snapd.socket
            33ms snap-oracle\x2dcloud\x2dagent-5.mount
            32ms plymouth-quit.service
            28ms systemd-update-utmp.service
            24ms snap-core-8039.mount
            24ms sys-fs-fuse-connections.mount
            23ms sys-kernel-config.mount
            19ms dev-loop0.device
            18ms setvtrgb.service
            17ms systemd-random-seed.service
            16ms boot-efi.mount
            15ms systemd-networkd-wait-online.service
            14ms systemd-update-utmp-runlevel.service
            11ms plymouth-quit-wait.service
             1ms dev-loop1.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
|`->no local data found from DataSourceOpenStackLocal @00.03800s +00.10800s
Finished stage: (init-local) 00.34000 seconds

Starting stage: init-network
|`->no cache found @01.01700s +00.00000s
|`->found network data from DataSourceOpenStack @01.03900s +05.11000s
|`->setting up datasource @06.46600s +00.00000s
|`->reading and applying user-data @06.48100s +00.00900s
|`->reading and applying vendor-data @06.49000s +00.00000s
|`->activating datasource @06.51700s +00.00100s
|`->config-migrator ran successfully @06.54300s +00.00000s
|`->config-seed_random ran successfully @06.54300s +00.00100s
|`->config-bootcmd ran successfully @06.54500s +00.00000s
|`->config-write-files ran successfully @06.54500s +00.00100s
|`->config-growpart ran successfully @06.54600s +00.19400s
|`->config-resizefs ran successfully @06.74100s +00.56400s
|`->config-disk_setup ran successfully @07.30500s +00.00200s
|`->config-mounts ran successfully @07.30700s +00.04200s
|`->config-set_hostname ran successfully @07.34900s +00.00700s
|`->config-update_hostname ran successfully @07.35600s +00.00100s
|`->config-update_etc_hosts ran successfully @07.35800s +00.00100s
|`->config-ca-certs ran successfully @07.35900s +00.00100s
|`->config-rsyslog ran successfully @07.36000s +00.00100s
|`->config-users-groups ran successfully @07.36100s +00.18500s
|`->config-ssh ran successfully @07.54600s +00.43200s
Finished stage: (init-network) 06.97800 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @21.34400s +00.00100s
|`->config-snap ran successfully @21.34500s +00.00200s
|`->config-snap_config ran successfully @21.34700s +00.00100s
|`->config-ssh-import-id ran successfully @21.34900s +01.24700s
|`->config-locale ran successfully @22.59700s +00.00200s
|`->config-set-passwords ran successfully @22.59900s +00.00100s
|`->config-grub-dpkg ran successfully @22.60100s +00.34100s
|`->config-apt-pipelining ran successfully @22.94300s +00.00100s
|`->config-apt-configure ran successfully @22.94400s +00.10700s
|`->config-ubuntu-advantage ran successfully @23.05200s +00.00200s
|`->config-ntp ran successfully @23.05400s +00.00300s
|`->config-timezone ran successfully @23.05800s +00.00100s
|`->config-disable-ec2-metadata ran successfully @23.05900s +00.00000s
|`->config-runcmd ran successfully @23.06000s +00.00100s
|`->config-byobu ran successfully @23.06100s +00.00100s
Finished stage: (modules-config) 01.78400 seconds

Starting stage: modules-final
|`->config-snappy ran successfully @23.67200s +00.00100s
|`->config-package-update-upgrade-install ran successfully @23.67400s +00.00000s
|`->config-fan ran successfully @23.67500s +00.00000s
|`->config-landscape ran successfully @23.67600s +00.00000s
|`->config-lxd ran successfully @23.67600s +00.00100s
|`->config-ubuntu-drivers ran successfully @23.67700s +00.00100s
|`->config-puppet ran successfully @23.67800s +00.00100s
|`->config-chef ran successfully @23.67900s +00.00100s
|`->config-mcollective ran successfully @23.68000s +00.00000s
|`->config-salt-minion ran successfully @23.68100s +00.00000s
|`->config-rightscale_userdata ran successfully @23.68200s +00.00000s
|`->config-scripts-vendor ran successfully @23.68200s +00.00100s
|`->config-scripts-per-once ran successfully @23.68300s +00.00100s
|`->config-scripts-per-boot ran successfully @23.68400s +00.00000s
|`->config-scripts-per-instance ran successfully @23.68400s +00.00100s
|`->config-scripts-user ran successfully @23.68500s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @23.68600s +00.01700s
|`->config-keys-to-console ran successfully @23.70400s +00.07700s
|`->config-phone-home ran successfully @23.78200s +00.00100s
|`->config-final-message ran successfully @23.78300s +00.00600s
|`->config-power-state-change ran successfully @23.78900s +00.00100s
Finished stage: (modules-final) 00.15000 seconds

Total Time: 9.25200 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.11000s (init-network/search-OpenStack)
     01.24700s (modules-config/config-ssh-import-id)
     00.56400s (init-network/config-resizefs)
     00.43200s (init-network/config-ssh)
     00.34100s (modules-config/config-grub-dpkg)
     00.19400s (init-network/config-growpart)
     00.18500s (init-network/config-users-groups)
     00.10800s (init-local/search-OpenStackLocal)
     00.10700s (modules-config/config-apt-configure)
     00.07700s (modules-final/config-keys-to-console)
     00.04200s (init-network/config-mounts)
     00.01700s (modules-final/config-ssh-authkey-fingerprints)
     00.00900s (init-network/consume-user-data)
     00.00700s (init-network/config-set_hostname)
     00.00600s (modules-final/config-final-message)
     00.00300s (modules-config/config-ntp)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-snap)
     00.00200s (modules-config/config-locale)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-snappy)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-salt-minion)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-final/config-package-update-upgrade-install)
     00.00000s (modules-final/config-mcollective)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-final/config-fan)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        ens3:
            dhcp4: true
            match:
                macaddress: 02:00:17:05:c2:7e
            set-name: ens3
setup_proposed.sh                             100%  194     3.4KB/s   00:00
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 19.3-41-gc4735dd3-0ubuntu1~18.04.1 [411 kB]
Preparing to unpack .../cloud-init_19.3-41-gc4735dd3-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (19.3-41-gc4735dd3-0ubuntu1~18.04.1) over (19.2-36-g059d049c-0ubuntu2~18.04.1) ...
Setting up cloud-init (19.3-41-gc4735dd3-0ubuntu1~18.04.1) ...
cloud-init	19.3-41-gc4735dd3-0ubuntu1~18.04.1
Connection to 129.146.186.70 closed by remote host.
Host 129.146.186.70 not found in /home/ubuntu/.ssh/known_hosts

status: done
time: Wed, 11 Dec 2019 20:22:30 +0000
detail:
DataSourceOpenStack [net,ver=2]
SRU-worked-openstack
/var/log/cloud-init.log:Traceback (most recent call last):
/var/log/cloud-init.log:Traceback (most recent call last):
Startup finished in 15.521s (kernel) + 18.642s (userspace) = 34.163s
graphical.target reached after 13.864s in userspace
          6.771s cloud-init.service
          3.807s cloud-config.service
          1.881s snapd.service
          1.874s cloud-init-local.service
          1.829s dev-sda1.device
           978ms cloud-final.service
           746ms networkd-dispatcher.service
           601ms lxd-containers.service
           458ms apparmor.service
           450ms keyboard-setup.service
           436ms netfilter-persistent.service
           399ms dev-loop0.device
           385ms accounts-daemon.service
           364ms dev-loop1.device
           331ms iscsid.service
           309ms grub-common.service
           290ms systemd-timesyncd.service
           279ms systemd-modules-load.service
           273ms systemd-udev-trigger.service
           253ms apport.service
           237ms ssh.service
           231ms lvm2-monitor.service
           213ms systemd-logind.service
           212ms systemd-journald.service
           211ms systemd-journal-flush.service
           183ms snapd.socket
           151ms rsyslog.service
           146ms polkit.service
           144ms systemd-udevd.service
           141ms systemd-resolved.service
           138ms run-rpc_pipefs.mount
           109ms ebtables.service
           105ms systemd-remount-fs.service
           105ms ufw.service
           101ms snapd.seeded.service
            95ms sys-kernel-debug.mount
            95ms dev-mqueue.mount
            79ms systemd-tmpfiles-setup.service
            69ms systemd-sysctl.service
            68ms kmod-static-nodes.service
            67ms blk-availability.service
            64ms iscsi-cleanup.service
            64ms dev-hugepages.mount
            63ms systemd-tmpfiles-setup-dev.service
            57ms rpcbind.service
            57ms systemd-networkd.service
            56ms snap-core-8039.mount
            46ms sys-fs-fuse-connections.mount
            40ms user@1001.service
            40ms systemd-user-sessions.service
            40ms snap-oracle\x2dcloud\x2dagent-5.mount
            38ms sys-kernel-config.mount
            36ms plymouth-read-write.service
            36ms console-setup.service
            34ms nfs-config.service
            27ms systemd-update-utmp-runlevel.service
            27ms systemd-update-utmp.service
            25ms plymouth-quit-wait.service
            22ms lxd.socket
            21ms plymouth-quit.service
            21ms setvtrgb.service
            21ms systemd-networkd-wait-online.service
            18ms boot-efi.mount
            11ms systemd-random-seed.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00400s +00.00000s
|`->no local data found from DataSourceOpenStackLocal @00.03600s +00.27900s
Finished stage: (init-local) 00.59900 seconds

Starting stage: init-network
|`->no cache found @01.27300s +00.00000s
|`->found network data from DataSourceOpenStack @01.29400s +05.14100s
|`->setting up datasource @06.80100s +00.00000s
|`->reading and applying user-data @06.81600s +00.00900s
|`->reading and applying vendor-data @06.82500s +00.00000s
|`->activating datasource @06.85200s +00.00100s
|`->config-migrator ran successfully @06.87700s +00.00100s
|`->config-seed_random ran successfully @06.87800s +00.00100s
|`->config-bootcmd ran successfully @06.87900s +00.00000s
|`->config-write-files ran successfully @06.87900s +00.00100s
|`->config-growpart ran successfully @06.88000s +00.11300s
|`->config-resizefs ran successfully @06.99300s +00.04100s
|`->config-disk_setup ran successfully @07.03500s +00.00200s
|`->config-mounts ran successfully @07.03700s +00.05100s
|`->config-set_hostname ran successfully @07.08800s +00.00700s
|`->config-update_hostname ran successfully @07.09600s +00.00100s
|`->config-update_etc_hosts ran successfully @07.09700s +00.00100s
|`->config-ca-certs ran successfully @07.09800s +00.00100s
|`->config-rsyslog ran successfully @07.09900s +00.00000s
|`->config-users-groups ran successfully @07.10000s +00.04100s
|`->config-ssh ran successfully @07.14100s +00.26500s
Finished stage: (init-network) 06.15000 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @11.09900s +00.00000s
|`->config-snap ran successfully @11.09900s +00.00200s
|`->config-snap_config ran successfully @11.10100s +00.00100s
|`->config-ssh-import-id ran successfully @11.10300s +01.50300s
|`->config-locale ran successfully @12.60700s +00.00400s
|`->config-set-passwords ran successfully @12.61200s +00.00600s
|`->config-grub-dpkg ran successfully @12.61900s +00.50900s
|`->config-apt-pipelining ran successfully @13.13100s +00.00300s
|`->config-apt-configure ran successfully @13.13500s +00.46200s
|`->config-ubuntu-advantage ran successfully @13.59900s +00.00200s
|`->config-ntp ran successfully @13.60200s +00.00100s
|`->config-timezone ran successfully @13.60300s +00.00100s
|`->config-disable-ec2-metadata ran successfully @13.60500s +00.00100s
|`->config-runcmd ran successfully @13.60600s +00.00100s
|`->config-byobu ran successfully @13.60700s +00.00100s
Finished stage: (modules-config) 02.56300 seconds

Starting stage: modules-final
|`->config-snappy ran successfully @14.42300s +00.00300s
|`->config-package-update-upgrade-install ran successfully @14.42600s +00.00100s
|`->config-fan ran successfully @14.42700s +00.00200s
|`->config-landscape ran successfully @14.42900s +00.00100s
|`->config-lxd ran successfully @14.43000s +00.00200s
|`->config-ubuntu-drivers ran successfully @14.43200s +00.00100s
|`->config-puppet ran successfully @14.43400s +00.00100s
|`->config-chef ran successfully @14.43500s +00.00100s
|`->config-mcollective ran successfully @14.43700s +00.00100s
|`->config-salt-minion ran successfully @14.43800s +00.00100s
|`->config-rightscale_userdata ran successfully @14.44000s +00.00100s
|`->config-scripts-vendor ran successfully @14.44100s +00.00100s
|`->config-scripts-per-once ran successfully @14.44300s +00.00100s
|`->config-scripts-per-boot ran successfully @14.44400s +00.00100s
|`->config-scripts-per-instance ran successfully @14.44500s +00.00100s
|`->config-scripts-user ran successfully @14.44700s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @14.44800s +00.02100s
|`->config-keys-to-console ran successfully @14.46900s +00.05500s
|`->config-phone-home ran successfully @14.52500s +00.00200s
|`->config-final-message ran successfully @14.52800s +00.01200s
|`->config-power-state-change ran successfully @14.54100s +00.00200s
Finished stage: (modules-final) 00.16800 seconds

Total Time: 9.48000 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.14100s (init-network/search-OpenStack)
     01.50300s (modules-config/config-ssh-import-id)
     00.50900s (modules-config/config-grub-dpkg)
     00.46200s (modules-config/config-apt-configure)
     00.27900s (init-local/search-OpenStackLocal)
     00.26500s (init-network/config-ssh)
     00.11300s (init-network/config-growpart)
     00.05500s (modules-final/config-keys-to-console)
     00.05100s (init-network/config-mounts)
     00.04100s (init-network/config-users-groups)
     00.04100s (init-network/config-resizefs)
     00.02100s (modules-final/config-ssh-authkey-fingerprints)
     00.01200s (modules-final/config-final-message)
     00.00900s (init-network/consume-user-data)
     00.00700s (init-network/config-set_hostname)
     00.00600s (modules-config/config-set-passwords)
     00.00400s (modules-config/config-locale)
     00.00300s (modules-final/config-snappy)
     00.00300s (modules-config/config-apt-pipelining)
     00.00200s (modules-final/config-power-state-change)
     00.00200s (modules-final/config-phone-home)
     00.00200s (modules-final/config-lxd)
     00.00200s (modules-final/config-fan)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-snap)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-scripts-per-boot)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-disable-ec2-metadata)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-rsyslog)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        ens3:
            dhcp4: true
            match:
                macaddress: 02:00:17:05:c2:7e
            set-name: ens3
cloud-region: openstack-None
Get cloud-id
openstack
Validating whether metadata is being updated per boot LP:1819913
2019-12-11 20:22:16,367 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:22:17,626 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
Connection to 129.146.186.70 closed by remote host.

status: done
time: Wed, 11 Dec 2019 20:24:03 +0000
detail:
DataSourceOpenStack [net,ver=2]
After reboot
2019-12-11 20:22:16,367 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:22:17,626 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:23:51,670 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-12-11 20:23:52,740 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot

### END SRU Verification logs xenial/bionic
