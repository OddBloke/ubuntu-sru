# Manual Oracle upgrade and clean install validation

SRU_SERIES="xenial bionic"

# local values
LP_USER="daniel-thewatkins"

cat > sethostname.yaml << EOF
## template: jinja
#cloud-config
ssh_import_id : [$LP_USER]
hostname: SRU-worked-{{v1.cloud_name}}
EOF

cat > setup_proposed.sh <<EOF
#/bin/bash
mirror=http://archive.ubuntu.com/ubuntu
echo deb \$mirror \$(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init
EOF

sshopts=( -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR )
for series in $SRU_SERIES; do
  echo "### BEGIN $series"
  if [ "$series" = "xenial" ]; then
    netcfg="/etc/network/interfaces.d/50-cloud-init.cfg"
  else
    netcfg="/etc/netplan/50-cloud-init.yaml"
  fi

  # TODO: Use the Oracle CLI
  echo "Please manually launch a $series instance in Oracle and enter its IP address"
  echo "(Don't forget to add your SSH public key to the instance when you launch it.)"
  read -p "$series IP address: " VM_IP

  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 5
  done

  # Capture current state
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cat /run/cloud-init/result.json
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- grep Trace /var/log/cloud-init.log
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg

  # Upgrade to -proposed cloud-init and reboot
  scp "${sshopts[@]}" setup_proposed.sh ubuntu@$VM_IP:.
  ssh "${sshopts[@]}" ubuntu@$VM_IP sudo bash ./setup_proposed.sh 2>&1 | egrep 'cloud-init'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo hostname SRU-didnt-work
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo rm -f $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cloud-init clean --logs --reboot
  ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R $VM_IP

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 1
  done

  ssh "${sshopts[@]}" ubuntu@$VM_IP -- hostname
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep Trace /var/log/cloud-init*"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'After upgrade Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init query --format "'cloud-region: {{cloud_name}}-{{region}}'"
  echo "Get cloud-id"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-id
  echo 'Validating whether metadata is being updated per boot LP:1819913'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo reboot || true

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 1
  done
  echo 'After reboot'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
done

echo "Don't forget to clean up your instances!"

=== Verification Log ===

### BEGIN xenial
Please manually launch a xenial instance in Oracle and enter its IP address
(Don't forget to add your SSH public key to the instance when you launch it.)
xenial IP address: 129.146.184.243

status: done
time: Fri, 24 Jan 2020 21:15:02 +0000
detail:
DataSourceOpenStack [net,ver=2]
cloud-init	19.3-41-gc4735dd3-0ubuntu1~16.04.1
{
 "v1": {
  "datasource": "DataSourceOpenStack [net,ver=2]",
  "errors": []
 }
}

# ANNOTATION: These tracebacks are expected on Oracle using the OpenStack
# datasource.

Traceback (most recent call last):
Traceback (most recent call last):
Startup finished in 18.849s (kernel) + 26.447s (userspace) = 45.296s
         11.130s snapd.seeded.service
          6.653s cloud-init.service
          3.736s cloud-config.service
          1.686s cloud-init-local.service
          1.300s apparmor.service
          1.154s snapd.service
          1.130s pollinate.service
          1.071s dev-sda1.device
           633ms cloud-final.service
           550ms netfilter-persistent.service
           526ms lxd-containers.service
           467ms accounts-daemon.service
           408ms lvm2-monitor.service
           349ms iscsid.service
           263ms systemd-timesyncd.service
           256ms grub-common.service
           231ms console-setup.service
           229ms systemd-logind.service
           213ms rc-local.service
           209ms irqbalance.service
           205ms ondemand.service
           178ms polkitd.service
           178ms systemd-modules-load.service
           161ms systemd-journald.service
           149ms mdadm.service
           149ms resolvconf.service
           148ms keyboard-setup.service
           147ms systemd-remount-fs.service
           147ms ufw.service
           146ms apport.service
           138ms systemd-udev-trigger.service
           137ms rsyslog.service
           133ms run-rpc_pipefs.mount
           130ms kmod-static-nodes.service
           125ms snapd.socket
           119ms networking.service
           110ms open-iscsi.service
           102ms systemd-tmpfiles-setup-dev.service
            95ms lxd.socket
            93ms sys-kernel-debug.mount
            86ms systemd-machine-id-commit.service
            86ms systemd-udevd.service
            78ms systemd-journal-flush.service
            75ms nfs-config.service
            69ms systemd-tmpfiles-setup.service
            58ms plymouth-read-write.service
            47ms ssh.service
            41ms systemd-sysctl.service
            36ms plymouth-quit-wait.service
            36ms dev-mqueue.mount
            34ms snap-core-8268.mount
            34ms snap-oracle\x2dcloud\x2dagent-5.mount
            32ms systemd-random-seed.service
            27ms systemd-update-utmp-runlevel.service
            25ms plymouth-quit.service
            24ms systemd-user-sessions.service
            23ms iscsi-cleanup.service
            20ms systemd-update-utmp.service
            20ms dev-hugepages.mount
            18ms user@1000.service
            17ms sys-kernel-config.mount
            14ms boot-efi.mount
            13ms sys-fs-fuse-connections.mount
            10ms setvtrgb.service
             8ms dev-loop0.device
             4ms dev-loop1.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00600s +00.00100s
|`->no local data found from DataSourceOpenStackLocal @00.02200s +00.10400s
Finished stage: (init-local) 00.17000 seconds

Starting stage: init-network
|`->no cache found @00.70400s +00.00000s
|`->found network data from DataSourceOpenStack @00.71100s +05.14600s
|`->setting up datasource @06.02200s +00.00000s
|`->reading and applying user-data @06.05600s +00.00300s
|`->reading and applying vendor-data @06.05900s +00.00000s
|`->activating datasource @06.08700s +00.00200s
|`->config-migrator ran successfully @06.11600s +00.00000s
|`->config-seed_random ran successfully @06.11700s +00.00000s
|`->config-bootcmd ran successfully @06.11800s +00.00000s
|`->config-write-files ran successfully @06.11800s +00.00100s
|`->config-growpart ran successfully @06.11900s +00.19400s
|`->config-resizefs ran successfully @06.31300s +00.10400s
|`->config-disk_setup ran successfully @06.41700s +00.00200s
|`->config-mounts ran successfully @06.42000s +00.05800s
|`->config-set_hostname ran successfully @06.47900s +00.00100s
|`->config-update_hostname ran successfully @06.48000s +00.00100s
|`->config-update_etc_hosts ran successfully @06.48200s +00.00100s
|`->config-ca-certs ran successfully @06.48300s +00.00100s
|`->config-rsyslog ran successfully @06.48400s +00.00100s
|`->config-users-groups ran successfully @06.48500s +00.15600s
|`->config-ssh ran successfully @06.64100s +00.17300s
Finished stage: (init-network) 06.12500 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @19.95700s +00.00000s
|`->config-snap ran successfully @19.95800s +00.00100s
|`->config-snap_config ran successfully @19.95900s +00.00200s
|`->config-ssh-import-id ran successfully @19.96100s +00.01400s
|`->config-locale ran successfully @19.97500s +02.03800s
|`->config-set-passwords ran successfully @22.01400s +00.00100s
|`->config-grub-dpkg ran successfully @22.01500s +00.33900s
|`->config-apt-pipelining ran successfully @22.35400s +00.00100s
|`->config-apt-configure ran successfully @22.35600s +00.41400s
|`->config-ubuntu-advantage ran successfully @22.77100s +00.00100s
|`->config-ntp ran successfully @22.77200s +00.00100s
|`->config-timezone ran successfully @22.77400s +00.00100s
|`->config-disable-ec2-metadata ran successfully @22.77500s +00.00000s
|`->config-runcmd ran successfully @22.77500s +00.00100s
|`->config-byobu ran successfully @22.77600s +00.00100s
Finished stage: (modules-config) 02.90700 seconds

Starting stage: modules-final
|`->config-snappy ran successfully @23.24000s +00.00200s
|`->config-package-update-upgrade-install ran successfully @23.24200s +00.00100s
|`->config-fan ran successfully @23.24300s +00.00100s
|`->config-landscape ran successfully @23.24400s +00.00100s
|`->config-lxd ran successfully @23.24500s +00.00100s
|`->config-ubuntu-drivers ran successfully @23.24600s +00.00100s
|`->config-puppet ran successfully @23.24700s +00.00100s
|`->config-chef ran successfully @23.24800s +00.00100s
|`->config-mcollective ran successfully @23.24900s +00.00100s
|`->config-salt-minion ran successfully @23.25000s +00.00100s
|`->config-rightscale_userdata ran successfully @23.25100s +00.00100s
|`->config-scripts-vendor ran successfully @23.25200s +00.00000s
|`->config-scripts-per-once ran successfully @23.25300s +00.00000s
|`->config-scripts-per-boot ran successfully @23.25400s +00.00000s
|`->config-scripts-per-instance ran successfully @23.25400s +00.00100s
|`->config-scripts-user ran successfully @23.25500s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @23.25600s +00.02700s
|`->config-keys-to-console ran successfully @23.28400s +00.07600s
|`->config-phone-home ran successfully @23.36400s +00.00100s
|`->config-final-message ran successfully @23.36600s +00.01000s
|`->config-power-state-change ran successfully @23.37700s +00.00100s
Finished stage: (modules-final) 00.18100 seconds

Total Time: 9.38300 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.14600s (init-network/search-OpenStack)
     02.03800s (modules-config/config-locale)
     00.41400s (modules-config/config-apt-configure)
     00.33900s (modules-config/config-grub-dpkg)
     00.19400s (init-network/config-growpart)
     00.17300s (init-network/config-ssh)
     00.15600s (init-network/config-users-groups)
     00.10400s (init-network/config-resizefs)
     00.10400s (init-local/search-OpenStackLocal)
     00.07600s (modules-final/config-keys-to-console)
     00.05800s (init-network/config-mounts)
     00.02700s (modules-final/config-ssh-authkey-fingerprints)
     00.01400s (modules-config/config-ssh-import-id)
     00.01000s (modules-final/config-final-message)
     00.00300s (init-network/consume-user-data)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-snap_config)
     00.00200s (init-network/config-disk_setup)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-scripts-vendor)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-seed_random)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

# control-manual ens3
iface ens3 inet dhcp
    broadcast 10.0.0.255
    dns-nameservers 169.254.169.254
    dns-search canonical.oraclevcn.com
    gateway 10.0.0.1
setup_proposed.sh                                                                                                                            100%  194     2.4KB/s   00:00
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 19.4-33-gbb4131a2-0ubuntu1~16.04.1 [413 kB]
Preparing to unpack .../cloud-init_19.4-33-gbb4131a2-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (19.4-33-gbb4131a2-0ubuntu1~16.04.1) over (19.3-41-gc4735dd3-0ubuntu1~16.04.1) ...
Setting up cloud-init (19.4-33-gbb4131a2-0ubuntu1~16.04.1) ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
cloud-init	19.4-33-gbb4131a2-0ubuntu1~16.04.1
sudo: unable to resolve host SRU-didnt-work
sudo: unable to resolve host SRU-didnt-work
Connection to 129.146.184.243 closed by remote host.
mkstemp: No such file or directory
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
...........
status: done
time: Fri, 24 Jan 2020 21:19:39 +0000
detail:
DataSourceOpenStack [net,ver=2]
oddbloke-sru-xenial-20200124-1611
/var/log/cloud-init.log:Traceback (most recent call last):
/var/log/cloud-init.log:Traceback (most recent call last):
Startup finished in 18.525s (kernel) + 15.796s (userspace) = 34.322s
          6.141s cloud-init.service
          2.501s cloud-config.service
          2.021s snapd.service
          1.673s dev-sda1.device
          1.331s cloud-final.service
          1.255s cloud-init-local.service
           658ms accounts-daemon.service
           643ms lxd-containers.service
           503ms mdadm.service
           488ms grub-common.service
           465ms ssh.service
           452ms lvm2-monitor.service
           431ms systemd-logind.service
           431ms apparmor.service
           424ms netfilter-persistent.service
           383ms rc-local.service
           335ms console-setup.service
           276ms iscsid.service
           222ms keyboard-setup.service
           221ms dev-loop0.device
           219ms apport.service
           218ms dev-loop1.device
           201ms systemd-timesyncd.service
           197ms systemd-modules-load.service
           193ms irqbalance.service
           177ms systemd-udev-trigger.service
           144ms resolvconf.service
           144ms ondemand.service
           134ms rsyslog.service
           128ms open-iscsi.service
           126ms polkitd.service
           116ms systemd-journald.service
           112ms networking.service
           108ms systemd-udevd.service
           108ms snapd.seeded.service
           107ms systemd-tmpfiles-setup-dev.service
           104ms kmod-static-nodes.service
           100ms systemd-journal-flush.service
            99ms ufw.service
            95ms systemd-remount-fs.service
            87ms run-rpc_pipefs.mount
            75ms sys-kernel-debug.mount
            67ms dev-hugepages.mount
            57ms plymouth-quit.service
            52ms dev-mqueue.mount
            48ms systemd-sysctl.service
            47ms systemd-tmpfiles-setup.service
            47ms plymouth-read-write.service
            45ms snap-core-8268.mount
            44ms systemd-user-sessions.service
            44ms systemd-update-utmp-runlevel.service
            37ms snap-oracle\x2dcloud\x2dagent-5.mount
            36ms setvtrgb.service
            35ms lxd.socket
            35ms systemd-random-seed.service
            33ms nfs-config.service
            32ms systemd-update-utmp.service
            29ms plymouth-quit-wait.service
            25ms sys-fs-fuse-connections.mount
            24ms sys-kernel-config.mount
            19ms user@1000.service
            18ms snapd.socket
            16ms boot-efi.mount
            11ms iscsi-cleanup.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00100s
|`->no local data found from DataSourceOpenStackLocal @00.01900s +00.09200s
Finished stage: (init-local) 00.14900 seconds

Starting stage: init-network
|`->no cache found @00.67200s +00.00000s
|`->found network data from DataSourceOpenStack @00.67800s +05.09500s
|`->setting up datasource @05.93100s +00.00000s
|`->reading and applying user-data @05.95800s +00.00800s
|`->reading and applying vendor-data @05.96600s +00.00100s
|`->activating datasource @06.01500s +00.00100s
|`->config-migrator ran successfully @06.04100s +00.00100s
|`->config-seed_random ran successfully @06.04200s +00.00100s
|`->config-bootcmd ran successfully @06.04300s +00.00000s
|`->config-write-files ran successfully @06.04300s +00.00100s
|`->config-growpart ran successfully @06.04400s +00.06400s
|`->config-resizefs ran successfully @06.10900s +00.01800s
|`->config-disk_setup ran successfully @06.12800s +00.00200s
|`->config-mounts ran successfully @06.13100s +00.04000s
|`->config-set_hostname ran successfully @06.17200s +00.00100s
|`->config-update_hostname ran successfully @06.17300s +00.00100s
|`->config-update_etc_hosts ran successfully @06.17500s +00.00000s
|`->config-ca-certs ran successfully @06.17500s +00.00100s
|`->config-rsyslog ran successfully @06.17600s +00.00100s
|`->config-users-groups ran successfully @06.17700s +00.03600s
|`->config-ssh ran successfully @06.21300s +00.18300s
Finished stage: (init-network) 05.73900 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @10.49600s +00.00100s
|`->config-snap ran successfully @10.49800s +00.00400s
|`->config-ssh-import-id ran successfully @10.50300s +00.00200s
|`->config-locale ran successfully @10.50500s +00.01000s
|`->config-set-passwords ran successfully @10.51500s +00.00200s
|`->config-grub-dpkg ran successfully @10.51700s +00.49900s
|`->config-apt-pipelining ran successfully @11.01700s +00.00200s
|`->config-apt-configure ran successfully @11.01900s +00.25600s
|`->config-ubuntu-advantage ran successfully @11.27600s +00.00200s
|`->config-ntp ran successfully @11.27900s +00.00100s
|`->config-timezone ran successfully @11.28000s +00.00100s
|`->config-disable-ec2-metadata ran successfully @11.28200s +00.00000s
|`->config-runcmd ran successfully @11.28200s +00.00500s
|`->config-byobu ran successfully @11.28700s +00.00100s
Finished stage: (modules-config) 00.86700 seconds

Starting stage: modules-final
|`->config-package-update-upgrade-install ran successfully @12.42400s +00.00200s
|`->config-fan ran successfully @12.42600s +00.00200s
|`->config-landscape ran successfully @12.42800s +00.00100s
|`->config-lxd ran successfully @12.43000s +00.00300s
|`->config-ubuntu-drivers ran successfully @12.43400s +00.00100s
|`->config-puppet ran successfully @12.43500s +00.00100s
|`->config-chef ran successfully @12.43700s +00.00100s
|`->config-mcollective ran successfully @12.43800s +00.01700s
|`->config-salt-minion ran successfully @12.45600s +00.00100s
|`->config-rightscale_userdata ran successfully @12.45700s +00.00200s
|`->config-scripts-vendor ran successfully @12.45900s +00.00100s
|`->config-scripts-per-once ran successfully @12.46100s +00.00100s
|`->config-scripts-per-boot ran successfully @12.46200s +00.00000s
|`->config-scripts-per-instance ran successfully @12.46300s +00.00100s
|`->config-scripts-user ran successfully @12.46400s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @12.46600s +00.09400s
|`->config-keys-to-console ran successfully @12.56100s +00.05200s
|`->config-phone-home ran successfully @12.61400s +00.00200s
|`->config-final-message ran successfully @12.61600s +00.00700s
|`->config-power-state-change ran successfully @12.62400s +00.00100s
Finished stage: (modules-final) 00.24900 seconds

Total Time: 7.00400 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.09500s (init-network/search-OpenStack)
     00.49900s (modules-config/config-grub-dpkg)
     00.25600s (modules-config/config-apt-configure)
     00.18300s (init-network/config-ssh)
     00.09400s (modules-final/config-ssh-authkey-fingerprints)
     00.09200s (init-local/search-OpenStackLocal)
     00.06400s (init-network/config-growpart)
     00.05200s (modules-final/config-keys-to-console)
     00.04000s (init-network/config-mounts)
     00.03600s (init-network/config-users-groups)
     00.01800s (init-network/config-resizefs)
     00.01700s (modules-final/config-mcollective)
     00.01000s (modules-config/config-locale)
     00.00800s (init-network/consume-user-data)
     00.00700s (modules-final/config-final-message)
     00.00500s (modules-config/config-runcmd)
     00.00400s (modules-config/config-snap)
     00.00300s (modules-final/config-lxd)
     00.00200s (modules-final/config-rightscale_userdata)
     00.00200s (modules-final/config-phone-home)
     00.00200s (modules-final/config-package-update-upgrade-install)
     00.00200s (modules-final/config-fan)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-ssh-import-id)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (modules-config/config-apt-pipelining)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/consume-vendor-data)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

# control-manual ens3
iface ens3 inet dhcp
    broadcast 10.0.0.255
    dns-nameservers 169.254.169.254
    dns-search canonical.oraclevcn.com
    gateway 10.0.0.1
cloud-region: openstack-None
Get cloud-id
openstack
Validating whether metadata is being updated per boot LP:1819913
2020-01-24 21:19:26,541 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:19:27,200 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
Connection to 129.146.184.243 closed by remote host.
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
ssh: connect to host 129.146.184.243 port 22: Connection refused
......
status: done
time: Fri, 24 Jan 2020 21:21:08 +0000
detail:
DataSourceOpenStack [net,ver=2]
After reboot
2020-01-24 21:19:26,541 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:19:27,200 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:20:57,607 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:20:58,268 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
### BEGIN bionic
Please manually launch a bionic instance in Oracle and enter its IP address
(Don't forget to add your SSH public key to the instance when you launch it.)
bionic IP address: 129.146.80.156

status: done
time: Fri, 24 Jan 2020 21:21:11 +0000
detail:
DataSourceOpenStack [net,ver=2]
cloud-init	19.3-41-gc4735dd3-0ubuntu1~18.04.1
{
 "v1": {
  "datasource": "DataSourceOpenStack [net,ver=2]",
  "errors": []
 }
}
Traceback (most recent call last):
Traceback (most recent call last):
Startup finished in 18.984s (kernel) + 28.669s (userspace) = 47.653s
graphical.target reached after 25.250s in userspace
         10.627s snapd.seeded.service
          7.903s cloud-init.service
          2.616s cloud-config.service
          2.144s cloud-init-local.service
          1.370s dev-sda1.device
          1.263s pollinate.service
          1.185s snapd.service
          1.141s apparmor.service
           906ms lxd-containers.service
           811ms cloud-final.service
           735ms networkd-dispatcher.service
           595ms accounts-daemon.service
           594ms iscsid.service
           540ms grub-common.service
           458ms rsyslog.service
           457ms netfilter-persistent.service
           429ms systemd-logind.service
           349ms systemd-journald.service
           328ms keyboard-setup.service
           324ms systemd-udev-trigger.service
           304ms systemd-timesyncd.service
           221ms lvm2-monitor.service
           196ms systemd-modules-load.service
           189ms apport.service
           176ms ebtables.service
           160ms dev-mqueue.mount
           159ms run-rpc_pipefs.mount
           159ms kmod-static-nodes.service
           148ms systemd-resolved.service
           145ms dev-hugepages.mount
           124ms systemd-udevd.service
           116ms systemd-remount-fs.service
           104ms sys-kernel-debug.mount
            98ms polkit.service
            93ms systemd-tmpfiles-setup-dev.service
            82ms systemd-machine-id-commit.service
            78ms plymouth-read-write.service
            75ms ufw.service
            72ms rpcbind.service
            72ms systemd-networkd.service
            67ms systemd-user-sessions.service
            65ms console-setup.service
            63ms systemd-sysctl.service
            63ms systemd-tmpfiles-setup.service
            60ms nfs-config.service
            59ms systemd-journal-flush.service
            53ms systemd-update-utmp-runlevel.service
            49ms snapd.socket
            49ms ssh.service
            45ms lxd.socket
            44ms snap-core-8268.mount
            41ms systemd-update-utmp.service
            40ms plymouth-quit.service
            37ms user@1001.service
            27ms snap-oracle\x2dcloud\x2dagent-5.mount
            25ms iscsi-cleanup.service
            21ms blk-availability.service
            20ms systemd-networkd-wait-online.service
            20ms boot-efi.mount
            19ms setvtrgb.service
            19ms sys-kernel-config.mount
            18ms sys-fs-fuse-connections.mount
            17ms systemd-random-seed.service
            14ms dev-loop1.device
            12ms dev-loop0.device
             9ms plymouth-quit-wait.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
|`->no local data found from DataSourceOpenStackLocal @00.03900s +00.13400s
Finished stage: (init-local) 00.47900 seconds

Starting stage: init-network
|`->no cache found @01.15600s +00.00100s
|`->found network data from DataSourceOpenStack @01.17900s +05.14300s
|`->setting up datasource @06.70200s +00.00100s
|`->reading and applying user-data @06.71800s +00.00300s
|`->reading and applying vendor-data @06.72100s +00.00000s
|`->activating datasource @06.74700s +00.00200s
|`->config-migrator ran successfully @06.78700s +00.00000s
|`->config-seed_random ran successfully @06.78700s +00.00100s
|`->config-bootcmd ran successfully @06.78800s +00.00100s
|`->config-write-files ran successfully @06.78900s +00.00000s
|`->config-growpart ran successfully @06.79000s +00.23800s
|`->config-resizefs ran successfully @07.02900s +00.88500s
|`->config-disk_setup ran successfully @07.91400s +00.00200s
|`->config-mounts ran successfully @07.91600s +00.05100s
|`->config-set_hostname ran successfully @07.96800s +00.00100s
|`->config-update_hostname ran successfully @07.96900s +00.00100s
|`->config-update_etc_hosts ran successfully @07.97100s +00.00100s
|`->config-ca-certs ran successfully @07.97200s +00.00100s
|`->config-rsyslog ran successfully @07.97300s +00.00000s
|`->config-users-groups ran successfully @07.97400s +00.17900s
|`->config-ssh ran successfully @08.15400s +00.24600s
Finished stage: (init-network) 07.26200 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @21.64400s +00.00100s
|`->config-snap ran successfully @21.64500s +00.00200s
|`->config-snap_config ran successfully @21.64700s +00.00100s
|`->config-ssh-import-id ran successfully @21.64900s +00.00100s
|`->config-locale ran successfully @21.65100s +00.00900s
|`->config-set-passwords ran successfully @21.66100s +00.00100s
|`->config-grub-dpkg ran successfully @21.66200s +00.95600s
|`->config-apt-pipelining ran successfully @22.61900s +00.00900s
|`->config-apt-configure ran successfully @22.62900s +00.22600s
|`->config-ubuntu-advantage ran successfully @22.85500s +00.00200s
|`->config-ntp ran successfully @22.85700s +00.00100s
|`->config-timezone ran successfully @22.85800s +00.00200s
|`->config-disable-ec2-metadata ran successfully @22.86000s +00.00100s
|`->config-runcmd ran successfully @22.86100s +00.00100s
|`->config-byobu ran successfully @22.86200s +00.00100s
Finished stage: (modules-config) 01.27600 seconds

Starting stage: modules-final
|`->config-snappy ran successfully @23.58100s +00.00100s
|`->config-package-update-upgrade-install ran successfully @23.58300s +00.00000s
|`->config-fan ran successfully @23.58400s +00.00000s
|`->config-landscape ran successfully @23.58400s +00.00100s
|`->config-lxd ran successfully @23.58500s +00.00100s
|`->config-ubuntu-drivers ran successfully @23.58600s +00.00100s
|`->config-puppet ran successfully @23.58700s +00.00100s
|`->config-chef ran successfully @23.58800s +00.00000s
|`->config-mcollective ran successfully @23.58900s +00.00000s
|`->config-salt-minion ran successfully @23.58900s +00.00100s
|`->config-rightscale_userdata ran successfully @23.59000s +00.00100s
|`->config-scripts-vendor ran successfully @23.59100s +00.00100s
|`->config-scripts-per-once ran successfully @23.59200s +00.00100s
|`->config-scripts-per-boot ran successfully @23.59300s +00.00000s
|`->config-scripts-per-instance ran successfully @23.59300s +00.00100s
|`->config-scripts-user ran successfully @23.59400s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @23.59500s +00.04700s
|`->config-keys-to-console ran successfully @23.64200s +00.08900s
|`->config-phone-home ran successfully @23.73200s +00.00100s
|`->config-final-message ran successfully @23.73300s +00.00600s
|`->config-power-state-change ran successfully @23.73900s +00.00100s
Finished stage: (modules-final) 00.19500 seconds

Total Time: 9.21200 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.14300s (init-network/search-OpenStack)
     00.95600s (modules-config/config-grub-dpkg)
     00.88500s (init-network/config-resizefs)
     00.24600s (init-network/config-ssh)
     00.23800s (init-network/config-growpart)
     00.22600s (modules-config/config-apt-configure)
     00.17900s (init-network/config-users-groups)
     00.13400s (init-local/search-OpenStackLocal)
     00.08900s (modules-final/config-keys-to-console)
     00.05100s (init-network/config-mounts)
     00.04700s (modules-final/config-ssh-authkey-fingerprints)
     00.00900s (modules-config/config-locale)
     00.00900s (modules-config/config-apt-pipelining)
     00.00600s (modules-final/config-final-message)
     00.00300s (init-network/consume-user-data)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-timezone)
     00.00200s (modules-config/config-snap)
     00.00200s (init-network/config-disk_setup)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-snappy)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-config/config-ssh-import-id)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-disable-ec2-metadata)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/setup-datasource)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/config-bootcmd)
     00.00100s (init-network/check-cache)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-package-update-upgrade-install)
     00.00000s (modules-final/config-mcollective)
     00.00000s (modules-final/config-fan)
     00.00000s (modules-final/config-chef)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-write-files)
     00.00000s (init-network/config-rsyslog)
     00.00000s (init-network/config-migrator)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        ens3:
            dhcp4: true
            match:
                macaddress: 02:00:17:05:e9:0c
            set-name: ens3
setup_proposed.sh                                                                                                                            100%  194     2.3KB/s   00:00
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 19.4-33-gbb4131a2-0ubuntu1~18.04.1 [409 kB]
Preparing to unpack .../cloud-init_19.4-33-gbb4131a2-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (19.4-33-gbb4131a2-0ubuntu1~18.04.1) over (19.3-41-gc4735dd3-0ubuntu1~18.04.1) ...
Setting up cloud-init (19.4-33-gbb4131a2-0ubuntu1~18.04.1) ...
cloud-init	19.4-33-gbb4131a2-0ubuntu1~18.04.1
Connection to 129.146.80.156 closed by remote host.
mkstemp: No such file or directory
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
..........
status: done
time: Fri, 24 Jan 2020 21:24:14 +0000
detail:
DataSourceOpenStack [net,ver=2]
oddbloke-sru-bionic-20200124-1618
/var/log/cloud-init.log:Traceback (most recent call last):
/var/log/cloud-init.log:Traceback (most recent call last):
Startup finished in 18.901s (kernel) + 18.167s (userspace) = 37.069s
graphical.target reached after 14.446s in userspace
          6.744s cloud-init.service
          2.942s cloud-config.service
          2.194s snapd.service
          2.054s dev-sda1.device
          1.657s cloud-init-local.service
           786ms cloud-final.service
           769ms dev-loop0.device
           728ms dev-loop1.device
           686ms networkd-dispatcher.service
           603ms lxd-containers.service
           459ms apparmor.service
           455ms accounts-daemon.service
           450ms grub-common.service
           431ms netfilter-persistent.service
           403ms systemd-udev-trigger.service
           332ms systemd-udevd.service
           329ms keyboard-setup.service
           318ms lvm2-monitor.service
           312ms systemd-journal-flush.service
           284ms ssh.service
           281ms systemd-timesyncd.service
           279ms apport.service
           261ms iscsid.service
           258ms systemd-journald.service
           252ms rsyslog.service
           243ms polkit.service
           214ms snapd.seeded.service
           194ms systemd-modules-load.service
           193ms systemd-logind.service
           161ms dev-hugepages.mount
           138ms dev-mqueue.mount
           138ms ufw.service
           134ms systemd-remount-fs.service
           133ms systemd-resolved.service
           131ms run-rpc_pipefs.mount
           123ms sys-kernel-debug.mount
           110ms ebtables.service
            96ms rpcbind.service
            92ms kmod-static-nodes.service
            85ms systemd-tmpfiles-setup.service
            83ms iscsi-cleanup.service
            76ms systemd-tmpfiles-setup-dev.service
            69ms snapd.socket
            62ms lxd.socket
            62ms plymouth-read-write.service
            61ms systemd-sysctl.service
            61ms systemd-user-sessions.service
            59ms snap-oracle\x2dcloud\x2dagent-5.mount
            55ms systemd-networkd.service
            48ms blk-availability.service
            47ms nfs-config.service
            47ms console-setup.service
            43ms snap-core-8268.mount
            39ms setvtrgb.service
            38ms systemd-update-utmp-runlevel.service
            35ms user@1001.service
            32ms sys-fs-fuse-connections.mount
            29ms sys-kernel-config.mount
            29ms systemd-update-utmp.service
            22ms plymouth-quit.service
            21ms systemd-random-seed.service
            19ms plymouth-quit-wait.service
            18ms systemd-networkd-wait-online.service
            15ms boot-efi.mount
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00400s +00.00100s
|`->no local data found from DataSourceOpenStackLocal @00.04000s +00.10600s
Finished stage: (init-local) 00.41900 seconds

Starting stage: init-network
|`->no cache found @01.07500s +00.00100s
|`->found network data from DataSourceOpenStack @01.09800s +05.10600s
|`->setting up datasource @06.60400s +00.00000s
|`->reading and applying user-data @06.61800s +00.00300s
|`->reading and applying vendor-data @06.62100s +00.00000s
|`->activating datasource @06.64600s +00.00100s
|`->config-migrator ran successfully @06.67100s +00.00100s
|`->config-seed_random ran successfully @06.67200s +00.00100s
|`->config-bootcmd ran successfully @06.67300s +00.00000s
|`->config-write-files ran successfully @06.67300s +00.00100s
|`->config-growpart ran successfully @06.67400s +00.08400s
|`->config-resizefs ran successfully @06.75900s +00.05100s
|`->config-disk_setup ran successfully @06.81100s +00.00200s
|`->config-mounts ran successfully @06.81400s +00.05300s
|`->config-set_hostname ran successfully @06.86700s +00.00200s
|`->config-update_hostname ran successfully @06.86900s +00.00100s
|`->config-update_etc_hosts ran successfully @06.87000s +00.00100s
|`->config-ca-certs ran successfully @06.87100s +00.00100s
|`->config-rsyslog ran successfully @06.87200s +00.00100s
|`->config-users-groups ran successfully @06.87300s +00.04100s
|`->config-ssh ran successfully @06.91500s +00.32400s
Finished stage: (init-network) 06.18200 seconds

Starting stage: modules-config
|`->config-emit_upstart ran successfully @12.23600s +00.00100s
|`->config-snap ran successfully @12.23700s +00.00900s
|`->config-ssh-import-id ran successfully @12.24700s +00.00100s
|`->config-locale ran successfully @12.24900s +00.00900s
|`->config-set-passwords ran successfully @12.25900s +00.00100s
|`->config-grub-dpkg ran successfully @12.26000s +00.54100s
|`->config-apt-pipelining ran successfully @12.80100s +00.00200s
|`->config-apt-configure ran successfully @12.80300s +00.19000s
|`->config-ubuntu-advantage ran successfully @12.99500s +00.00200s
|`->config-ntp ran successfully @12.99700s +00.00200s
|`->config-timezone ran successfully @12.99900s +00.00100s
|`->config-disable-ec2-metadata ran successfully @13.00100s +00.00000s
|`->config-runcmd ran successfully @13.00100s +00.00100s
|`->config-byobu ran successfully @13.00200s +00.00100s
Finished stage: (modules-config) 00.85100 seconds

Starting stage: modules-final
|`->config-package-update-upgrade-install ran successfully @13.71700s +00.00100s
|`->config-fan ran successfully @13.71800s +00.00100s
|`->config-landscape ran successfully @13.71900s +00.00100s
|`->config-lxd ran successfully @13.72000s +00.00100s
|`->config-ubuntu-drivers ran successfully @13.72100s +00.00100s
|`->config-puppet ran successfully @13.72200s +00.00000s
|`->config-chef ran successfully @13.72300s +00.00000s
|`->config-mcollective ran successfully @13.72300s +00.00100s
|`->config-salt-minion ran successfully @13.72400s +00.00100s
|`->config-rightscale_userdata ran successfully @13.72500s +00.00100s
|`->config-scripts-vendor ran successfully @13.72600s +00.00100s
|`->config-scripts-per-once ran successfully @13.72700s +00.00000s
|`->config-scripts-per-boot ran successfully @13.72800s +00.00000s
|`->config-scripts-per-instance ran successfully @13.72800s +00.00100s
|`->config-scripts-user ran successfully @13.72900s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @13.73000s +00.04700s
|`->config-keys-to-console ran successfully @13.77800s +00.06400s
|`->config-phone-home ran successfully @13.84300s +00.00100s
|`->config-final-message ran successfully @13.84400s +00.00600s
|`->config-power-state-change ran successfully @13.85000s +00.00100s
Finished stage: (modules-final) 00.16800 seconds

Total Time: 7.62000 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.10600s (init-network/search-OpenStack)
     00.54100s (modules-config/config-grub-dpkg)
     00.32400s (init-network/config-ssh)
     00.19000s (modules-config/config-apt-configure)
     00.10600s (init-local/search-OpenStackLocal)
     00.08400s (init-network/config-growpart)
     00.06400s (modules-final/config-keys-to-console)
     00.05300s (init-network/config-mounts)
     00.05100s (init-network/config-resizefs)
     00.04700s (modules-final/config-ssh-authkey-fingerprints)
     00.04100s (init-network/config-users-groups)
     00.00900s (modules-config/config-snap)
     00.00900s (modules-config/config-locale)
     00.00600s (modules-final/config-final-message)
     00.00300s (init-network/consume-user-data)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-ntp)
     00.00200s (modules-config/config-apt-pipelining)
     00.00200s (init-network/config-set_hostname)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-ssh-import-id)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/check-cache)
     00.00100s (init-network/activate-datasource)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-puppet)
     00.00000s (modules-final/config-chef)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-bootcmd)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        ens3:
            dhcp4: true
            match:
                macaddress: 02:00:17:05:e9:0c
            set-name: ens3
cloud-region: openstack-None
Get cloud-id
openstack
Validating whether metadata is being updated per boot LP:1819913
2020-01-24 21:24:00,213 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:24:01,271 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
Connection to 129.146.80.156 closed by remote host.
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
ssh: connect to host 129.146.80.156 port 22: Connection refused
.......
status: done
time: Fri, 24 Jan 2020 21:25:52 +0000
detail:
DataSourceOpenStack [net,ver=2]
After reboot
2020-01-24 21:24:00,213 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:24:01,271 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:25:39,847 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2020-01-24 21:25:40,944 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
