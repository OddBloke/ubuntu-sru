# Manual Oracle upgrade and clean install validation

SRU_SERIES="xenial bionic"

# local values
LP_USER="daniel-thewatkins"

cat > sethostname.yaml << EOF
## template: jinja
#cloud-config
ssh_import_id : [$LP_USER]
hostname: SRU-worked-{{v1.cloud_name}}
EOF

cat > setup_proposed.sh <<EOF
#/bin/bash
mirror=http://archive.ubuntu.com/ubuntu
echo deb \$mirror \$(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init
EOF

sshopts=( -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR )
for series in $SRU_SERIES; do
  echo "### BEGIN $series"
  if [ "$series" = "xenial" ]; then
    netcfg="/etc/network/interfaces.d/50-cloud-init.cfg"
  else
    netcfg="/etc/netplan/50-cloud-init.yaml"
  fi

  # TODO: Use the Oracle CLI
  echo "Please manually launch a $series instance in Oracle and enter its IP address"
  echo "(Don't forget to add your SSH public key to the instance when you launch it.)"
  read -p "$series IP address: " VM_IP

  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 5
  done

  # Capture current state
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cat /run/cloud-init/result.json
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- grep Trace /var/log/cloud-init.log
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg

  # Upgrade to -proposed cloud-init and reboot
  scp "${sshopts[@]}" setup_proposed.sh ubuntu@$VM_IP:.
  ssh "${sshopts[@]}" ubuntu@$VM_IP sudo bash ./setup_proposed.sh 2>&1 | egrep 'cloud-init'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo hostname SRU-didnt-work
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo rm -f $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cloud-init clean --logs --reboot
  ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R $VM_IP

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 1
  done

  ssh "${sshopts[@]}" ubuntu@$VM_IP -- hostname
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep Trace /var/log/cloud-init*"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'After upgrade Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init query --format "'cloud-region: {{cloud_name}}-{{region}}'"
  echo "Get cloud-id"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-id
  echo 'Validating whether metadata is being updated per boot LP:1819913'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo reboot || true

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 1
  done
  echo 'After reboot'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
done

echo "Don't forget to clean up your instances!"

###################
VERIFICATION OUTPUT
###################

### BEGIN xenial
Please manually launch a xenial instance in Oracle and enter its IP address
(Don't forget to add your SSH public key to the instance when you launch it.)
xenial IP address: 158.101.7.212
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
..........................
status: done
time: Wed, 25 Sep 2019 19:18:00 +0000
detail:
DataSourceOpenStackLocal [net,ver=2]
cloud-init	19.1-1-gbaa47854-0ubuntu1~16.04.1
{
 "v1": {
  "datasource": "DataSourceOpenStackLocal [net,ver=2]",
  "errors": []
 }
}
Traceback (most recent call last):
Startup finished in 12.316s (kernel) + 24.918s (userspace) = 37.234s
         10.289s snapd.seeded.service
          6.885s cloud-init-local.service
          3.408s cloud-config.service
          1.798s apparmor.service
          1.739s snapd.service
          1.468s pollinate.service
          1.311s console-setup.service
          1.182s cloud-init.service
          1.108s dev-sda1.device
           575ms cloud-final.service
           535ms netfilter-persistent.service
           472ms lxd-containers.service
           392ms iscsid.service
           331ms accounts-daemon.service
           283ms lvm2-monitor.service
           258ms mdadm.service
           225ms keyboard-setup.service
           215ms grub-common.service
           201ms systemd-modules-load.service
           193ms irqbalance.service
           187ms apport.service
           184ms systemd-timesyncd.service
           169ms polkitd.service
           163ms systemd-journald.service
           151ms systemd-logind.service
           151ms systemd-udev-trigger.service
           145ms rc-local.service
           140ms systemd-udevd.service
           113ms networking.service
            99ms kmod-static-nodes.service
            99ms systemd-remount-fs.service
            95ms open-iscsi.service
            92ms systemd-journal-flush.service
            92ms ufw.service
            91ms run-rpc_pipefs.mount
            90ms resolvconf.service
            80ms ondemand.service
            74ms systemd-machine-id-commit.service
            65ms rsyslog.service
            64ms dev-mqueue.mount
            64ms systemd-tmpfiles-setup-dev.service
            59ms setvtrgb.service
            45ms systemd-tmpfiles-setup.service
            44ms plymouth-read-write.service
            41ms sys-kernel-debug.mount
            40ms dev-hugepages.mount
            39ms iscsi-cleanup.service
            36ms snap-oracle\x2dcloud\x2dagent-4.mount
            35ms nfs-config.service
            34ms ssh.service
            33ms snap-core-7396.mount
            33ms systemd-update-utmp.service
            30ms plymouth-quit-wait.service
            29ms plymouth-quit.service
            26ms systemd-sysctl.service
            25ms systemd-random-seed.service
            22ms sys-fs-fuse-connections.mount
            19ms systemd-user-sessions.service
            19ms systemd-update-utmp-runlevel.service
            18ms user@1000.service
            15ms lxd.socket
            14ms boot-efi.mount
            12ms snapd.socket
            10ms sys-kernel-config.mount
             8ms dev-loop1.device
             3ms dev-loop0.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00900s +00.00000s
|`->found local data from DataSourceOpenStackLocal @00.03200s +05.24500s
Finished stage: (init-local) 05.35800 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceOpenStackLocal [net,ver=2] @05.88200s +00.00500s
|`->setting up datasource @05.95300s +00.00000s
|`->reading and applying user-data @05.96100s +00.00200s
|`->reading and applying vendor-data @05.96300s +00.00000s
|`->activating datasource @05.99200s +00.00200s
|`->config-migrator ran successfully @06.02200s +00.00000s
|`->config-seed_random ran successfully @06.02300s +00.00000s
|`->config-bootcmd ran successfully @06.02400s +00.00000s
|`->config-write-files ran successfully @06.02400s +00.00100s
|`->config-growpart ran successfully @06.02500s +00.11600s
|`->config-resizefs ran successfully @06.14100s +00.07900s
|`->config-disk_setup ran successfully @06.22000s +00.00200s
|`->config-mounts ran successfully @06.22300s +00.06200s
|`->config-set_hostname ran successfully @06.28500s +00.00100s
|`->config-update_hostname ran successfully @06.28700s +00.00100s
|`->config-update_etc_hosts ran successfully @06.28800s +00.00100s
|`->config-ca-certs ran successfully @06.28900s +00.00100s
|`->config-rsyslog ran successfully @06.29000s +00.00100s
|`->config-users-groups ran successfully @06.29100s +00.14100s
|`->config-ssh ran successfully @06.43300s +00.20300s
Finished stage: (init-network) 00.77000 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @18.92300s +00.00000s
|`->config-snap ran successfully @18.92300s +00.00300s
|`->config-snap_config ran successfully @18.92600s +00.00100s
|`->config-ssh-import-id ran successfully @18.92800s +00.00100s
|`->config-locale ran successfully @18.93000s +01.84300s
|`->config-set-passwords ran successfully @20.77400s +00.00100s
|`->config-grub-dpkg ran successfully @20.77500s +00.21500s
|`->config-apt-pipelining ran successfully @20.99100s +00.00100s
|`->config-apt-configure ran successfully @20.99200s +00.33900s
|`->config-ubuntu-advantage ran successfully @21.33200s +00.00100s
|`->config-ntp ran successfully @21.33400s +00.00100s
|`->config-timezone ran successfully @21.33500s +00.00100s
|`->config-disable-ec2-metadata ran successfully @21.33600s +00.00000s
|`->config-runcmd ran successfully @21.33700s +00.00000s
|`->config-byobu ran successfully @21.33800s +00.00000s
Finished stage: (modules-config) 02.45700 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @21.78400s +00.00200s
|`->config-package-update-upgrade-install ran successfully @21.78600s +00.00100s
|`->config-fan ran successfully @21.78700s +00.00100s
|`->config-landscape ran successfully @21.78800s +00.00100s
|`->config-lxd ran successfully @21.78900s +00.00100s
|`->config-ubuntu-drivers ran successfully @21.79000s +00.00100s
|`->config-puppet ran successfully @21.79100s +00.00100s
|`->config-chef ran successfully @21.79200s +00.00100s
|`->config-mcollective ran successfully @21.79300s +00.00100s
|`->config-salt-minion ran successfully @21.79400s +00.00100s
|`->config-rightscale_userdata ran successfully @21.79500s +00.00100s
|`->config-scripts-vendor ran successfully @21.79600s +00.00100s
|`->config-scripts-per-once ran successfully @21.79700s +00.00000s
|`->config-scripts-per-boot ran successfully @21.79800s +00.00000s
|`->config-scripts-per-instance ran successfully @21.79800s +00.00100s
|`->config-scripts-user ran successfully @21.79900s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @21.80000s +00.02900s
|`->config-keys-to-console ran successfully @21.83000s +00.07800s
|`->config-phone-home ran successfully @21.90800s +00.00200s
|`->config-final-message ran successfully @21.91000s +00.00500s
|`->config-power-state-change ran successfully @21.91500s +00.00100s
Finished stage: (modules-final) 00.16200 seconds 

Total Time: 8.74700 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.24500s (init-local/search-OpenStackLocal)
     01.84300s (modules-config/config-locale)
     00.33900s (modules-config/config-apt-configure)
     00.21500s (modules-config/config-grub-dpkg)
     00.20300s (init-network/config-ssh)
     00.14100s (init-network/config-users-groups)
     00.11600s (init-network/config-growpart)
     00.07900s (init-network/config-resizefs)
     00.07800s (modules-final/config-keys-to-console)
     00.06200s (init-network/config-mounts)
     00.02900s (modules-final/config-ssh-authkey-fingerprints)
     00.00500s (modules-final/config-final-message)
     00.00500s (init-network/check-cache)
     00.00300s (modules-config/config-snap)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-final/config-phone-home)
     00.00200s (init-network/consume-user-data)
     00.00200s (init-network/config-disk_setup)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-ssh-import-id)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-ca-certs)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-config/config-runcmd)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (modules-config/config-byobu)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-seed_random)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

# control-manual ens3
iface ens3 inet dhcp
    broadcast 10.0.0.255
    dns-nameservers 169.254.169.254
    gateway 10.0.0.1
setup_proposed.sh                                                                                                                                                                100%  194     2.3KB/s   00:00    
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu1~16.04.1 [408 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu1~16.04.1) over (19.1-1-gbaa47854-0ubuntu1~16.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu1~16.04.1) ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
cloud-init	19.2-36-g059d049c-0ubuntu1~16.04.1
sudo: unable to resolve host SRU-didnt-work
sudo: unable to resolve host SRU-didnt-work
Connection to 158.101.7.212 closed by remote host.
mkstemp: No such file or directory
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
..........
status: done
time: Wed, 25 Sep 2019 19:19:51 +0000
detail:
DataSourceOpenStack [net,ver=2]
oddbloke-sru-20190925-1515
/var/log/cloud-init.log:Traceback (most recent call last):
/var/log/cloud-init.log:Traceback (most recent call last):
Startup finished in 17.225s (kernel) + 16.020s (userspace) = 33.246s
          6.447s cloud-init.service
          2.893s cloud-config.service
          1.893s snapd.service
          1.698s dev-sda1.device
          1.517s cloud-init-local.service
           797ms lxd-containers.service
           659ms lvm2-monitor.service
           613ms cloud-final.service
           534ms accounts-daemon.service
           459ms apparmor.service
           446ms netfilter-persistent.service
           315ms iscsid.service
           306ms console-setup.service
           301ms mdadm.service
           292ms systemd-logind.service
           256ms ssh.service
           255ms grub-common.service
           213ms rsyslog.service
           199ms apport.service
           188ms snapd.seeded.service
           181ms systemd-timesyncd.service
           172ms systemd-modules-load.service
           159ms systemd-udev-trigger.service
           155ms ufw.service
           155ms keyboard-setup.service
           146ms systemd-journald.service
           146ms irqbalance.service
           141ms dev-hugepages.mount
           139ms sys-kernel-debug.mount
           138ms kmod-static-nodes.service
           136ms dev-loop0.device
           132ms run-rpc_pipefs.mount
           127ms open-iscsi.service
           117ms dev-loop1.device
           115ms systemd-remount-fs.service
           109ms networking.service
           105ms dev-mqueue.mount
            99ms systemd-tmpfiles-setup-dev.service
            98ms systemd-udevd.service
            86ms ondemand.service
            70ms polkitd.service
            61ms systemd-update-utmp.service
            56ms systemd-sysctl.service
            54ms systemd-journal-flush.service
            54ms resolvconf.service
            47ms systemd-tmpfiles-setup.service
            44ms setvtrgb.service
            36ms plymouth-read-write.service
            35ms systemd-user-sessions.service
            34ms lxd.socket
            34ms plymouth-quit.service
            31ms plymouth-quit-wait.service
            31ms snap-oracle\x2dcloud\x2dagent-4.mount
            30ms snapd.socket
            30ms iscsi-cleanup.service
            26ms systemd-random-seed.service
            25ms sys-fs-fuse-connections.mount
            24ms snap-core-7396.mount
            21ms nfs-config.service
            20ms rc-local.service
            19ms user@1000.service
            18ms sys-kernel-config.mount
            17ms systemd-update-utmp-runlevel.service
            13ms boot-efi.mount
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
|`->no local data found from DataSourceOpenStackLocal @00.02400s +00.10100s
Finished stage: (init-local) 00.17900 seconds 

Starting stage: init-network
|`->no cache found @00.68400s +00.00000s
|`->found network data from DataSourceOpenStack @00.68900s +05.10600s
|`->setting up datasource @05.96000s +00.00000s
|`->reading and applying user-data @05.98200s +00.00300s
|`->reading and applying vendor-data @05.98500s +00.00000s
|`->activating datasource @06.01200s +00.00200s
|`->config-migrator ran successfully @06.05700s +00.00100s
|`->config-seed_random ran successfully @06.05800s +00.00100s
|`->config-bootcmd ran successfully @06.05900s +00.00000s
|`->config-write-files ran successfully @06.05900s +00.00100s
|`->config-growpart ran successfully @06.06000s +00.14800s
|`->config-resizefs ran successfully @06.20900s +00.04300s
|`->config-disk_setup ran successfully @06.25300s +00.00500s
|`->config-mounts ran successfully @06.25800s +00.05000s
|`->config-set_hostname ran successfully @06.30900s +00.00100s
|`->config-update_hostname ran successfully @06.31000s +00.00100s
|`->config-update_etc_hosts ran successfully @06.31200s +00.00000s
|`->config-ca-certs ran successfully @06.31200s +00.00100s
|`->config-rsyslog ran successfully @06.31300s +00.00100s
|`->config-users-groups ran successfully @06.31400s +00.09200s
|`->config-ssh ran successfully @06.40600s +00.17200s
Finished stage: (init-network) 05.90900 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @10.63800s +00.00000s
|`->config-snap ran successfully @10.63900s +00.00100s
|`->config-snap_config ran successfully @10.64100s +00.00100s
|`->config-ssh-import-id ran successfully @10.65100s +00.00200s
|`->config-locale ran successfully @10.65300s +00.01400s
|`->config-set-passwords ran successfully @10.66800s +00.00200s
|`->config-grub-dpkg ran successfully @10.67000s +00.80800s
|`->config-apt-pipelining ran successfully @11.47800s +00.00200s
|`->config-apt-configure ran successfully @11.48000s +00.51100s
|`->config-ubuntu-advantage ran successfully @11.99100s +00.00200s
|`->config-ntp ran successfully @11.99300s +00.00200s
|`->config-timezone ran successfully @11.99500s +00.00100s
|`->config-disable-ec2-metadata ran successfully @11.99600s +00.00100s
|`->config-runcmd ran successfully @11.99700s +00.00100s
|`->config-byobu ran successfully @11.99900s +00.00100s
Finished stage: (modules-config) 01.43500 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @12.50200s +00.00200s
|`->config-package-update-upgrade-install ran successfully @12.50400s +00.00100s
|`->config-fan ran successfully @12.50500s +00.00100s
|`->config-landscape ran successfully @12.50600s +00.00100s
|`->config-lxd ran successfully @12.50700s +00.00100s
|`->config-ubuntu-drivers ran successfully @12.50800s +00.00100s
|`->config-puppet ran successfully @12.50900s +00.00100s
|`->config-chef ran successfully @12.51000s +00.00100s
|`->config-mcollective ran successfully @12.51100s +00.00100s
|`->config-salt-minion ran successfully @12.51200s +00.00100s
|`->config-rightscale_userdata ran successfully @12.51300s +00.00000s
|`->config-scripts-vendor ran successfully @12.51400s +00.00000s
|`->config-scripts-per-once ran successfully @12.51500s +00.00000s
|`->config-scripts-per-boot ran successfully @12.51600s +00.00000s
|`->config-scripts-per-instance ran successfully @12.51600s +00.00100s
|`->config-scripts-user ran successfully @12.51700s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @12.51800s +00.04100s
|`->config-keys-to-console ran successfully @12.55900s +00.05700s
|`->config-phone-home ran successfully @12.61700s +00.00100s
|`->config-final-message ran successfully @12.61800s +00.00500s
|`->config-power-state-change ran successfully @12.62300s +00.00100s
Finished stage: (modules-final) 00.18500 seconds 

Total Time: 7.70800 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.10600s (init-network/search-OpenStack)
     00.80800s (modules-config/config-grub-dpkg)
     00.51100s (modules-config/config-apt-configure)
     00.17200s (init-network/config-ssh)
     00.14800s (init-network/config-growpart)
     00.10100s (init-local/search-OpenStackLocal)
     00.09200s (init-network/config-users-groups)
     00.05700s (modules-final/config-keys-to-console)
     00.05000s (init-network/config-mounts)
     00.04300s (init-network/config-resizefs)
     00.04100s (modules-final/config-ssh-authkey-fingerprints)
     00.01400s (modules-config/config-locale)
     00.00500s (modules-final/config-final-message)
     00.00500s (init-network/config-disk_setup)
     00.00300s (init-network/consume-user-data)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-ssh-import-id)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (modules-config/config-ntp)
     00.00200s (modules-config/config-apt-pipelining)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-disable-ec2-metadata)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00000s (modules-final/config-scripts-vendor)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

# control-manual ens3
iface ens3 inet dhcp
    broadcast 10.0.0.255
    dns-nameservers 169.254.169.254
    gateway 10.0.0.1
cloud-region: openstack-None
Get cloud-id
openstack
Validating whether metadata is being updated per boot LP:1819913
2019-09-25 19:19:38,562 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:19:39,228 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
Connection to 158.101.7.212 closed by remote host.
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
ssh: connect to host 158.101.7.212 port 22: Connection refused
......
status: done
time: Wed, 25 Sep 2019 19:21:22 +0000
detail:
DataSourceOpenStack [net,ver=2]
After reboot
2019-09-25 19:19:38,562 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:19:39,228 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:21:11,500 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:21:12,189 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
### BEGIN bionic
Please manually launch a bionic instance in Oracle and enter its IP address
(Don't forget to add your SSH public key to the instance when you launch it.)
bionic IP address: 158.101.5.222

status: done
time: Wed, 25 Sep 2019 19:20:34 +0000
detail:
DataSourceOpenStackLocal [net,ver=2]
cloud-init	19.1-1-gbaa47854-0ubuntu1~18.04.1
{
 "v1": {
  "datasource": "DataSourceOpenStackLocal [net,ver=2]",
  "errors": []
 }
}
Traceback (most recent call last):
Startup finished in 10.551s (kernel) + 25.051s (userspace) = 35.603s
graphical.target reached after 22.034s in userspace
          9.498s snapd.seeded.service
          6.557s cloud-init-local.service
          2.040s cloud-config.service
          1.938s cloud-init.service
          1.581s dev-sda1.device
          1.242s keyboard-setup.service
          1.156s pollinate.service
          1.152s apparmor.service
          1.059s snapd.service
           969ms cloud-final.service
           539ms networkd-dispatcher.service
           492ms netfilter-persistent.service
           465ms accounts-daemon.service
           458ms lxd-containers.service
           345ms grub-common.service
           328ms systemd-udev-trigger.service
           292ms systemd-timesyncd.service
           258ms iscsid.service
           241ms systemd-journald.service
           221ms polkit.service
           186ms lvm2-monitor.service
           165ms rsyslog.service
           161ms systemd-logind.service
           158ms systemd-resolved.service
           152ms ebtables.service
           150ms kmod-static-nodes.service
           144ms dev-mqueue.mount
           140ms systemd-remount-fs.service
           137ms systemd-modules-load.service
           137ms sys-kernel-debug.mount
           126ms ufw.service
           110ms dev-hugepages.mount
           106ms apport.service
           105ms run-rpc_pipefs.mount
            95ms systemd-udevd.service
            84ms systemd-tmpfiles-setup.service
            72ms systemd-tmpfiles-setup-dev.service
            72ms iscsi-cleanup.service
            67ms setvtrgb.service
            61ms nfs-config.service
            56ms systemd-journal-flush.service
            56ms snap-oracle\x2dcloud\x2dagent-4.mount
            56ms systemd-machine-id-commit.service
            55ms blk-availability.service
            54ms rpcbind.service
            53ms systemd-sysctl.service
            49ms plymouth-read-write.service
            45ms systemd-networkd.service
            39ms snapd.socket
            36ms plymouth-quit.service
            34ms systemd-update-utmp.service
            34ms user@1001.service
            33ms snap-core-7396.mount
            32ms ssh.service
            29ms systemd-user-sessions.service
            27ms console-setup.service
            25ms systemd-networkd-wait-online.service
            24ms lxd.socket
            22ms systemd-random-seed.service
            21ms sys-kernel-config.mount
            19ms sys-fs-fuse-connections.mount
            14ms systemd-update-utmp-runlevel.service
            14ms boot-efi.mount
             8ms dev-loop1.device
             7ms plymouth-quit-wait.service
             4ms dev-loop0.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
|`->found local data from DataSourceOpenStackLocal @00.03900s +05.16600s
Finished stage: (init-local) 05.43300 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceOpenStackLocal [net,ver=2] @06.12700s +00.02400s
|`->setting up datasource @06.21300s +00.00000s
|`->reading and applying user-data @06.22100s +00.00200s
|`->reading and applying vendor-data @06.22300s +00.00100s
|`->activating datasource @06.24900s +00.00300s
|`->config-migrator ran successfully @06.34900s +00.00800s
|`->config-seed_random ran successfully @06.35800s +00.00000s
|`->config-bootcmd ran successfully @06.35900s +00.00000s
|`->config-write-files ran successfully @06.35900s +00.00100s
|`->config-growpart ran successfully @06.36000s +00.16400s
|`->config-resizefs ran successfully @06.52400s +00.45500s
|`->config-disk_setup ran successfully @06.97900s +00.00100s
|`->config-mounts ran successfully @06.98000s +00.02700s
|`->config-set_hostname ran successfully @07.00700s +00.00100s
|`->config-update_hostname ran successfully @07.00900s +00.00100s
|`->config-update_etc_hosts ran successfully @07.01000s +00.00100s
|`->config-ca-certs ran successfully @07.01100s +00.00100s
|`->config-rsyslog ran successfully @07.01200s +00.00100s
|`->config-users-groups ran successfully @07.01300s +00.13700s
|`->config-ssh ran successfully @07.15000s +00.22500s
Finished stage: (init-network) 01.26500 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @19.00800s +00.00100s
|`->config-snap ran successfully @19.00900s +00.00100s
|`->config-snap_config ran successfully @19.01100s +00.00100s
|`->config-ssh-import-id ran successfully @19.01200s +00.00600s
|`->config-locale ran successfully @19.01800s +00.00200s
|`->config-set-passwords ran successfully @19.02000s +00.00200s
|`->config-grub-dpkg ran successfully @19.02200s +00.47200s
|`->config-apt-pipelining ran successfully @19.49800s +00.00100s
|`->config-apt-configure ran successfully @19.50000s +00.21300s
|`->config-ubuntu-advantage ran successfully @19.71400s +00.00200s
|`->config-ntp ran successfully @19.71600s +00.00100s
|`->config-timezone ran successfully @19.72600s +00.00100s
|`->config-disable-ec2-metadata ran successfully @19.72700s +00.00000s
|`->config-runcmd ran successfully @19.72800s +00.00100s
|`->config-byobu ran successfully @19.72900s +00.00100s
Finished stage: (modules-config) 00.78400 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @20.68000s +00.00200s
|`->config-package-update-upgrade-install ran successfully @20.68200s +00.00100s
|`->config-fan ran successfully @20.68300s +00.00100s
|`->config-landscape ran successfully @20.68400s +00.00100s
|`->config-lxd ran successfully @20.68500s +00.00000s
|`->config-ubuntu-drivers ran successfully @20.68600s +00.00000s
|`->config-puppet ran successfully @20.68600s +00.00100s
|`->config-chef ran successfully @20.68700s +00.00100s
|`->config-mcollective ran successfully @20.68800s +00.00100s
|`->config-salt-minion ran successfully @20.68900s +00.00000s
|`->config-rightscale_userdata ran successfully @20.69000s +00.00000s
|`->config-scripts-vendor ran successfully @20.69100s +00.00000s
|`->config-scripts-per-once ran successfully @20.69100s +00.00100s
|`->config-scripts-per-boot ran successfully @20.69200s +00.00000s
|`->config-scripts-per-instance ran successfully @20.69200s +00.00100s
|`->config-scripts-user ran successfully @20.69300s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @20.69400s +00.03500s
|`->config-keys-to-console ran successfully @20.72900s +00.05200s
|`->config-phone-home ran successfully @20.78100s +00.00100s
|`->config-final-message ran successfully @20.78300s +00.00500s
|`->config-power-state-change ran successfully @20.78800s +00.00100s
Finished stage: (modules-final) 00.13800 seconds 

Total Time: 7.62000 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.16600s (init-local/search-OpenStackLocal)
     00.47200s (modules-config/config-grub-dpkg)
     00.45500s (init-network/config-resizefs)
     00.22500s (init-network/config-ssh)
     00.21300s (modules-config/config-apt-configure)
     00.16400s (init-network/config-growpart)
     00.13700s (init-network/config-users-groups)
     00.05200s (modules-final/config-keys-to-console)
     00.03500s (modules-final/config-ssh-authkey-fingerprints)
     00.02700s (init-network/config-mounts)
     00.02400s (init-network/check-cache)
     00.00800s (init-network/config-migrator)
     00.00600s (modules-config/config-ssh-import-id)
     00.00500s (modules-final/config-final-message)
     00.00300s (init-network/activate-datasource)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (modules-config/config-locale)
     00.00200s (init-network/consume-user-data)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/consume-vendor-data)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00000s (modules-final/config-ubuntu-drivers)
     00.00000s (modules-final/config-scripts-vendor)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-salt-minion)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/config-seed_random)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        ens3:
            dhcp4: true
            match:
                macaddress: 00:00:17:02:80:95
            set-name: ens3
setup_proposed.sh                                                                                                                                                                100%  194     2.4KB/s   00:00    
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu1~18.04.1 [404 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu1~18.04.1) over (19.1-1-gbaa47854-0ubuntu1~18.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu1~18.04.1) ...
cloud-init	19.2-36-g059d049c-0ubuntu1~18.04.1
Connection to 158.101.5.222 closed by remote host.
mkstemp: No such file or directory
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
.......
status: done
time: Wed, 25 Sep 2019 19:24:04 +0000
detail:
DataSourceOpenStack [net,ver=2]
oddbloke-sru-20190925-1518
/var/log/cloud-init.log:Traceback (most recent call last):
/var/log/cloud-init.log:Traceback (most recent call last):
Startup finished in 15.451s (kernel) + 17.617s (userspace) = 33.069s
graphical.target reached after 13.660s in userspace
          6.654s cloud-init.service
          3.070s cloud-config.service
          2.121s dev-sda1.device
          1.874s snapd.service
          1.527s cloud-init-local.service
          1.374s keyboard-setup.service
           865ms cloud-final.service
           642ms networkd-dispatcher.service
           541ms lxd-containers.service
           448ms apparmor.service
           414ms netfilter-persistent.service
           333ms accounts-daemon.service
           298ms systemd-timesyncd.service
           291ms grub-common.service
           276ms systemd-udev-trigger.service
           275ms systemd-journald.service
           227ms iscsid.service
           227ms lvm2-monitor.service
           221ms ssh.service
           161ms snapd.seeded.service
           156ms systemd-modules-load.service
           154ms systemd-resolved.service
           142ms rsyslog.service
           131ms systemd-logind.service
           126ms systemd-udevd.service
           112ms apport.service
           109ms kmod-static-nodes.service
           101ms ebtables.service
            93ms ufw.service
            92ms systemd-journal-flush.service
            84ms run-rpc_pipefs.mount
            84ms sys-kernel-debug.mount
            83ms systemd-tmpfiles-setup.service
            65ms systemd-sysctl.service
            61ms dev-mqueue.mount
            59ms iscsi-cleanup.service
            59ms blk-availability.service
            52ms systemd-user-sessions.service
            50ms polkit.service
            50ms systemd-remount-fs.service
            49ms rpcbind.service
            48ms systemd-networkd.service
            46ms dev-hugepages.mount
            45ms systemd-tmpfiles-setup-dev.service
            42ms systemd-update-utmp-runlevel.service
            41ms plymouth-quit.service
            37ms plymouth-quit-wait.service
            35ms user@1001.service
            32ms snapd.socket
            30ms nfs-config.service
            28ms systemd-networkd-wait-online.service
            27ms setvtrgb.service
            25ms snap-core-7396.mount
            24ms dev-loop0.device
            23ms snap-oracle\x2dcloud\x2dagent-4.mount
            21ms plymouth-read-write.service
            19ms dev-loop1.device
            19ms systemd-update-utmp.service
            17ms boot-efi.mount
            16ms console-setup.service
            15ms lxd.socket
            12ms systemd-random-seed.service
            11ms sys-kernel-config.mount
            10ms sys-fs-fuse-connections.mount
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
|`->no local data found from DataSourceOpenStackLocal @00.03900s +00.10300s
Finished stage: (init-local) 00.31700 seconds 

Starting stage: init-network
|`->no cache found @01.01200s +00.00000s
|`->found network data from DataSourceOpenStack @01.03800s +05.10100s
|`->setting up datasource @06.44300s +00.00000s
|`->reading and applying user-data @06.45900s +00.00300s
|`->reading and applying vendor-data @06.46200s +00.00000s
|`->activating datasource @06.48700s +00.00200s
|`->config-migrator ran successfully @06.51100s +00.00000s
|`->config-seed_random ran successfully @06.51200s +00.00000s
|`->config-bootcmd ran successfully @06.51300s +00.00000s
|`->config-write-files ran successfully @06.51300s +00.00100s
|`->config-growpart ran successfully @06.51400s +00.07400s
|`->config-resizefs ran successfully @06.58900s +00.05400s
|`->config-disk_setup ran successfully @06.64400s +00.00100s
|`->config-mounts ran successfully @06.64500s +00.03900s
|`->config-set_hostname ran successfully @06.68500s +00.00100s
|`->config-update_hostname ran successfully @06.68700s +00.00100s
|`->config-update_etc_hosts ran successfully @06.68800s +00.00000s
|`->config-ca-certs ran successfully @06.68800s +00.00100s
|`->config-rsyslog ran successfully @06.68900s +00.00100s
|`->config-users-groups ran successfully @06.69000s +00.03800s
|`->config-ssh ran successfully @06.72800s +00.30100s
Finished stage: (init-network) 06.03500 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @11.40200s +00.00100s
|`->config-snap ran successfully @11.40300s +00.00200s
|`->config-snap_config ran successfully @11.40500s +00.01200s
|`->config-ssh-import-id ran successfully @11.41700s +00.01200s
|`->config-locale ran successfully @11.43000s +00.00100s
|`->config-set-passwords ran successfully @11.43200s +00.00100s
|`->config-grub-dpkg ran successfully @11.43300s +00.57300s
|`->config-apt-pipelining ran successfully @12.00700s +00.00100s
|`->config-apt-configure ran successfully @12.00900s +00.51400s
|`->config-ubuntu-advantage ran successfully @12.52400s +00.00200s
|`->config-ntp ran successfully @12.52700s +00.00100s
|`->config-timezone ran successfully @12.52900s +00.00100s
|`->config-disable-ec2-metadata ran successfully @12.53000s +00.00000s
|`->config-runcmd ran successfully @12.53100s +00.00000s
|`->config-byobu ran successfully @12.53100s +00.00100s
Finished stage: (modules-config) 01.26200 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @13.27400s +00.00200s
|`->config-package-update-upgrade-install ran successfully @13.27600s +00.00100s
|`->config-fan ran successfully @13.27700s +00.00100s
|`->config-landscape ran successfully @13.27800s +00.00000s
|`->config-lxd ran successfully @13.27900s +00.00000s
|`->config-ubuntu-drivers ran successfully @13.28000s +00.00000s
|`->config-puppet ran successfully @13.28000s +00.00100s
|`->config-chef ran successfully @13.28100s +00.00100s
|`->config-mcollective ran successfully @13.28200s +00.00100s
|`->config-salt-minion ran successfully @13.28300s +00.00000s
|`->config-rightscale_userdata ran successfully @13.28400s +00.00000s
|`->config-scripts-vendor ran successfully @13.28400s +00.00100s
|`->config-scripts-per-once ran successfully @13.28500s +00.00100s
|`->config-scripts-per-boot ran successfully @13.28600s +00.00000s
|`->config-scripts-per-instance ran successfully @13.28700s +00.00000s
|`->config-scripts-user ran successfully @13.28700s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @13.28800s +00.04500s
|`->config-keys-to-console ran successfully @13.33400s +00.02400s
|`->config-phone-home ran successfully @13.35900s +00.00200s
|`->config-final-message ran successfully @13.36200s +00.01400s
|`->config-power-state-change ran successfully @13.37600s +00.00200s
Finished stage: (modules-final) 00.13400 seconds 

Total Time: 7.74800 seconds

1 boot records analyzed
-- Boot Record 01 --
     05.10100s (init-network/search-OpenStack)
     00.57300s (modules-config/config-grub-dpkg)
     00.51400s (modules-config/config-apt-configure)
     00.30100s (init-network/config-ssh)
     00.10300s (init-local/search-OpenStackLocal)
     00.07400s (init-network/config-growpart)
     00.05400s (init-network/config-resizefs)
     00.04500s (modules-final/config-ssh-authkey-fingerprints)
     00.03900s (init-network/config-mounts)
     00.03800s (init-network/config-users-groups)
     00.02400s (modules-final/config-keys-to-console)
     00.01400s (modules-final/config-final-message)
     00.01200s (modules-config/config-ssh-import-id)
     00.01200s (modules-config/config-snap_config)
     00.00300s (init-network/consume-user-data)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-final/config-power-state-change)
     00.00200s (modules-final/config-phone-home)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-snap)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-locale)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-set_hostname)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00000s (modules-final/config-ubuntu-drivers)
     00.00000s (modules-final/config-scripts-per-instance)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-salt-minion)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-config/config-runcmd)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-seed_random)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        ens3:
            dhcp4: true
            match:
                macaddress: 00:00:17:02:80:95
            set-name: ens3
cloud-region: openstack-None
Get cloud-id
openstack
Validating whether metadata is being updated per boot LP:1819913
2019-09-25 19:23:51,502 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:23:52,501 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
Connection to 158.101.5.222 closed by remote host.
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
ssh: connect to host 158.101.5.222 port 22: Connection refused
.....
status: done
time: Wed, 25 Sep 2019 19:25:43 +0000
detail:
DataSourceOpenStack [net,ver=2]
After reboot
2019-09-25 19:23:51,502 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:23:52,501 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:25:31,170 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-09-25 19:25:32,233 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
