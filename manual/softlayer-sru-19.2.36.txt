#!/bin/bash
# Softlayer(IBM) manual sru testing



# launched performed with qa-scripts (launch-softlayer)
# repo https://github.com/cloud-init/qa-scripts.git
# launch-softlayer --image=os:bionic -u sethostname.yaml
# launch-softlayer --image=os:xenial -u sethostname.yaml
# then grab vm ips with `sl vs list`



#!/bin/bash
# Manually deploy on Softlayer using slcli client.
# Validate upgrade to proposed version of cloud-init
# Check Tracebacks or error conditions on clean boot
set -x
 
# local values defaults set by sru-create.py
SRU_SERIES=${SRU_SERIES:-"xenial bionic disco"}
LP_USER=${LP_USER:-"%LP_USER%"}

# Provide USE_DEV_PPA=1 if we are SRU queue is still unapproved
# This will use our ppa:cloud-init-dev/proposed
if [ "${USE_DEV_PPA:-0}" -eq "0" ]; then
    PROPOSED_SCRIPT=setup_proposed.sh
else
    PROPOSED_SCRIPT=setup_dev_proposed.sh
fi

cat > sethostname.yaml <<EOF
## template: jinja
#cloud-config
ssh_import_id : [$LP_USER]
hostname: SRU-worked-{{v1.cloud_name}}
EOF

cat > setup_proposed.sh <<EOF
#/bin/bash
mirror=http://archive.ubuntu.com/ubuntu
echo deb \$mirror \$(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init
EOF

cat > setup_dev_proposed.sh <<EOF
#/bin/bash
add-apt-repository ppa:cloud-init-dev/proposed -y
apt-get update -q;
apt-get install -qy cloud-init;
EOF



sshopts=( -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR )

for series in $SRU_SERIES; do
    echo "### BEGIN $series"
    VM_IP=`launch-softlayer --image=os:$series -u sethostname.yaml | awk '/primary ip/{printf "root@%s", $NF}'`
    ssh "${sshopts[@]}" $VM_IP -- dpkg-query --show cloud-init
    ssh "${sshopts[@]}" $VM_IP -- sudo cat /run/cloud-init/result.json
    ssh "${sshopts[@]}" $VM_IP -- grep Trace /var/log/cloud-init.log
    ssh "${sshopts[@]}" $VM_IP -- systemd-analyze
    ssh "${sshopts[@]}" $VM_IP -- systemd-analyze blame
    ssh "${sshopts[@]}" $VM_IP -- cloud-init analyze show
    ssh "${sshopts[@]}" $VM_IP -- cloud-init analyze blame

    scp "${sshopts[@]}" $PROPOSED_SCRIPT $VM_IP:.
    ssh "${sshopts[@]}" $VM_IP -- sudo bash $PROPOSED_SCRIPT 2>&1 | egrep 'cloud-init'
    ssh "${sshopts[@]}" $VM_IP -- dpkg-query --show cloud-init
    ssh "${sshopts[@]}" $VM_IP -- sudo hostname SRU-didnt-work
    ssh "${sshopts[@]}" $VM_IP -- sudo cloud-init clean --logs --reboot

    sleep 60

    ssh "${sshopts[@]}" $VM_IP -- cloud-init status --wait --long
    ssh "${sshopts[@]}" $VM_IP -- grep Trace /var/log/cloud-init\*
    ssh "${sshopts[@]}" $VM_IP -- sudo cat /run/cloud-init/result.json
    ssh "${sshopts[@]}" $VM_IP -- sudo systemd-analyze blame
    ssh "${sshopts[@]}" $VM_IP -- cloud-init analyze show
    ssh "${sshopts[@]}" $VM_IP -- cloud-init analyze blame
    ssh "${sshopts[@]}" $VM_IP -- "cloud-init query --format 'cloud-region: {{cloud_name}}-{{region}}'"
    echo 'Get cloud-id'
    ssh "${sshopts[@]}" $VM_IP -- cloud-id
    ssh "${sshopts[@]}" $VM_IP -- "cloud-init query --format 'cloud-region: {{cloud_name}}-{{ds.meta_data.imds.compute.location}}'"

    echo 'Validating whether metadata is being updated per boot LP:1819913'
    ssh "${sshopts[@]}" $VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
    ssh "${sshopts[@]}" $VM_IP -- sudo reboot || true
    echo 'After reboot'
    ssh "${sshopts[@]}" $VM_IP -- "grep 'Update datasource' /var/log/cloud-init.log"
    echo "Confirm no traceback after reboot LP: 1823084"
    ssh "${sshopts[@]}" $VM_IP -- "grep 'Trace' /var/log/cloud-init.log"

    echo "### END $series"
done

==== BEGIN SRU Validation ===
+ SRU_SERIES=xenial
+ LP_USER=chad.smith
+ '[' 0 -eq 0 ']'
+ PROPOSED_SCRIPT=setup_proposed.sh
+ cat
+ cat
+ cat
+ sshopts=(-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR)
+ for series in $SRU_SERIES
+ echo '### BEGIN xenial'
### BEGIN xenial
++ launch-softlayer --image=os:xenial -u sethostname.yaml
++ awk '/primary ip/{printf "root@%s", $NF}'
 [is_ready=True status=no-status]
Destroy instance with:
  slcli virtual cancel 89995188
+ VM_IP=root@75.126.147.114
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- dpkg-query --show cloud-init
cloud-init	19.1-1-gbaa47854-0ubuntu1~16.04.1
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo cat /run/cloud-init/result.json
{
 "v1": {
  "datasource": "DataSourceIBMCloud [OS-Code/Live /dev/xvdh]",
  "errors": []
 }
}
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- grep Trace /var/log/cloud-init.log
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- systemd-analyze
Bootup is not yet finished. Please try again later.
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- systemd-analyze blame
Bootup is not yet finished. Please try again later.
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- cloud-init analyze show
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00700s +00.00000s
|`->found local data from DataSourceIBMCloud @00.02800s +00.08000s
Finished stage: (init-local) 00.26900 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceIBMCloud [OS-Code/Live /dev/xvdh] @01.00000s +00.00500s
|`->setting up datasource @01.09100s +00.00000s
|`->reading and applying user-data @01.10000s +00.00900s
|`->reading and applying vendor-data @01.10900s +00.00500s
|`->activating datasource @01.15400s +00.00100s
|`->config-migrator ran successfully @01.18600s +00.00100s
|`->config-seed_random ran successfully @01.18700s +00.00100s
|`->config-bootcmd ran successfully @01.18900s +00.00000s
|`->config-write-files ran successfully @01.18900s +00.00100s
|`->config-growpart ran successfully @01.19100s +00.12300s
|`->config-resizefs ran successfully @01.31400s +00.05400s
|`->config-disk_setup ran successfully @01.37000s +00.00200s
|`->config-mounts ran successfully @01.37200s +00.10000s
|`->config-set_hostname ran successfully @01.47300s +00.00500s
|`->config-update_hostname ran successfully @01.47900s +00.00200s
|`->config-update_etc_hosts ran successfully @01.48100s +00.00100s
|`->config-ca-certs ran successfully @01.48300s +00.00100s
|`->config-rsyslog ran successfully @01.48400s +00.00100s
|`->config-users-groups ran successfully @01.48500s +00.04500s
|`->config-ssh ran successfully @01.53100s +00.33300s
Finished stage: (init-network) 00.88000 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @06.55000s +00.00000s
|`->config-snap ran successfully @06.55000s +00.00100s
|`->config-snap_config ran successfully @06.55200s +00.00100s
|`->config-ssh-import-id ran successfully @06.55300s +00.77500s
|`->config-locale ran successfully @07.32900s +01.57700s
|`->config-set-passwords ran successfully @08.90600s +00.00200s
|`->config-grub-dpkg ran successfully @08.90900s +00.54800s
|`->config-apt-pipelining ran successfully @09.45800s +00.00100s
|`->config-apt-configure ran successfully @09.45900s +00.15400s
|`->config-ubuntu-advantage ran successfully @09.61400s +00.00100s
|`->config-ntp ran successfully @09.61500s +00.00100s
|`->config-timezone ran successfully @09.61700s +00.00000s
|`->config-disable-ec2-metadata ran successfully @09.61800s +00.00000s
|`->config-runcmd ran successfully @09.61800s +00.00100s
|`->config-byobu ran successfully @09.62000s +00.00500s
Finished stage: (modules-config) 03.10300 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @10.14000s +00.00200s
|`->config-package-update-upgrade-install ran successfully @10.14200s +00.00100s
|`->config-fan ran successfully @10.14300s +00.00100s
|`->config-landscape ran successfully @10.14500s +00.00100s
|`->config-lxd ran successfully @10.14600s +00.00100s
|`->config-ubuntu-drivers ran successfully @10.14700s +00.00100s
|`->config-puppet ran successfully @10.14800s +00.00100s
|`->config-chef ran successfully @10.15000s +00.00000s
|`->config-mcollective ran successfully @10.15100s +00.00100s
|`->config-salt-minion ran successfully @10.15200s +00.00100s
|`->config-rightscale_userdata ran successfully @10.15300s +00.00100s
|`->config-scripts-vendor ran successfully @10.15400s +00.02200s
|`->config-scripts-per-once ran successfully @10.17700s +00.00100s
|`->config-scripts-per-boot ran successfully @10.17800s +00.00100s
|`->config-scripts-per-instance ran successfully @10.17900s +00.00100s
|`->config-scripts-user ran successfully @10.18000s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @10.18100s +00.06400s
|`->config-keys-to-console ran successfully @10.24600s +00.12300s
|`->config-phone-home ran successfully @10.37000s +00.00100s
|`->config-final-message ran successfully @10.37100s +00.00600s
|`->config-power-state-change ran successfully @10.37700s +00.00100s
Finished stage: (modules-final) 00.26800 seconds 

Total Time: 4.52000 seconds

1 boot records analyzed
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- cloud-init analyze blame
-- Boot Record 01 --
     01.57700s (modules-config/config-locale)
     00.77500s (modules-config/config-ssh-import-id)
     00.54800s (modules-config/config-grub-dpkg)
     00.33300s (init-network/config-ssh)
     00.15400s (modules-config/config-apt-configure)
     00.12300s (modules-final/config-keys-to-console)
     00.12300s (init-network/config-growpart)
     00.10000s (init-network/config-mounts)
     00.08000s (init-local/search-IBMCloud)
     00.06400s (modules-final/config-ssh-authkey-fingerprints)
     00.05400s (init-network/config-resizefs)
     00.04500s (init-network/config-users-groups)
     00.02200s (modules-final/config-scripts-vendor)
     00.00900s (init-network/consume-user-data)
     00.00600s (modules-final/config-final-message)
     00.00500s (modules-config/config-byobu)
     00.00500s (init-network/consume-vendor-data)
     00.00500s (init-network/config-set_hostname)
     00.00500s (init-network/check-cache)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (init-network/config-update_hostname)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-scripts-per-boot)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-chef)
     00.00000s (modules-config/config-timezone)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-local/check-cache)

1 boot records analyzed
+ scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR setup_proposed.sh root@75.126.147.114:.
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo bash setup_proposed.sh
+ egrep cloud-init
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu1~16.04.1 [408 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu1~16.04.1) over (19.1-1-gbaa47854-0ubuntu1~16.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu1~16.04.1) ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- dpkg-query --show cloud-init
cloud-init	19.2-36-g059d049c-0ubuntu1~16.04.1
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo hostname SRU-didnt-work
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo cloud-init clean --logs --reboot
sudo: unable to resolve host SRU-didnt-work
Connection to 75.126.147.114 closed by remote host.
+ sleep 60
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- cloud-init status --wait --long
ssh: connect to host 75.126.147.114 port 22: Connection timed out
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- grep Trace '/var/log/cloud-init*'
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo cat /run/cloud-init/result.json
{
 "v1": {
  "datasource": "DataSourceIBMCloud [OS-Code/Live /dev/xvdh]",
  "errors": []
 }
}
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo systemd-analyze blame
Bootup is not yet finished. Please try again later.
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- cloud-init analyze show
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00600s +00.00000s
|`->found local data from DataSourceIBMCloud @00.03400s +00.09500s
Finished stage: (init-local) 00.25800 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceIBMCloud [OS-Code/Live /dev/xvdh] @01.00600s +00.00500s
|`->setting up datasource @01.10000s +00.00000s
|`->reading and applying user-data @01.11000s +00.00800s
|`->reading and applying vendor-data @01.11800s +00.00600s
|`->activating datasource @01.16400s +00.00100s
|`->config-migrator ran successfully @01.20600s +00.00100s
|`->config-seed_random ran successfully @01.20700s +00.00200s
|`->config-bootcmd ran successfully @01.20900s +00.00000s
|`->config-write-files ran successfully @01.20900s +00.00100s
|`->config-growpart ran successfully @01.21100s +00.04600s
|`->config-resizefs ran successfully @01.25800s +00.02800s
|`->config-disk_setup ran successfully @01.28600s +00.00200s
|`->config-mounts ran successfully @01.28800s +00.00600s
|`->config-set_hostname ran successfully @01.29500s +00.00500s
|`->config-update_hostname ran successfully @01.30100s +00.00100s
|`->config-update_etc_hosts ran successfully @01.30300s +00.00000s
|`->config-ca-certs ran successfully @01.30400s +00.00100s
|`->config-rsyslog ran successfully @01.30500s +00.00100s
|`->config-users-groups ran successfully @01.30600s +00.03800s
|`->config-ssh ran successfully @01.34400s +00.25800s
Finished stage: (init-network) 00.61200 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @04.23200s +00.00000s
|`->config-snap ran successfully @04.23300s +00.00000s
|`->config-snap_config ran successfully @04.23400s +00.00100s
|`->config-ssh-import-id ran successfully @04.23500s +00.85400s
|`->config-locale ran successfully @05.09000s +00.00200s
|`->config-set-passwords ran successfully @05.09200s +00.00200s
|`->config-grub-dpkg ran successfully @05.09400s +00.53700s
|`->config-apt-pipelining ran successfully @05.63200s +00.00200s
|`->config-apt-configure ran successfully @05.63400s +00.17700s
|`->config-ubuntu-advantage ran successfully @05.81200s +00.00100s
|`->config-ntp ran successfully @05.81400s +00.00000s
|`->config-timezone ran successfully @05.81500s +00.00100s
|`->config-disable-ec2-metadata ran successfully @05.81600s +00.00000s
|`->config-runcmd ran successfully @05.81600s +00.00100s
|`->config-byobu ran successfully @05.81800s +00.00100s
Finished stage: (modules-config) 01.62400 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @06.33900s +00.00200s
|`->config-package-update-upgrade-install ran successfully @06.34200s +00.00000s
|`->config-fan ran successfully @06.34300s +00.00100s
|`->config-landscape ran successfully @06.34400s +00.00100s
|`->config-lxd ran successfully @06.34500s +00.00100s
|`->config-ubuntu-drivers ran successfully @06.34600s +00.00100s
|`->config-puppet ran successfully @06.34700s +00.00100s
|`->config-chef ran successfully @06.34900s +00.00100s
|`->config-mcollective ran successfully @06.35000s +00.00100s
|`->config-salt-minion ran successfully @06.35100s +00.00100s
|`->config-rightscale_userdata ran successfully @06.35200s +00.00100s
|`->config-scripts-vendor ran successfully @06.35300s +00.02200s
|`->config-scripts-per-once ran successfully @06.37600s +00.00100s
|`->config-scripts-per-boot ran successfully @06.37800s +00.00000s
|`->config-scripts-per-instance ran successfully @06.37800s +00.00100s
|`->config-scripts-user ran successfully @06.37900s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @06.38000s +00.08100s
|`->config-keys-to-console ran successfully @06.46100s +00.12200s
|`->config-phone-home ran successfully @06.58400s +00.00100s
|`->config-final-message ran successfully @06.58500s +00.00700s
|`->config-power-state-change ran successfully @06.59300s +00.00100s
Finished stage: (modules-final) 00.28200 seconds 

Total Time: 2.77600 seconds

1 boot records analyzed
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- cloud-init analyze blame
-- Boot Record 01 --
     00.85400s (modules-config/config-ssh-import-id)
     00.53700s (modules-config/config-grub-dpkg)
     00.25800s (init-network/config-ssh)
     00.17700s (modules-config/config-apt-configure)
     00.12200s (modules-final/config-keys-to-console)
     00.09500s (init-local/search-IBMCloud)
     00.08100s (modules-final/config-ssh-authkey-fingerprints)
     00.04600s (init-network/config-growpart)
     00.03800s (init-network/config-users-groups)
     00.02800s (init-network/config-resizefs)
     00.02200s (modules-final/config-scripts-vendor)
     00.00800s (init-network/consume-user-data)
     00.00700s (modules-final/config-final-message)
     00.00600s (init-network/consume-vendor-data)
     00.00600s (init-network/config-mounts)
     00.00500s (init-network/config-set_hostname)
     00.00500s (init-network/check-cache)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (modules-config/config-locale)
     00.00200s (modules-config/config-apt-pipelining)
     00.00200s (init-network/config-seed_random)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-package-update-upgrade-install)
     00.00000s (modules-config/config-snap)
     00.00000s (modules-config/config-ntp)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-local/check-cache)

1 boot records analyzed
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- 'cloud-init query --format '\''cloud-region: {{cloud_name}}-{{region}}'\'''
cloud-region: ibmcloud-None
+ echo 'Get cloud-id'
Get cloud-id
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- cloud-id
ibmcloud
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- 'cloud-init query --format '\''cloud-region: {{cloud_name}}-{{ds.meta_data.imds.compute.location}}'\'''
WARNING: Ignoring jinja template for query commandline: 'dict object' has no attribute 'imds'
+ echo 'Validating whether metadata is being updated per boot LP:1819913'
Validating whether metadata is being updated per boot LP:1819913
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- 'grep '\''Update datasource'\'' /var/log/cloud-init.log'
2019-09-20 09:59:55,020 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- sudo reboot
Connection to 75.126.147.114 closed by remote host.
+ true
+ echo 'After reboot'
After reboot
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- 'grep '\''Update datasource'\'' /var/log/cloud-init.log'
2019-09-20 09:59:55,020 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
+ echo 'Confirm no traceback after reboot LP: 1823084'
Confirm no traceback after reboot LP: 1823084
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.114 -- 'grep '\''Trace'\'' /var/log/cloud-init.log'
+ echo '### END xenial'
### END xenial

+ SRU_SERIES=bionic
+ LP_USER=chad.smith
+ '[' 0 -eq 0 ']'
+ PROPOSED_SCRIPT=setup_proposed.sh
+ cat
+ cat
+ cat
+ sshopts=(-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR)
+ for series in $SRU_SERIES
+ echo '### BEGIN bionic'
### BEGIN bionic
++ launch-softlayer --image=os:bionic -u sethostname.yaml
++ awk '/primary ip/{printf "root@%s", $NF}'
 [is_ready=True status=no-status]
Destroy instance with:
  slcli virtual cancel 89995938
+ VM_IP=root@75.126.147.116
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- dpkg-query --show cloud-init
cloud-init	19.1-1-gbaa47854-0ubuntu1~18.04.1
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo cat /run/cloud-init/result.json
{
 "v1": {
  "datasource": "DataSourceIBMCloud [OS-Code/Live /dev/xvdh]",
  "errors": []
 }
}
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- grep Trace /var/log/cloud-init.log
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- systemd-analyze
Startup finished in 6.176s (kernel) + 21.751s (userspace) = 27.928s
graphical.target reached after 18.284s in userspace
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- systemd-analyze blame
          5.105s dev-xvda2.device
          3.039s cloud-init-local.service
          2.758s keyboard-setup.service
          2.450s cloud-config.service
          2.140s cloud-init.service
          2.076s snapd.seeded.service
          1.839s pollinate.service
          1.632s apparmor.service
          1.522s systemd-networkd-wait-online.service
          1.032s cloud-final.service
          1.032s lxd-containers.service
           987ms xe-daemon.service
           959ms networkd-dispatcher.service
           939ms snapd.service
           460ms accounts-daemon.service
           414ms grub-common.service
           402ms systemd-udev-trigger.service
           387ms apport.service
           377ms systemd-modules-load.service
           370ms lvm2-monitor.service
           272ms systemd-journald.service
           250ms systemd-user-sessions.service
           234ms dev-hugepages.mount
           226ms ufw.service
           225ms lxd.socket
           223ms systemd-udevd.service
           222ms dev-mqueue.mount
           220ms proc-xen.mount
           217ms sys-kernel-debug.mount
           205ms systemd-logind.service
           189ms snapd.socket
           187ms ebtables.service
           180ms polkit.service
           171ms systemd-journal-flush.service
           163ms systemd-timesyncd.service
           162ms systemd-remount-fs.service
           130ms kmod-static-nodes.service
           124ms systemd-networkd.service
           111ms systemd-sysctl.service
           109ms systemd-tmpfiles-setup-dev.service
           105ms rsyslog.service
            97ms ssh.service
            72ms systemd-resolved.service
            72ms systemd-random-seed.service
            72ms systemd-tmpfiles-setup.service
            71ms console-setup.service
            71ms sys-kernel-config.mount
            70ms plymouth-read-write.service
            69ms systemd-machine-id-commit.service
            68ms blk-availability.service
            62ms sys-fs-fuse-connections.mount
            45ms setvtrgb.service
            44ms user@0.service
            41ms plymouth-quit.service
            38ms systemd-update-utmp.service
            21ms systemd-update-utmp-runlevel.service
            17ms boot.mount
            13ms plymouth-quit-wait.service
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-init analyze show
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.01400s +00.00100s
|`->found local data from DataSourceIBMCloud @00.05000s +00.09000s
Finished stage: (init-local) 00.51300 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceIBMCloud [OS-Code/Live /dev/xvdh] @02.85000s +00.01800s
|`->setting up datasource @02.94700s +00.00000s
|`->reading and applying user-data @02.95600s +00.00900s
|`->reading and applying vendor-data @02.96500s +00.00500s
|`->activating datasource @03.01900s +00.00100s
|`->config-migrator ran successfully @03.11000s +00.00000s
|`->config-seed_random ran successfully @03.11100s +00.00900s
|`->config-bootcmd ran successfully @03.12100s +00.00000s
|`->config-write-files ran successfully @03.12100s +00.00100s
|`->config-growpart ran successfully @03.12200s +00.19000s
|`->config-resizefs ran successfully @03.31300s +00.10000s
|`->config-disk_setup ran successfully @03.41400s +00.00500s
|`->config-mounts ran successfully @03.41900s +00.21100s
|`->config-set_hostname ran successfully @03.63000s +00.00700s
|`->config-update_hostname ran successfully @03.63800s +00.00100s
|`->config-update_etc_hosts ran successfully @03.64000s +00.00100s
|`->config-ca-certs ran successfully @03.64100s +00.00100s
|`->config-rsyslog ran successfully @03.64200s +00.00100s
|`->config-users-groups ran successfully @03.64400s +00.22800s
|`->config-ssh ran successfully @03.87300s +00.45300s
Finished stage: (init-network) 01.49400 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @08.65300s +00.00000s
|`->config-snap ran successfully @08.65300s +00.00100s
|`->config-snap_config ran successfully @08.65400s +00.00100s
|`->config-ssh-import-id ran successfully @08.65600s +00.91400s
|`->config-locale ran successfully @09.57100s +00.00200s
|`->config-set-passwords ran successfully @09.57300s +00.00200s
|`->config-grub-dpkg ran successfully @09.57600s +00.54500s
|`->config-apt-pipelining ran successfully @10.12200s +00.00100s
|`->config-apt-configure ran successfully @10.12300s +00.24900s
|`->config-ubuntu-advantage ran successfully @10.37200s +00.00200s
|`->config-ntp ran successfully @10.37400s +00.00100s
|`->config-timezone ran successfully @10.37900s +00.00000s
|`->config-disable-ec2-metadata ran successfully @10.38000s +00.00000s
|`->config-runcmd ran successfully @10.38000s +00.00100s
|`->config-byobu ran successfully @10.38100s +00.00100s
Finished stage: (modules-config) 01.76400 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @11.11900s +00.00200s
|`->config-package-update-upgrade-install ran successfully @11.12100s +00.00100s
|`->config-fan ran successfully @11.12200s +00.00100s
|`->config-landscape ran successfully @11.12400s +00.00000s
|`->config-lxd ran successfully @11.12500s +00.00000s
|`->config-ubuntu-drivers ran successfully @11.12600s +00.00000s
|`->config-puppet ran successfully @11.12700s +00.00100s
|`->config-chef ran successfully @11.12800s +00.00100s
|`->config-mcollective ran successfully @11.12900s +00.00100s
|`->config-salt-minion ran successfully @11.13000s +00.00100s
|`->config-rightscale_userdata ran successfully @11.13100s +00.00100s
|`->config-scripts-vendor ran successfully @11.13200s +00.03000s
|`->config-scripts-per-once ran successfully @11.16200s +00.00200s
|`->config-scripts-per-boot ran successfully @11.16400s +00.00000s
|`->config-scripts-per-instance ran successfully @11.16400s +00.00100s
|`->config-scripts-user ran successfully @11.16500s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @11.16700s +00.06300s
|`->config-keys-to-console ran successfully @11.23000s +00.12800s
|`->config-phone-home ran successfully @11.35900s +00.00100s
|`->config-final-message ran successfully @11.36000s +00.01100s
|`->config-power-state-change ran successfully @11.37500s +00.00100s
Finished stage: (modules-final) 00.29100 seconds 

Total Time: 4.06200 seconds

1 boot records analyzed
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-init analyze blame
-- Boot Record 01 --
     00.91400s (modules-config/config-ssh-import-id)
     00.54500s (modules-config/config-grub-dpkg)
     00.45300s (init-network/config-ssh)
     00.24900s (modules-config/config-apt-configure)
     00.22800s (init-network/config-users-groups)
     00.21100s (init-network/config-mounts)
     00.19000s (init-network/config-growpart)
     00.12800s (modules-final/config-keys-to-console)
     00.10000s (init-network/config-resizefs)
     00.09000s (init-local/search-IBMCloud)
     00.06300s (modules-final/config-ssh-authkey-fingerprints)
     00.03000s (modules-final/config-scripts-vendor)
     00.01800s (init-network/check-cache)
     00.01100s (modules-final/config-final-message)
     00.00900s (init-network/consume-user-data)
     00.00900s (init-network/config-seed_random)
     00.00700s (init-network/config-set_hostname)
     00.00500s (init-network/consume-vendor-data)
     00.00500s (init-network/config-disk_setup)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-final/config-scripts-per-once)
     00.00200s (modules-config/config-ubuntu-advantage)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (modules-config/config-locale)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-ubuntu-drivers)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-config/config-timezone)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)

1 boot records analyzed
+ scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR setup_proposed.sh root@75.126.147.116:.
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo bash setup_proposed.sh
+ egrep cloud-init
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu1~18.04.1 [404 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu1~18.04.1) over (19.1-1-gbaa47854-0ubuntu1~18.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu1~18.04.1) ...
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- dpkg-query --show cloud-init
cloud-init	19.2-36-g059d049c-0ubuntu1~18.04.1
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo hostname SRU-didnt-work
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo cloud-init clean --logs --reboot
Connection to 75.126.147.116 closed by remote host.
+ sleep 60
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-init status --wait --long

status: done
time: Fri, 20 Sep 2019 10:12:23 +0000
detail:
DataSourceIBMCloud [OS-Code/Live /dev/xvdh]
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- grep Trace '/var/log/cloud-init*'
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo cat /run/cloud-init/result.json
{
 "v1": {
  "datasource": "DataSourceIBMCloud [OS-Code/Live /dev/xvdh]",
  "errors": []
 }
}
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo systemd-analyze blame
          4.950s dev-xvda2.device
          2.677s keyboard-setup.service
          2.665s cloud-config.service
          1.908s cloud-init-local.service
          1.606s cloud-init.service
          1.401s systemd-networkd-wait-online.service
           926ms cloud-final.service
           918ms networkd-dispatcher.service
           609ms xe-daemon.service
           590ms systemd-udev-trigger.service
           553ms lxd-containers.service
           538ms snapd.service
           449ms apparmor.service
           418ms systemd-journal-flush.service
           359ms systemd-modules-load.service
           349ms accounts-daemon.service
           333ms systemd-logind.service
           291ms apport.service
           287ms ssh.service
           286ms grub-common.service
           284ms systemd-journald.service
           252ms lvm2-monitor.service
           250ms lxd.socket
           231ms rsyslog.service
           181ms systemd-remount-fs.service
           172ms systemd-timesyncd.service
           162ms proc-xen.mount
           161ms ebtables.service
           161ms dev-mqueue.mount
           153ms snapd.socket
           153ms dev-hugepages.mount
           145ms sys-kernel-debug.mount
           140ms systemd-user-sessions.service
           139ms systemd-udevd.service
           116ms kmod-static-nodes.service
           113ms polkit.service
           113ms ufw.service
            91ms systemd-networkd.service
            86ms systemd-tmpfiles-setup.service
            81ms systemd-tmpfiles-setup-dev.service
            78ms snapd.seeded.service
            66ms systemd-resolved.service
            65ms systemd-sysctl.service
            57ms sys-kernel-config.mount
            53ms sys-fs-fuse-connections.mount
            53ms plymouth-read-write.service
            48ms console-setup.service
            44ms user@0.service
            42ms setvtrgb.service
            41ms blk-availability.service
            35ms systemd-update-utmp.service
            31ms systemd-random-seed.service
            26ms plymouth-quit-wait.service
            25ms plymouth-quit.service
            20ms systemd-update-utmp-runlevel.service
            18ms dev-disk-by\x2dlabel-SWAP\x2dxvdb1.swap
            18ms boot.mount
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-init analyze show
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00100s
|`->found local data from DataSourceIBMCloud @00.03400s +00.07100s
Finished stage: (init-local) 00.39400 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceIBMCloud [OS-Code/Live /dev/xvdh] @02.55100s +00.01700s
|`->setting up datasource @02.64600s +00.00000s
|`->reading and applying user-data @02.65600s +00.00900s
|`->reading and applying vendor-data @02.66500s +00.00400s
|`->activating datasource @02.71000s +00.00100s
|`->config-migrator ran successfully @02.78000s +00.00000s
|`->config-seed_random ran successfully @02.78000s +00.00200s
|`->config-bootcmd ran successfully @02.78200s +00.00000s
|`->config-write-files ran successfully @02.78300s +00.00000s
|`->config-growpart ran successfully @02.78400s +00.13100s
|`->config-resizefs ran successfully @02.91600s +00.09000s
|`->config-disk_setup ran successfully @03.00700s +00.00100s
|`->config-mounts ran successfully @03.00800s +00.01700s
|`->config-set_hostname ran successfully @03.02500s +00.01000s
|`->config-update_hostname ran successfully @03.03500s +00.00200s
|`->config-update_etc_hosts ran successfully @03.03700s +00.00700s
|`->config-ca-certs ran successfully @03.04500s +00.00100s
|`->config-rsyslog ran successfully @03.04600s +00.00100s
|`->config-users-groups ran successfully @03.04700s +00.05900s
|`->config-ssh ran successfully @03.10700s +00.39800s
Finished stage: (init-network) 00.97300 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @05.96300s +00.00000s
|`->config-snap ran successfully @05.96400s +00.00100s
|`->config-snap_config ran successfully @05.96500s +00.00100s
|`->config-ssh-import-id ran successfully @05.96600s +00.84900s
|`->config-locale ran successfully @06.81600s +00.00200s
|`->config-set-passwords ran successfully @06.81800s +00.00200s
|`->config-grub-dpkg ran successfully @06.82000s +00.42100s
|`->config-apt-pipelining ran successfully @07.24200s +00.00100s
|`->config-apt-configure ran successfully @07.24300s +00.23500s
|`->config-ubuntu-advantage ran successfully @07.47900s +00.00100s
|`->config-ntp ran successfully @07.48000s +00.00100s
|`->config-timezone ran successfully @07.48100s +00.00100s
|`->config-disable-ec2-metadata ran successfully @07.48200s +00.00100s
|`->config-runcmd ran successfully @07.48300s +00.00100s
|`->config-byobu ran successfully @07.48400s +00.00100s
Finished stage: (modules-config) 01.56000 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @08.17200s +00.00200s
|`->config-package-update-upgrade-install ran successfully @08.17400s +00.00100s
|`->config-fan ran successfully @08.17500s +00.00100s
|`->config-landscape ran successfully @08.17700s +00.00000s
|`->config-lxd ran successfully @08.17800s +00.00000s
|`->config-ubuntu-drivers ran successfully @08.17900s +00.00100s
|`->config-puppet ran successfully @08.18000s +00.00100s
|`->config-chef ran successfully @08.18100s +00.00100s
|`->config-mcollective ran successfully @08.18200s +00.00100s
|`->config-salt-minion ran successfully @08.18300s +00.00100s
|`->config-rightscale_userdata ran successfully @08.18400s +00.00100s
|`->config-scripts-vendor ran successfully @08.18500s +00.01700s
|`->config-scripts-per-once ran successfully @08.20300s +00.00100s
|`->config-scripts-per-boot ran successfully @08.20400s +00.00000s
|`->config-scripts-per-instance ran successfully @08.20400s +00.00100s
|`->config-scripts-user ran successfully @08.20600s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @08.20700s +00.06300s
|`->config-keys-to-console ran successfully @08.27100s +00.12700s
|`->config-phone-home ran successfully @08.39900s +00.00100s
|`->config-final-message ran successfully @08.40000s +00.00600s
|`->config-power-state-change ran successfully @08.40700s +00.00100s
Finished stage: (modules-final) 00.27200 seconds 

Total Time: 3.19900 seconds

1 boot records analyzed
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-init analyze blame
-- Boot Record 01 --
     00.84900s (modules-config/config-ssh-import-id)
     00.42100s (modules-config/config-grub-dpkg)
     00.39800s (init-network/config-ssh)
     00.23500s (modules-config/config-apt-configure)
     00.13100s (init-network/config-growpart)
     00.12700s (modules-final/config-keys-to-console)
     00.09000s (init-network/config-resizefs)
     00.07100s (init-local/search-IBMCloud)
     00.06300s (modules-final/config-ssh-authkey-fingerprints)
     00.05900s (init-network/config-users-groups)
     00.01700s (modules-final/config-scripts-vendor)
     00.01700s (init-network/config-mounts)
     00.01700s (init-network/check-cache)
     00.01000s (init-network/config-set_hostname)
     00.00900s (init-network/consume-user-data)
     00.00700s (init-network/config-update_etc_hosts)
     00.00600s (modules-final/config-final-message)
     00.00400s (init-network/consume-vendor-data)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-set-passwords)
     00.00200s (modules-config/config-locale)
     00.00200s (init-network/config-update_hostname)
     00.00200s (init-network/config-seed_random)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-disable-ec2-metadata)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-scripts-user)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/config-write-files)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)

1 boot records analyzed
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- 'cloud-init query --format '\''cloud-region: {{cloud_name}}-{{region}}'\'''
cloud-region: ibmcloud-None
+ echo 'Get cloud-id'
Get cloud-id
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-id
ibmcloud
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- 'cloud-init query --format '\''cloud-region: {{cloud_name}}-{{ds.meta_data.imds.compute.location}}'\'''
WARNING: Ignoring jinja template for query commandline: 'dict object' has no attribute 'imds'
+ echo 'Validating whether metadata is being updated per boot LP:1819913. Expect last log to contain System Boot'
Validating whether metadata is being updated per boot LP:1819913. Expect last log to contain System Boot
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- sudo reboot
Connection to 75.126.147.116 closed by remote host.
+ true
+ echo 'After reboot'
After reboot
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- cloud-init status --wait --long

status: done
time: Fri, 20 Sep 2019 10:13:50 +0000
detail:
DataSourceIBMCloud [OS-Code/Live /dev/xvdh]
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- 'grep '\''Update datasource'\'' /var/log/cloud-init.log'
2019-09-20 10:12:15,120 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
+ echo 'Confirm no traceback after reboot LP: 1823084'
Confirm no traceback after reboot LP: 1823084
+ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR root@75.126.147.116 -- 'grep '\''Trace'\'' /var/log/cloud-init.log'
+ echo '### END bionic'
### END bionic

==== END SRU Validation ===
