http://pad.lv/1607345
https://bugs.launchpad.net/ubuntu/+source/cloud-init/+bug/1607345

=== Begin SRU Template ===
[Impact]
ubuntu-bug cloud-init now collects cloud-init-related information for a bug-report

[Test Case]

# Launch instance under test
$ for release in xenial zesty;
  do
    ref=$release-proposed;
    lxc-proposed-snapshot --proposed --publish $release $ref;
    lxc launch $ref $name;
    sleep 10;
    lxc exec $name ubuntu-bug cloud-init  # And follow the prompts to report a bogus bug
  done

[Regression Potential]
Worst case scenario is the apport wrapper doesn't work and the developer has to file a bug manually instead.

[Other Info]
Upstream commit at
  https://git.launchpad.net/cloud-init/commit/?id=ca2730e2ac86b05f7e6

=== End SRU Template ===


=== SRU Verification output ===
--- xenial 
root@test-xenial:~# ubuntu-bug cloud-init

*** Collecting problem information

The collected information can be sent to the developers to improve the
application. This might take a few minutes.
.............
*** Your device details (lshw) may be useful to developers when addressing this bug, but gathering it requires admin privileges. Would you like to include this info?


What would you like to do? Your options are:
  Y: Yes
  N: No
  C: Cancel
Please choose (Y/N/C): y
                          
*** Is this machine running in a cloud environment?


What would you like to do? Your options are:
  Y: Yes
  N: No
  C: Cancel
Please choose (Y/N/C): y

*** Please select the cloud vendor or environment in which this instance is running


Choices:
  1: Amazon - Ec2
  2: AliYun
  3: AltCloud
  4: Azure
  5: Bigstep
  6: CloudSigma
  7: CloudStack
  8: DigitalOcean
  9: GCE - Google Compute Engine
  10: MAAS
  11: NoCloud
  12: OpenNebula
  13: OpenStack
  14: OVF
  15: Scaleway
  16: SmartOS
  17: VMware
  18: Other
  C: Cancel
Please choose (1/2/3/4/5/6/7/8/9/10/11/12/13/14/15/16/17/18/C): 6
.
*** Your user-data or cloud-config file can optionally be provided from /var/lib/cloud/instance/user-data.txt and could be useful to developers when addressing this bug. Do you wish to attach user-data to this bug?


What would you like to do? Your options are:
  Y: Yes
  N: No
  C: Cancel
Please choose (Y/N/C): y
..

*** Send problem report to the developers?

After the problem report has been sent, please fill out the form in the
automatically opened web browser.

What would you like to do? Your options are:
  S: Send report (85.6 KB)
  V: View report
  K: Keep report file for sending later or copying to somewhere else
  I: Cancel and ignore future crashes of this program version
  C: Cancel
Please choose (S/V/K/I/C): v

What would you like to do? Your options are:
  S: Send report (85.6 KB)
  V: View report
  K: Keep report file for sending later or copying to somewhere else
  I: Cancel and ignore future crashes of this program version
  C: Cancel
Please choose (S/V/K/I/C): k
Problem report file: /tmp/apport.cloud-init.7_ilbqj5.apport


root@test-xenial:~# egrep 'user_data|Cloud|lshw' /tmp/apport.cloud-init.7_ilbqj5.apport
CloudName: CloudSigma
 Cloud-init v. 17.1 running 'init-local' at Mon, 16 Oct 2017 20:21:45 +0000. Up 0.00 seconds.
 Cloud-init v. 17.1 running 'init' at Mon, 16 Oct 2017 20:21:49 +0000. Up 4.00 seconds.
 Cloud-init v. 17.1 running 'modules:config' at Mon, 16 Oct 2017 20:21:50 +0000. Up 5.00 seconds.
 Cloud-init v. 17.1 running 'modules:final' at Mon, 16 Oct 2017 20:21:51 +0000. Up 6.00 seconds.
 Cloud-init v. 17.1 finished at Mon, 16 Oct 2017 20:22:26 +0000. Datasource DataSourceNoCloud [seed=/var/lib/cloud/seed/nocloud-net][dsmode=net].  Up 41.00 seconds
lshw.txt:
user_data.txt:

---zesty
root@test-zesty:~# ubuntu-bug cloud-init

*** Collecting problem information

The collected information can be sent to the developers to improve the
application. This might take a few minutes.
............
*** Your device details (lshw) may be useful to developers when addressing this bug, but gathering it requires admin privileges. Would you like to include this info?


What would you like to do? Your options are:
  Y: Yes
  N: No
  C: Cancel
Please choose (Y/N/C): y
                            
*** Is this machine running in a cloud environment?


What would you like to do? Your options are:
  Y: Yes
  N: No
  C: Cancel
Please choose (Y/N/C): y

*** Please select the cloud vendor or environment in which this instance is running


Choices:
  1: Amazon - Ec2
  2: AliYun
  3: AltCloud
  4: Azure
  5: Bigstep
  6: CloudSigma
  7: CloudStack
  8: DigitalOcean
  9: GCE - Google Compute Engine
  10: MAAS
  11: NoCloud
  12: OpenNebula
  13: OpenStack
  14: OVF
  15: Scaleway
  16: SmartOS
  17: VMware
  18: Other
  C: Cancel
Please choose (1/2/3/4/5/6/7/8/9/10/11/12/13/14/15/16/17/18/C): 5

*** Your user-data or cloud-config file can optionally be provided from /var/lib/cloud/instance/user-data.txt and could be useful to developers when addressing this bug. Do you wish to attach user-data to this bug?


What would you like to do? Your options are:
  Y: Yes
  N: No
  C: Cancel
Please choose (Y/N/C): y
..

*** Send problem report to the developers?

After the problem report has been sent, please fill out the form in the
automatically opened web browser.

What would you like to do? Your options are:
  S: Send report (102.7 KB)
  V: View report
  K: Keep report file for sending later or copying to somewhere else
  I: Cancel and ignore future crashes of this program version
  C: Cancel
Please choose (S/V/K/I/C): k
Problem report file: /tmp/apport.cloud-init.c2rk91_3.apport
root@test-zesty:~# egrep 'user_data|cloud|lshw' /tmp/apport.cloud-init.c2rk91_3.apport 
 cloud-guest-utils 0.30-0ubuntu2
 Oct 16 20:25:24 hostname systemd[1]: cloud-init-local.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:24 hostname systemd[1]: cloud-init-local.service: Failed to set invocation ID on control group /system.slice/cloud-init-local.service, ignoring: Operation not permitted
 Oct 16 20:25:24 hostname systemd[1]: cloud-init-local.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:24 hostname systemd[1]: cloud-init-local.service: Failed to set invocation ID on control group /system.slice/cloud-init-local.service, ignoring: Operation not permitted
 Oct 16 20:25:28 hostname systemd[1]: cloud-init.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:28 hostname systemd[1]: cloud-init.service: Failed to set invocation ID on control group /system.slice/cloud-init.service, ignoring: Operation not permitted
 Oct 16 20:25:28 hostname systemd[1]: cloud-init-local.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:28 hostname systemd[1]: cloud-init-local.service: Failed to set invocation ID on control group /system.slice/cloud-init-local.service, ignoring: Operation not permitted
 Oct 16 20:25:29 hostname systemd[1]: cloud-config.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:29 hostname systemd[1]: cloud-config.service: Failed to set invocation ID on control group /system.slice/cloud-config.service, ignoring: Operation not permitted
 Oct 16 20:25:31 hostname systemd[1]: cloud-final.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:31 hostname systemd[1]: cloud-final.service: Failed to set invocation ID on control group /system.slice/cloud-final.service, ignoring: Operation not permitted
 Oct 16 20:25:31 hostname systemd[1]: cloud-config.service: Failed to reset devices.list: Operation not permitted
 Oct 16 20:25:31 hostname systemd[1]: cloud-config.service: Failed to set invocation ID on control group /system.slice/cloud-config.service, ignoring: Operation not permitted
Package: cloud-init 17.1-18-gd4f70470-0ubuntu1~17.04.1


egrep 'user_data|Cloud|lshw' /tmp/apport.cloud-init.c2rk91_3.apport 
CloudName: Bigstep
 Cloud-init v. 17.1 running 'init-local' at Mon, 16 Oct 2017 20:25:24 +0000. Up 0.00 seconds.
 Cloud-init v. 17.1 running 'init' at Mon, 16 Oct 2017 20:25:28 +0000. Up 4.00 seconds.
 Cloud-init v. 17.1 running 'modules:config' at Mon, 16 Oct 2017 20:25:30 +0000. Up 6.00 seconds.
 Cloud-init v. 17.1 running 'modules:final' at Mon, 16 Oct 2017 20:25:31 +0000. Up 7.00 seconds.
 Cloud-init v. 17.1 finished at Mon, 16 Oct 2017 20:26:07 +0000. Datasource DataSourceNoCloud [seed=/var/lib/cloud/seed/nocloud-net][dsmode=net].  Up 43.00 seconds
lshw.txt:
user_data.txt:

=== End SRU Verification output ===
