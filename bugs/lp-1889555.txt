=== Begin SRU Template ===
[Impact]
Older versions of cloud-init could misconfigure grub on nvme devices,
which could prevent instances from booting after a grub upgrade.

[Test Case]
For focal, bionic, and xenial verify the following:
1. on an affected instance, test that installing the new version of cloud-init appropriately updates debconf
2. on an affected instance, modify of the debconf settings and test that installing the new version of cloud-init does not touch those values
3. in a container, confirm that cloud-init does not touch the values
4. in an unaffected instance (i.e. one without an NVMe root), confirm that cloud-init does not touch the values

Steps for test 1:
# Find an old affected image with
aws ec2 describe-images --filters "Name=name,Values=Ubuntu <release number>*"

# Launch an AWS with affected image-id, ssh in

# After startup, connect via SSH, then
# Verify we're on an nvme device
lsblk | grep nvme

# Verify install_devices set incorrectly
debconf-show grub-pc | grep "install_devices:"

# update cloud-init to proposed
mirror=http://archive.ubuntu.com/ubuntu
echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init

# Verify "Reconfiguring grub" message in upgrade output

# Verify install_devices set correctly
debconf-show grub-pc | grep "install_devices:"

# Verify that after reboot we can still connect

Steps for test 2:
# Find an old affected image with
aws ec2 describe-images --filters "Name=name,Values=Ubuntu <release number>*"

# Launch an AWS with affected image-id

# After startup, connect via SSH, then
# Verify we're on an nvme device
lsblk | grep nvme

# Verify install_devices set incorrectly
debconf-show grub-pc | grep "install_devices:"

# Update install device to something (anything) else
echo 'set grub-pc/install_devices /dev/sdb' | debconf-communicate

# update cloud-init to proposed
mirror=http://archive.ubuntu.com/ubuntu
echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init

# Verify no "Reconfiguring grub" message in upgrade output
# Verify install_devices not changed
debconf-show grub-pc | grep "install_devices:"

Steps for test 3:
# lxd launch affected image
lxc launch <image>

# Obtain bash shell
lxc exec <image> bash

# Check install_devices
debconf-show grub-pc | grep "install_devices:"

# Update cloud-init to propsed
mirror=http://archive.ubuntu.com/ubuntu
echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init

# Verify no "Reconfiguring grub" message in upgrade output
# Verify install_devices not changed
debconf-show grub-pc | grep "install_devices:"

Steps for test 4:
# Launch GCE image with:
gcloud compute instances create falcon-test --image <image> --image-project ubuntu-os-cloud --zone=us-central1-a

# After startup, connect via SSH, then
# Verify we're not on an nvme device
lsblk | grep nvme

# Check install_devices
debconf-show grub-pc | grep "install_devices:"

# update cloud-init to proposed

# Verify "Reconfiguring grub" message not in upgrade output

# Verify install_devices set correctly
debconf-show grub-pc | grep "install_devices:"

# Verify that after reboot we can still connect

[Regression Potential]
If a user manually configured their system in such a way that both devices
exist and it matches our error condition, the grub install device
could be reconfigured incorrectly.


[Other Info]
Pull request: https://github.com/canonical/cloud-init/pull/514/files
Upstream commit: https://github.com/canonical/cloud-init/commit/f48acc2bdc41c347d2eb899038e2520383851103

=== End SRU Template ===

=== Verification Log ===
Test #1
# Focal
(cloud-init) newt:cloud-init (croessner-master) $ aws ec2 describe-images --filters "Name=name,Values=Ubuntu 20.04*" | grep ImageId
            "ImageId": "ami-011bc24cdc2e99df7",
(cloud-init) newt:cloud-init (croessner-master) $ aws ec2 run-instances --image-id ami-011bc24cdc2e99df7 --count 1 --instance-type t3a.medium --key-name newt | grep InstanceId
            "InstanceId": "i-08204591562ea8dd1",
(cloud-init) newt:cloud-init (croessner-master) $ aws ec2 describe-instances --instance-ids i-08204591562ea8dd1 | grep PublicIpAddress
                    "PublicIpAddress": "3.14.71.24",
(cloud-init) newt:cloud-init (croessner-master) $ ssh ubuntu@3.14.71.24
# motd message

ubuntu@ip-172-31-46-171:~$ cloud-init --version
/usr/bin/cloud-init 20.1-10-g71af48df-0ubuntu5
ubuntu@ip-172-31-46-171:~$ lsblk | grep nvme
nvme0n1     259:0    0    8G  0 disk
└─nvme0n1p1 259:1    0    8G  0 part /

ubuntu@ip-172-31-46-171:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
  grub-efi/install_devices:
* grub-pc/install_devices: /dev/sda

ubuntu@ip-172-31-46-171:~$ sudo su
root@ip-172-31-46-171:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@ip-172-31-46-171:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu focal-proposed main
root@ip-172-31-46-171:/home/ubuntu# apt-get update -q
Get:1 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal InRelease [265 kB]
Get:2 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:3 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports InRelease [98.3 kB]
Get:4 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/main amd64 Packages [970 kB]
Get:5 http://security.ubuntu.com/ubuntu focal-security InRelease [107 kB]
Get:6 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/main Translation-en [506 kB]
Get:7 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/main amd64 c-n-f Metadata [29.5 kB]
Get:8 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [22.0 kB]
Get:9 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/restricted Translation-en [6212 B]
Get:10 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/restricted amd64 c-n-f Metadata [392 B]
Get:11 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/universe amd64 Packages [8628 kB]
Get:12 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/universe Translation-en [5124 kB]
Get:13 http://archive.ubuntu.com/ubuntu focal-proposed InRelease [265 kB]
Get:14 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/universe amd64 c-n-f Metadata [265 kB]
Get:15 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [144 kB]
Get:16 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/multiverse Translation-en [104 kB]
Get:17 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/multiverse amd64 c-n-f Metadata [9136 B]
Get:18 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [343 kB]
Get:19 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/main Translation-en [131 kB]
Get:20 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/main amd64 c-n-f Metadata [8884 B]
Get:21 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [31.8 kB]
Get:22 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/restricted Translation-en [8340 B]
Get:23 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 c-n-f Metadata [324 B]
Get:24 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [164 kB]
Get:25 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/universe Translation-en [86.7 kB]
Get:26 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/universe amd64 c-n-f Metadata [5404 B]
Get:27 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [11.6 kB]
Get:28 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/multiverse Translation-en [3892 B]
Get:29 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 c-n-f Metadata [480 B]
Get:30 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/main amd64 c-n-f Metadata [112 B]
Get:31 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/restricted amd64 c-n-f Metadata [116 B]
Get:32 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [3092 B]
Get:33 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/universe Translation-en [1448 B]
Get:34 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [224 B]
Get:35 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/multiverse amd64 c-n-f Metadata [116 B]
Get:36 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [174 kB]
Get:37 http://security.ubuntu.com/ubuntu focal-security/main Translation-en [62.8 kB]
Get:38 http://security.ubuntu.com/ubuntu focal-security/main amd64 c-n-f Metadata [4500 B]
Get:39 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [31.7 kB]
Get:40 http://security.ubuntu.com/ubuntu focal-security/restricted Translation-en [8312 B]
Get:41 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 c-n-f Metadata [324 B]
Get:42 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [56.0 kB]
Get:43 http://security.ubuntu.com/ubuntu focal-security/universe Translation-en [29.4 kB]
Get:44 http://security.ubuntu.com/ubuntu focal-security/universe amd64 c-n-f Metadata [2308 B]
Get:45 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [1172 B]
Get:46 http://security.ubuntu.com/ubuntu focal-security/multiverse Translation-en [540 B]
Get:47 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 c-n-f Metadata [116 B]
Get:48 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 Packages [37.8 kB]
Get:49 http://archive.ubuntu.com/ubuntu focal-proposed/main Translation-en [19.6 kB]
Get:50 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 c-n-f Metadata [2128 B]
Fetched 17.9 MB in 3s (6245 kB/s)
Reading package lists...
root@ip-172-31-46-171:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 130 not upgraded.
Need to get 429 kB of archives.
After this operation, 128 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~20.04.1 [429 kB]
Fetched 429 kB in 1s (409 kB/s)
Preconfiguring packages ...
(Reading database ... 59604 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~20.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) over (20.1-10-g71af48df-0ubuntu5) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Reconfiguring grub install device due to mismatch (LP: #1889555)
   grub should use /dev/disk/by-id/nvme-Amazon_Elastic_Block_Store_vol0e030315c300ed9f8 but is configured for /dev/sda
Processing triggers for rsyslog (8.2001.0-1ubuntu1) ...

root@ip-172-31-46-171:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/disk/by-id/nvme-Amazon_Elastic_Block_Store_vol0e030315c300ed9f8
  grub-efi/install_devices:

root@ip-172-31-46-171:/home/ubuntu# reboot
root@ip-172-31-46-171:/home/ubuntu# Connection to 3.14.71.24 closed by remote host.
Connection to 3.14.71.24 closed.
(cloud-init) newt:cloud-init (croessner-master) $ ssh ubuntu@3.14.71.24
Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-1009-aws x86_64)
# motd message

(cloud-init) newt:cloud-init (croessner-master) $ aws ec2 terminate-instances --instance-ids i-08204591562ea8dd1


# Bionic
newt:manual (fix-nvme-grub*) $ aws ec2 describe-images --filters "Name=name,Values=Ubuntu 18.04*" | grep ImageId
            "ImageId": "ami-0c858b55bf9119371",
            "ImageId": "ami-0e7ef7e5358591bc2",
newt:manual (fix-nvme-grub*) $ aws ec2 run-instances --image-id ami-0e7ef7e5358591bc2 --count 1 --instance-type t3a.medium --key-name newt | grep InstanceId
            "InstanceId": "i-032ea99544b1d0649",
newt:manual (fix-nvme-grub*) $ aws ec2 describe-instances --instance-ids i-032ea99544b1d0649 | grep PublicIpAddress
                    "PublicIpAddress": "18.191.217.15",
newt:manual (fix-nvme-grub*) $ ssh ubuntu@18.191.217.15
Warning: Permanently added '18.191.217.15' (ECDSA) to the list of known hosts.
# motd message

ubuntu@ip-172-31-32-175:~$ cloud-init --version
/usr/bin/cloud-init 19.2-24-ge7881d5c-0ubuntu1~18.04.1
ubuntu@ip-172-31-32-175:~$ lsblk | grep nvme
nvme0n1     259:0    0  100G  0 disk
└─nvme0n1p1 259:1    0  100G  0 part /

ubuntu@ip-172-31-32-175:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
* grub-pc/install_devices: /dev/sda

root@ip-172-31-32-175:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@ip-172-31-32-175:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu bionic-proposed main
root@ip-172-31-32-175:/home/ubuntu# apt-get update -q
Hit:1 http://us-east-2.ec2.archive.ubuntu.com/ubuntu bionic InRelease
Hit:2 http://us-east-2.ec2.archive.ubuntu.com/ubuntu bionic-updates InRelease
Hit:3 http://us-east-2.ec2.archive.ubuntu.com/ubuntu bionic-backports InRelease
Hit:4 http://security.ubuntu.com/ubuntu bionic-security InRelease
Get:5 http://archive.ubuntu.com/ubuntu bionic-proposed InRelease [242 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 Packages [54.9 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic-proposed/main Translation-en [22.6 kB]
Fetched 319 kB in 1s (295 kB/s)
Reading package lists...
root@ip-172-31-32-175:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 175 not upgraded.
Need to get 434 kB of archives.
After this operation, 169 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~18.04.1 [434 kB]
Fetched 434 kB in 1s (587 kB/s)
Preconfiguring packages ...
(Reading database ... 85022 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) over (19.2-24-ge7881d5c-0ubuntu1~18.04.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/cloud.cfg.d/README ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Reconfiguring grub install device due to mismatch (LP: #1889555)
   grub should use /dev/disk/by-id/nvme-Amazon_Elastic_Block_Store_vol0bf9aa222758153c4 but is configured for /dev/sda
Processing triggers for rsyslog (8.32.0-1ubuntu4) ...

ubuntu@ip-172-31-32-175:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
* grub-pc/install_devices: /dev/disk/by-id/nvme-Amazon_Elastic_Block_Store_vol0bf9aa222758153c4

ubuntu@ip-172-31-32-175:~$ sudo reboot
Connection to 18.191.217.15 closed by remote host.
Connection to 18.191.217.15 closed.

newt:manual (fix-nvme-grub*) $ ssh ubuntu@18.191.217.15
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 5.3.0-1034-aws x86_64)
# motd message

newt:manual (fix-nvme-grub*) $ aws ec2 terminate-instances --instance-ids i-032ea99544b1d0649


# Xenial
newt:manual (fix-nvme-grub*) $ aws ec2 describe-images --filters "Name=name,Values=Ubuntu 16.04*" | grep ImageId
            "ImageId": "ami-04aff561",
            "ImageId": "ami-05dfb019c35511c71",
            "ImageId": "ami-068e16cc966e5e0cd",
            "ImageId": "ami-0712cbc7157358de8",
            "ImageId": "ami-07e2515382687b9a2",
            "ImageId": "ami-0c336c030d597e1b2",
            "ImageId": "ami-0dbf38440d31be592",
            "ImageId": "ami-0f45f739d17216df0",
            "ImageId": "ami-737e2416",

newt:manual (fix-nvme-grub*) $ aws ec2 run-instances --image-id ami-05dfb019c35511c71 --count 1 --instance-type t3a.medium --key-name newt | grep InstanceId
            "InstanceId": "i-0c95a07efc105817e",
newt:manual (fix-nvme-grub*) $ aws ec2 describe-instances --instance-ids i-0c95a07efc105817e | grep PublicIpAddress
                    "PublicIpAddress": "3.129.9.212",

newt:manual (fix-nvme-grub*) $ ssh ubuntu@3.129.9.212
Warning: Permanently added '3.129.9.212' (ECDSA) to the list of known hosts.
# motd message

ubuntu@ip-172-31-38-188:~$ cloud-init --version
/usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~16.04.1
ubuntu@ip-172-31-38-188:~$ lsblk | grep nvme
nvme0n1     259:0    0    8G  0 disk
└─nvme0n1p1 259:1    0    8G  0 part /
ubuntu@ip-172-31-38-188:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
* grub-pc/install_devices: /dev/sda

root@ip-172-31-38-188:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@ip-172-31-38-188:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu xenial-proposed main
root@ip-172-31-38-188:/home/ubuntu# apt-get update -q
Hit:1 http://us-east-2.ec2.archive.ubuntu.com/ubuntu xenial InRelease
Hit:2 http://us-east-2.ec2.archive.ubuntu.com/ubuntu xenial-updates InRelease
Hit:3 http://us-east-2.ec2.archive.ubuntu.com/ubuntu xenial-backports InRelease
Hit:4 http://security.ubuntu.com/ubuntu xenial-security InRelease
Get:5 http://archive.ubuntu.com/ubuntu xenial-proposed InRelease [260 kB]
Get:6 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 Packages [40.9 kB]
Get:7 http://archive.ubuntu.com/ubuntu xenial-proposed/main Translation-en [18.0 kB]
Fetched 319 kB in 0s (330 kB/s)
Reading package lists...
root@ip-172-31-38-188:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 35 not upgraded.
Need to get 439 kB of archives.
After this operation, 144 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~16.04.1 [439 kB]
Fetched 439 kB in 0s (599 kB/s)
Preconfiguring packages ...
(Reading database ... 76587 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) over (19.4-33-gbb4131a2-0ubuntu1~16.04.1) ...
Processing triggers for ureadahead (0.100.0-19.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
Reconfiguring grub install device due to mismatch (LP: #1889555)
   grub should use /dev/disk/by-id/nvme-Amazon_Elastic_Block_Store_vol06e6484da8d53a004 but is configured for /dev/sda

root@ip-172-31-38-188:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/disk/by-id/nvme-Amazon_Elastic_Block_Store_vol06e6484da8d53a004

root@ip-172-31-38-188:/home/ubuntu# reboot
Connection to 3.129.9.212 closed by remote host.
Connection to 3.129.9.212 closed.

newt:manual (fix-nvme-grub*) $ ssh ubuntu@3.129.9.212
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-1113-aws x86_64)
# motd message

newt:manual (fix-nvme-grub*) $ aws ec2 terminate-instances --instance-ids i-0c95a07efc105817e

Test #2
# Focal

newt:manual (fix-nvme-grub*) $ aws ec2 run-instances --image-id ami-011bc24cdc2e99df7 --count 1 --instance-type t3a.medium --key-name newt | grep InstanceId
            "InstanceId": "i-0d61ab1bb5f8eb2f4",
newt:manual (fix-nvme-grub*) $ aws ec2 describe-instances --instance-ids i-0d61ab1bb5f8eb2f4 | grep PublicIpAddress
                    "PublicIpAddress": "18.216.175.10",
newt:manual (fix-nvme-grub*) $ ssh ubuntu@18.216.175.10
Warning: Permanently added '18.216.175.10' (ECDSA) to the list of known hosts.
# motd message

ubuntu@ip-172-31-39-79:~$ cloud-init --version
/usr/bin/cloud-init 20.1-10-g71af48df-0ubuntu5
ubuntu@ip-172-31-39-79:~$ lsblk | grep nvme
nvme0n1     259:0    0    8G  0 disk
└─nvme0n1p1 259:1    0    8G  0 part /

ubuntu@ip-172-31-39-79:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
  grub-efi/install_devices:
* grub-pc/install_devices: /dev/sda

ubuntu@ip-172-31-39-79:~$ sudo su

root@ip-172-31-39-79:/home/ubuntu# echo 'set grub-pc/install_devices /dev/sdb' | debconf-communicate
0 value set
root@ip-172-31-39-79:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
  grub-efi/install_devices:
* grub-pc/install_devices: /dev/sdb

root@ip-172-31-39-79:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@ip-172-31-39-79:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu focal-proposed main
root@ip-172-31-39-79:/home/ubuntu# apt-get update -q
Get:1 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal InRelease [265 kB]
Get:2 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:3 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports InRelease [98.3 kB]
Get:4 http://security.ubuntu.com/ubuntu focal-security InRelease [107 kB]
Get:5 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/main amd64 Packages [970 kB]
Get:6 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/main Translation-en [506 kB]
Get:7 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/main amd64 c-n-f Metadata [29.5 kB]
Get:8 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/restricted amd64 Packages [22.0 kB]
Get:9 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/restricted Translation-en [6212 B]
Get:10 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/restricted amd64 c-n-f Metadata [392 B]
Get:11 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/universe amd64 Packages [8628 kB]
Get:12 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/universe Translation-en [5124 kB]
Get:13 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/universe amd64 c-n-f Metadata [265 kB]
Get:14 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [144 kB]
Get:15 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/multiverse Translation-en [104 kB]
Get:16 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal/multiverse amd64 c-n-f Metadata [9136 B]
Get:17 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [343 kB]
Get:18 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/main Translation-en [131 kB]
Get:19 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/main amd64 c-n-f Metadata [8884 B]
Get:20 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [31.8 kB]
Get:21 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/restricted Translation-en [8340 B]
Get:22 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 c-n-f Metadata [324 B]
Get:23 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [164 kB]
Get:24 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/universe Translation-en [86.7 kB]
Get:25 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/universe amd64 c-n-f Metadata [5404 B]
Get:26 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [11.6 kB]
Get:27 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/multiverse Translation-en [3892 B]
Get:28 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 c-n-f Metadata [480 B]
Get:29 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/main amd64 c-n-f Metadata [112 B]
Get:30 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/restricted amd64 c-n-f Metadata [116 B]
Get:31 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [3092 B]
Get:32 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/universe Translation-en [1448 B]
Get:33 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [224 B]
Get:34 http://us-east-2.ec2.archive.ubuntu.com/ubuntu focal-backports/multiverse amd64 c-n-f Metadata [116 B]
Get:35 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [174 kB]
Get:36 http://security.ubuntu.com/ubuntu focal-security/main Translation-en [62.8 kB]
Get:37 http://security.ubuntu.com/ubuntu focal-security/main amd64 c-n-f Metadata [4500 B]
Get:38 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [31.7 kB]
Get:39 http://security.ubuntu.com/ubuntu focal-security/restricted Translation-en [8312 B]
Get:40 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 c-n-f Metadata [324 B]
Get:41 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [56.0 kB]
Get:42 http://security.ubuntu.com/ubuntu focal-security/universe Translation-en [29.4 kB]
Get:43 http://security.ubuntu.com/ubuntu focal-security/universe amd64 c-n-f Metadata [2308 B]
Get:44 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [1172 B]
Get:45 http://security.ubuntu.com/ubuntu focal-security/multiverse Translation-en [540 B]
Get:46 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 c-n-f Metadata [116 B]
Get:47 http://archive.ubuntu.com/ubuntu focal-proposed InRelease [265 kB]
Get:48 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 Packages [38.0 kB]
Get:49 http://archive.ubuntu.com/ubuntu focal-proposed/main Translation-en [19.7 kB]
Get:50 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 c-n-f Metadata [2128 B]
Fetched 17.9 MB in 6s (2922 kB/s)
Reading package lists...
root@ip-172-31-39-79:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 131 not upgraded.
Need to get 429 kB of archives.
After this operation, 128 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~20.04.1 [429 kB]
Fetched 429 kB in 1s (444 kB/s)
Preconfiguring packages ...
(Reading database ... 59604 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~20.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) over (20.1-10-g71af48df-0ubuntu5) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Processing triggers for rsyslog (8.2001.0-1ubuntu1) ...

root@ip-172-31-39-79:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sdb
  grub-efi/install_devices:

newt:manual (fix-nvme-grub*) $ aws ec2 terminate-instances --instance-ids i-0d61ab1bb5f8eb2f4

# Bionic
newt:manual (fix-nvme-grub*) $ aws ec2 run-instances --image-id ami-0e7ef7e5358591bc2 --count 1 --instance-type t3a.medium --key-name newt | grep InstanceId
            "InstanceId": "i-0f0c7f3937d6dc4b0",
newt:manual (fix-nvme-grub*) $ aws ec2 describe-instances --instance-ids i-0f0c7f3937d6dc4b0 | grep PublicIpAddress
                    "PublicIpAddress": "3.136.155.237",
newt:manual (fix-nvme-grub*) $ ssh ubuntu@3.136.155.237
ssh: connect to host 3.136.155.237 port 22: Connection refused
newt:manual (fix-nvme-grub*) $ ssh ubuntu@3.136.155.237
Warning: Permanently added '3.136.155.237' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-1050-aws x86_64)
# motd message

ubuntu@ip-172-31-47-155:~$ cloud-init --version
/usr/bin/cloud-init 19.2-24-ge7881d5c-0ubuntu1~18.04.1
ubuntu@ip-172-31-47-155:~$ lsblk | grep nvme
nvme0n1     259:0    0  100G  0 disk
└─nvme0n1p1 259:1    0  100G  0 part /
ubuntu@ip-172-31-47-155:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
* grub-pc/install_devices: /dev/sda
ubuntu@ip-172-31-47-155:~$ sudo su
root@ip-172-31-47-155:/home/ubuntu# echo 'set grub-pc/install_devices /dev/sdb' | debconf-communicate
0 value set
root@ip-172-31-47-155:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sdb

root@ip-172-31-47-155:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@ip-172-31-47-155:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu bionic-proposed main
root@ip-172-31-47-155:/home/ubuntu# apt-get update -q
Hit:1 http://us-east-2.ec2.archive.ubuntu.com/ubuntu bionic InRelease
Hit:2 http://us-east-2.ec2.archive.ubuntu.com/ubuntu bionic-updates InRelease
Hit:3 http://us-east-2.ec2.archive.ubuntu.com/ubuntu bionic-backports InRelease
Hit:4 http://security.ubuntu.com/ubuntu bionic-security InRelease
Get:5 http://archive.ubuntu.com/ubuntu bionic-proposed InRelease [242 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 Packages [54.9 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic-proposed/main Translation-en [22.6 kB]
Fetched 319 kB in 1s (320 kB/s)
Reading package lists...
root@ip-172-31-47-155:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 175 not upgraded.
Need to get 434 kB of archives.
After this operation, 169 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~18.04.1 [434 kB]
Fetched 434 kB in 1s (600 kB/s)
Preconfiguring packages ...
(Reading database ... 85022 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) over (19.2-24-ge7881d5c-0ubuntu1~18.04.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/cloud.cfg.d/README ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Processing triggers for rsyslog (8.32.0-1ubuntu4) ...

root@ip-172-31-47-155:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sdb

newt:manual (fix-nvme-grub*) $ aws ec2 terminate-instances --instance-ids i-0f0c7f3937d6dc4b0

# Xenial
newt:manual (fix-nvme-grub*) $ aws ec2 run-instances --image-id ami-05dfb019c35511c71 --count 1 --instance-type t3a.medium --key-name newt | grep InstanceId
            "InstanceId": "i-08808b6c5be92dca0",
newt:manual (fix-nvme-grub*) $ aws ec2 describe-instances --instance-ids i-08808b6c5be92dca0 | grep PublicIpAddress
                    "PublicIpAddress": "18.188.173.144",
newt:manual (fix-nvme-grub*) $ ssh ubuntu@18.188.173.144
Warning: Permanently added '18.188.173.144' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-1105-aws x86_64)
# motd message

ubuntu@ip-172-31-37-205:~$ cloud-init --version
/usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~16.04.1
ubuntu@ip-172-31-37-205:~$ lsblk | grep nvme
nvme0n1     259:0    0    8G  0 disk
└─nvme0n1p1 259:1    0    8G  0 part /
ubuntu@ip-172-31-37-205:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
* grub-pc/install_devices: /dev/sda
ubuntu@ip-172-31-37-205:~$ echo 'set grub-pc/install_devices /dev/sdb' | debconf-communicate
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
0 value set
debconf: DbDriver "config": could not write /var/cache/debconf/config.dat-new: Permission denied
ubuntu@ip-172-31-37-205:~$ sudo su
root@ip-172-31-37-205:/home/ubuntu# echo 'set grub-pc/install_devices /dev/sdb' | debconf-communicate
0 value set
root@ip-172-31-37-205:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sdb

root@ip-172-31-37-205:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@ip-172-31-37-205:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu xenial-proposed main
root@ip-172-31-37-205:/home/ubuntu# apt-get update -q
Hit:1 http://us-east-2.ec2.archive.ubuntu.com/ubuntu xenial InRelease
Hit:2 http://us-east-2.ec2.archive.ubuntu.com/ubuntu xenial-updates InRelease
Hit:3 http://us-east-2.ec2.archive.ubuntu.com/ubuntu xenial-backports InRelease
Get:4 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB]
Get:5 http://archive.ubuntu.com/ubuntu xenial-proposed InRelease [260 kB]
Get:6 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 Packages [40.9 kB]
Get:7 http://archive.ubuntu.com/ubuntu xenial-proposed/main Translation-en [18.0 kB]
Fetched 429 kB in 0s (465 kB/s)
Reading package lists...
root@ip-172-31-37-205:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 35 not upgraded.
Need to get 439 kB of archives.
After this operation, 144 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~16.04.1 [439 kB]
Fetched 439 kB in 0s (591 kB/s)
Preconfiguring packages ...
(Reading database ... 76587 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) over (19.4-33-gbb4131a2-0ubuntu1~16.04.1) ...
Processing triggers for ureadahead (0.100.0-19.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'

root@ip-172-31-37-205:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sdb

newt:manual (fix-nvme-grub*) $ aws ec2 terminate-instances --instance-ids i-08808b6c5be92dca0


Test #3
# Focal
newt:~ $ lxc launch b2c19309b61b
Creating the instance
Instance name is: informed-goat
Starting informed-goat
newt:~ $ lxc exec informed-goat bash
root@informed-goat:~# cloud-init --version
/usr/bin/cloud-init 20.1-10-g71af48df-0ubuntu5
root@informed-goat:~# sudo su
sudo: setrlimit(RLIMIT_CORE): Operation not permitted
root@informed-goat:~# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda
root@informed-goat:~# mirror=http://archive.ubuntu.com/ubuntu
root@informed-goat:~# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu focal-proposed main
root@informed-goat:~# apt-get update -q
Get:1 http://security.ubuntu.com/ubuntu focal-security InRelease [107 kB]
Hit:2 http://archive.ubuntu.com/ubuntu focal InRelease
Get:3 http://archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:4 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [174 kB]
Get:5 http://security.ubuntu.com/ubuntu focal-security/main Translation-en [62.8 kB]
Get:6 http://security.ubuntu.com/ubuntu focal-security/main amd64 c-n-f Metadata [4504 B]
Get:7 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [31.7 kB]
Get:8 http://security.ubuntu.com/ubuntu focal-security/restricted Translation-en [8312 B]
Get:9 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [56.0 kB]
Get:10 http://security.ubuntu.com/ubuntu focal-security/universe Translation-en [29.4 kB]
Get:11 http://security.ubuntu.com/ubuntu focal-security/universe amd64 c-n-f Metadata [2308 B]
Get:12 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [1172 B]
Get:13 http://security.ubuntu.com/ubuntu focal-security/multiverse Translation-en [540 B]
Get:14 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 c-n-f Metadata [116 B]
Get:15 http://archive.ubuntu.com/ubuntu focal-backports InRelease [98.3 kB]
Get:16 http://archive.ubuntu.com/ubuntu focal-proposed InRelease [265 kB]
Get:17 http://archive.ubuntu.com/ubuntu focal/universe amd64 Packages [8628 kB]
Get:18 http://archive.ubuntu.com/ubuntu focal/universe Translation-en [5124 kB]
Get:19 http://archive.ubuntu.com/ubuntu focal/universe amd64 c-n-f Metadata [265 kB]
Get:20 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [144 kB]
Get:21 http://archive.ubuntu.com/ubuntu focal/multiverse Translation-en [104 kB]
Get:22 http://archive.ubuntu.com/ubuntu focal/multiverse amd64 c-n-f Metadata [9136 B]
Get:23 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [343 kB]
Get:24 http://archive.ubuntu.com/ubuntu focal-updates/main Translation-en [131 kB]
Get:25 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 c-n-f Metadata [8876 B]
Get:26 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [31.8 kB]
Get:27 http://archive.ubuntu.com/ubuntu focal-updates/restricted Translation-en [8340 B]
Get:28 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [164 kB]
Get:29 http://archive.ubuntu.com/ubuntu focal-updates/universe Translation-en [86.7 kB]
Get:30 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 c-n-f Metadata [5404 B]
Get:31 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [11.6 kB]
Get:32 http://archive.ubuntu.com/ubuntu focal-updates/multiverse Translation-en [3892 B]
Get:33 http://archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 c-n-f Metadata [480 B]
Get:34 http://archive.ubuntu.com/ubuntu focal-backports/main amd64 c-n-f Metadata [112 B]
Get:35 http://archive.ubuntu.com/ubuntu focal-backports/restricted amd64 c-n-f Metadata [116 B]
Get:36 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [3092 B]
Get:37 http://archive.ubuntu.com/ubuntu focal-backports/universe Translation-en [1448 B]
Get:38 http://archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [224 B]
Get:39 http://archive.ubuntu.com/ubuntu focal-backports/multiverse amd64 c-n-f Metadata [116 B]
Get:40 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 Packages [55.4 kB]
Get:41 http://archive.ubuntu.com/ubuntu focal-proposed/main Translation-en [25.2 kB]
Get:42 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 c-n-f Metadata [2184 B]
Fetched 16.1 MB in 3s (4947 kB/s)
Reading package lists...
root@informed-goat:~# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  libfreetype6
Use 'sudo apt autoremove' to remove it.
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 97 not upgraded.
Need to get 429 kB of archives.
After this operation, 128 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~20.04.1 [429 kB]
Fetched 429 kB in 1s (562 kB/s)
Preconfiguring packages ...
(Reading database ... 31250 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~20.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) over (20.1-10-g71af48df-0ubuntu5) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Processing triggers for rsyslog (8.2001.0-1ubuntu1) ...
root@informed-goat:~# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda


# Bionic
newt:~ $ lxc exec obliging-hare bash
root@obliging-hare:~# cloud-init --version
/usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~18.04.1
root@obliging-hare:~# sudo su
root@obliging-hare:~# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda
root@obliging-hare:~# mirror=http://archive.ubuntu.com/ubuntu
root@obliging-hare:~# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu bionic-proposed main
root@obliging-hare:~# apt-get update -q
Hit:1 http://archive.ubuntu.com/ubuntu bionic InRelease
Get:2 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:4 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:5 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [832 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic-proposed InRelease [242 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [8570 kB]
Get:8 http://security.ubuntu.com/ubuntu bionic-security/main Translation-en [260 kB]
Get:9 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [82.0 kB]
Get:10 http://security.ubuntu.com/ubuntu bionic-security/restricted Translation-en [17.8 kB]
Get:11 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [697 kB]
Get:12 http://security.ubuntu.com/ubuntu bionic-security/universe Translation-en [231 kB]
Get:13 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [8312 B]
Get:14 http://security.ubuntu.com/ubuntu bionic-security/multiverse Translation-en [2880 B]
Get:15 http://archive.ubuntu.com/ubuntu bionic/universe Translation-en [4941 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [151 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic/multiverse Translation-en [108 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [1055 kB]
Get:19 http://archive.ubuntu.com/ubuntu bionic-updates/main Translation-en [352 kB]
Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [91.2 kB]
Get:21 http://archive.ubuntu.com/ubuntu bionic-updates/restricted Translation-en [19.9 kB]
Get:22 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [1103 kB]
Get:23 http://archive.ubuntu.com/ubuntu bionic-updates/universe Translation-en [343 kB]
Get:24 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [19.4 kB]
Get:25 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse Translation-en [6740 B]
Get:26 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [7516 B]
Get:27 http://archive.ubuntu.com/ubuntu bionic-backports/main Translation-en [4764 B]
Get:28 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [7736 B]
Get:29 http://archive.ubuntu.com/ubuntu bionic-backports/universe Translation-en [4588 B]
Get:30 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 Packages [54.2 kB]
Get:31 http://archive.ubuntu.com/ubuntu bionic-proposed/main Translation-en [21.9 kB]
Fetched 19.5 MB in 4s (5369 kB/s)
Reading package lists...
root@obliging-hare:~# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  libfreetype6
Use 'sudo apt autoremove' to remove it.
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 78 not upgraded.
Need to get 434 kB of archives.
After this operation, 144 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~18.04.1 [434 kB]
Fetched 434 kB in 1s (585 kB/s)
Preconfiguring packages ...
(Reading database ... 28716 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) over (19.4-33-gbb4131a2-0ubuntu1~18.04.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Processing triggers for rsyslog (8.32.0-1ubuntu4) ...
root@obliging-hare:~# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda

# Xenial
newt:~ $ lxc launch ubuntu:cdf3ebcb2fe4
Creating the instance
Instance name is: rational-monster
Starting rational-monster
newt:~ $ lxc exec rational-monster bash
root@rational-monster:~# cloud-init --version
/usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~16.04.1
root@rational-monster:~# sudo su
root@rational-monster:~# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda

root@rational-monster:~# mirror=http://archive.ubuntu.com/ubuntu
root@rational-monster:~# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu xenial-proposed main
root@rational-monster:~# apt-get update -q
Hit:1 http://archive.ubuntu.com/ubuntu xenial InRelease
Get:2 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB]
Get:3 http://archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB]
Get:4 http://archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB]
Get:5 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [922 kB]
Get:6 http://archive.ubuntu.com/ubuntu xenial-proposed InRelease [260 kB]
Get:7 http://archive.ubuntu.com/ubuntu xenial/universe amd64 Packages [7,532 kB]
Get:8 http://security.ubuntu.com/ubuntu xenial-security/main Translation-en [342 kB]
Get:9 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [501 kB]
Get:10 http://security.ubuntu.com/ubuntu xenial-security/universe Translation-en [206 kB]
Get:11 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [6,084 B]
Get:12 http://security.ubuntu.com/ubuntu xenial-security/multiverse Translation-en [2,888 B]
Get:13 http://archive.ubuntu.com/ubuntu xenial/universe Translation-en [4,354 kB]
Get:14 http://archive.ubuntu.com/ubuntu xenial/multiverse amd64 Packages [144 kB]
Get:15 http://archive.ubuntu.com/ubuntu xenial/multiverse Translation-en [106 kB]
Get:16 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [1,194 kB]
Get:17 http://archive.ubuntu.com/ubuntu xenial-updates/main Translation-en [446 kB]
Get:18 http://archive.ubuntu.com/ubuntu xenial-updates/restricted amd64 Packages [7,576 B]
Get:19 http://archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [804 kB]
Get:20 http://archive.ubuntu.com/ubuntu xenial-updates/universe Translation-en [337 kB]
Get:21 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [17.1 kB]
Get:22 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse Translation-en [8,632 B]
Get:23 http://archive.ubuntu.com/ubuntu xenial-backports/main amd64 Packages [7,280 B]
Get:24 http://archive.ubuntu.com/ubuntu xenial-backports/main Translation-en [4,456 B]
Get:25 http://archive.ubuntu.com/ubuntu xenial-backports/universe amd64 Packages [8,316 B]
Get:26 http://archive.ubuntu.com/ubuntu xenial-backports/universe Translation-en [4,476 B]
Get:27 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 Packages [44.3 kB]
Get:28 http://archive.ubuntu.com/ubuntu xenial-proposed/main Translation-en [19.1 kB]
Fetched 17.6 MB in 3s (5,339 kB/s)
Reading package lists...
root@rational-monster:~# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  libfreetype6
Use 'sudo apt autoremove' to remove it.
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 65 not upgraded.
Need to get 439 kB of archives.
After this operation, 144 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~16.04.1 [439 kB]
Fetched 439 kB in 0s (519 kB/s)
Preconfiguring packages ...
(Reading database ... 25784 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) over (19.4-33-gbb4131a2-0ubuntu1~16.04.1) ...
Processing triggers for ureadahead (0.100.0-19.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'

root@rational-monster:~# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda

Test #4
# Focal
newt:~ $ gcloud compute instances create falcon-test --image ubuntu-2004-focal-v20200609 --image-project ubuntu-os-cloud --zone=us-central1-a
Created [https://www.googleapis.com/compute/v1/projects/ubuntu-server-277015/zones/us-central1-a/instances/falcon-test].
WARNING: Some requests generated warnings:
 - The resource 'projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20200609' is deprecated. A suggested replacement is 'projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20200902'.

NAME         ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP    EXTERNAL_IP    STATUS
falcon-test  us-central1-a  n1-standard-1               10.128.15.222  34.123.193.86  RUNNING
newt:~ $ ssh ubuntu@34.123.193.86
Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-1015-gcp x86_64)
# motd message

ubuntu@falcon-test:~$ cloud-init --version
/usr/bin/cloud-init 20.1-10-g71af48df-0ubuntu5
ubuntu@falcon-test:~$ lsblk | grep nvme
ubuntu@falcon-test:~$ lsblk | grep sda
sda       8:0    0    10G  0 disk
├─sda1    8:1    0   9.9G  0 part /
├─sda14   8:14   0     4M  0 part
└─sda15   8:15   0   106M  0 part /boot/efi

ubuntu@falcon-test:~$ debconf-show grub-pc | grep "install_devices:"
debconf: DbDriver "passwords" warning: could not open /var/cache/debconf/passwords.dat: Permission denied
* grub-pc/install_devices: /dev/sda
  grub-efi/install_devices:

ubuntu@falcon-test:~$ sudo su
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@falcon-test:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu focal-proposed main
root@falcon-test:/home/ubuntu# apt-get update -q
Hit:1 http://us-central1.gce.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates InRelease [111 kB]
Get:3 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports InRelease [98.3 kB]
Get:4 http://us-central1.gce.archive.ubuntu.com/ubuntu focal/universe amd64 Packages [8628 kB]
Get:5 http://archive.ubuntu.com/ubuntu focal-proposed InRelease [265 kB]
Get:6 http://archive.canonical.com/ubuntu focal InRelease [12.1 kB]
Get:7 http://security.ubuntu.com/ubuntu focal-security InRelease [107 kB]
Get:8 http://us-central1.gce.archive.ubuntu.com/ubuntu focal/universe Translation-en [5124 kB]
Get:9 http://us-central1.gce.archive.ubuntu.com/ubuntu focal/universe amd64 c-n-f Metadata [265 kB]
Get:10 http://us-central1.gce.archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [144 kB]
Get:11 http://us-central1.gce.archive.ubuntu.com/ubuntu focal/multiverse Translation-en [104 kB]
Get:12 http://us-central1.gce.archive.ubuntu.com/ubuntu focal/multiverse amd64 c-n-f Metadata [9136 B]
Get:13 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [343 kB]
Get:14 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/main Translation-en [131 kB]
Get:15 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/main amd64 c-n-f Metadata [8876 B]
Get:16 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [31.8 kB]
Get:17 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/restricted Translation-en [8340 B]
Get:18 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 c-n-f Metadata [324 B]
Get:19 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [164 kB]
Get:20 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/universe Translation-en [86.7 kB]
Get:21 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/universe amd64 c-n-f Metadata [5404 B]
Get:22 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 Packages [11.6 kB]
Get:23 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/multiverse Translation-en [3892 B]
Get:24 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 c-n-f Metadata [480 B]
Get:25 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports/main amd64 c-n-f Metadata [112 B]
Get:26 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports/restricted amd64 c-n-f Metadata [116 B]
Get:27 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [3092 B]
Get:28 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports/universe Translation-en [1448 B]
Get:29 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [224 B]
Get:30 http://us-central1.gce.archive.ubuntu.com/ubuntu focal-backports/multiverse amd64 c-n-f Metadata [116 B]
Get:31 http://archive.canonical.com/ubuntu focal/partner amd64 Packages [1596 B]
Get:32 http://archive.canonical.com/ubuntu focal/partner Translation-en [804 B]
Get:33 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [174 kB]
Get:34 http://security.ubuntu.com/ubuntu focal-security/main Translation-en [62.8 kB]
Get:35 http://security.ubuntu.com/ubuntu focal-security/main amd64 c-n-f Metadata [4504 B]
Get:36 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [31.7 kB]
Get:37 http://security.ubuntu.com/ubuntu focal-security/restricted Translation-en [8312 B]
Get:38 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 c-n-f Metadata [324 B]
Get:39 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [56.0 kB]
Get:40 http://security.ubuntu.com/ubuntu focal-security/universe Translation-en [29.4 kB]
Get:41 http://security.ubuntu.com/ubuntu focal-security/universe amd64 c-n-f Metadata [2308 B]
Get:42 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 Packages [1172 B]
Get:43 http://security.ubuntu.com/ubuntu focal-security/multiverse Translation-en [540 B]
Get:44 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 Packages [59.0 kB]
Get:45 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 c-n-f Metadata [116 B]
Get:46 http://archive.ubuntu.com/ubuntu focal-proposed/main Translation-en [26.3 kB]
Get:47 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 c-n-f Metadata [2360 B]
Fetched 16.1 MB in 3s (5469 kB/s)
Reading package lists...
root@falcon-test:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  libnuma1
Use 'sudo apt autoremove' to remove it.
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 127 not upgraded.
Need to get 429 kB of archives.
After this operation, 128 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~20.04.1 [429 kB]
Fetched 429 kB in 1s (572 kB/s)
Preconfiguring packages ...
(Reading database ... 62771 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~20.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) over (20.1-10-g71af48df-0ubuntu5) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~20.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Processing triggers for rsyslog (8.2001.0-1ubuntu1) ...
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
  grub-efi/install_devices:
* grub-pc/install_devices: /dev/sda
root@falcon-test:/home/ubuntu# reboot
root@falcon-test:/home/ubuntu# Connection to 34.123.193.86 closed by remote host.
Connection to 34.123.193.86 closed.
newt:~ $ ssh ubuntu@34.123.193.86
Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-1015-gcp x86_64)
# motd message
newt:~ $ gcloud compute instances delete falcon-test

# Bionic
newt:~ $ gcloud compute instances create falcon-test --image ubuntu-1804-bionic-v20200610 --image-project ubuntu-os-cloud --zone=us-central1-a
Created [https://www.googleapis.com/compute/v1/projects/ubuntu-server-277015/zones/us-central1-a/instances/falcon-test].
WARNING: Some requests generated warnings:
 - The resource 'projects/ubuntu-os-cloud/global/images/ubuntu-1804-bionic-v20200610' is deprecated. A suggested replacement is 'projects/ubuntu-os-cloud/global/images/ubuntu-1804-bionic-v20200821a'.

NAME         ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP    EXTERNAL_IP     STATUS
falcon-test  us-central1-a  n1-standard-1               10.128.15.223  35.226.126.217  RUNNING
newt:~ $ ssh ubuntu@35.226.126.217
Warning: Permanently added '35.226.126.217' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 5.3.0-1026-gcp x86_64)
# motd message

ubuntu@falcon-test:~$ cloud-init --version
/usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~18.04.1
ubuntu@falcon-test:~$ lsblk | grep nvme
ubuntu@falcon-test:~$ lsblk | grep sda
sda       8:0    0    10G  0 disk
├─sda1    8:1    0   9.9G  0 part /
├─sda14   8:14   0     4M  0 part
└─sda15   8:15   0   106M  0 part /boot/efi
ubuntu@falcon-test:~$ sudo su
root@falcon-test:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@falcon-test:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu bionic-proposed main
root@falcon-test:/home/ubuntu# apt-get update -q
Hit:1 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic InRelease
Get:2 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:3 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:4 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [8570 kB]
Get:5 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:6 http://archive.canonical.com/ubuntu bionic InRelease [10.2 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic-proposed InRelease [242 kB]
Get:8 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic/universe Translation-en [4941 kB]
Get:9 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [151 kB]
Get:10 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic/multiverse Translation-en [108 kB]
Get:11 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [1055 kB]
Get:12 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/main Translation-en [352 kB]
Get:13 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [91.2 kB]
Get:14 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/restricted Translation-en [19.9 kB]
Get:15 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [1103 kB]
Get:16 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/universe Translation-en [343 kB]
Get:17 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [19.4 kB]
Get:18 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-updates/multiverse Translation-en [6740 B]
Get:19 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [7516 B]
Get:20 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-backports/main Translation-en [4764 B]
Get:21 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [7736 B]
Get:22 http://us-central1.gce.archive.ubuntu.com/ubuntu bionic-backports/universe Translation-en [4588 B]
Get:23 http://archive.canonical.com/ubuntu bionic/partner amd64 Packages [2288 B]
Get:24 http://archive.canonical.com/ubuntu bionic/partner Translation-en [1332 B]
Get:25 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [832 kB]
Get:26 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 Packages [56.8 kB]
Get:27 http://security.ubuntu.com/ubuntu bionic-security/main Translation-en [260 kB]
Get:28 http://archive.ubuntu.com/ubuntu bionic-proposed/main Translation-en [22.6 kB]
Get:29 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [82.0 kB]
Get:30 http://security.ubuntu.com/ubuntu bionic-security/restricted Translation-en [17.8 kB]
Get:31 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [697 kB]
Get:32 http://security.ubuntu.com/ubuntu bionic-security/universe Translation-en [231 kB]
Get:33 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [8312 B]
Get:34 http://security.ubuntu.com/ubuntu bionic-security/multiverse Translation-en [2880 B]
Fetched 19.5 MB in 4s (4911 kB/s)
Reading package lists...
root@falcon-test:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following packages were automatically installed and are no longer required:
  grub-pc-bin libnuma1
Use 'sudo apt autoremove' to remove them.
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 96 not upgraded.
Need to get 434 kB of archives.
After this operation, 144 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~18.04.1 [434 kB]
Fetched 434 kB in 1s (559 kB/s)
Preconfiguring packages ...
(Reading database ... 65436 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) over (19.4-33-gbb4131a2-0ubuntu1~18.04.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~18.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Processing triggers for rsyslog (8.32.0-1ubuntu4) ...
root@falcon-test:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda
root@falcon-test:/home/ubuntu# reboot
Connection to 35.226.126.217 closed by remote host.
Connection to 35.226.126.217 closed.
newt:~ $ ssh ubuntu@35.226.126.217
Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 5.3.0-1026-gcp x86_64)
# motd message
newt:~ $ gcloud compute instances delete falcon-test

# Xenial
newt:~ $ gcloud compute instances create falcon-test --image ubuntu-1604-xenial-v20200611 --image-project ubuntu-os-cloud --zone=us-central1-a
Created [https://www.googleapis.com/compute/v1/projects/ubuntu-server-277015/zones/us-central1-a/instances/falcon-test].
WARNING: Some requests generated warnings:
 - The resource 'projects/ubuntu-os-cloud/global/images/ubuntu-1604-xenial-v20200611' is deprecated. A suggested replacement is 'projects/ubuntu-os-cloud/global/images/ubuntu-1604-xenial-v20200903'.

NAME         ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP    EXTERNAL_IP    STATUS
falcon-test  us-central1-a  n1-standard-1               10.128.15.224  34.123.193.86  RUNNING
newt:~ $ ssh ubuntu@34.123.193.86
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.15.0-1077-gcp x86_64)
# motd message

ubuntu@falcon-test:~$ cloud-init --version
/usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~16.04.1
ubuntu@falcon-test:~$ ls blk | grep nvme
ls: cannot access 'blk': No such file or directory
ubuntu@falcon-test:~$ lsblk | grep nvme
ubuntu@falcon-test:~$ lsblk | grep sda
sda       8:0    0   10G  0 disk
├─sda14   8:14   0    4M  0 part
├─sda15   8:15   0  106M  0 part /boot/efi
└─sda1    8:1    0  9.9G  0 part /
ubuntu@falcon-test:~$ sudo su
root@falcon-test:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu#
root@falcon-test:/home/ubuntu# mirror=http://archive.ubuntu.com/ubuntu
root@falcon-test:/home/ubuntu# echo deb $mirror $(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
deb http://archive.ubuntu.com/ubuntu xenial-proposed main
root@falcon-test:/home/ubuntu# apt-get update -q
Hit:1 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial InRelease
Get:2 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB]
Get:3 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB]
Get:4 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB]
Get:5 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial/universe amd64 Packages [7,532 kB]
Get:6 http://archive.ubuntu.com/ubuntu xenial-proposed InRelease [260 kB]
Get:7 http://archive.canonical.com/ubuntu xenial InRelease [11.5 kB]
Get:8 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial/universe Translation-en [4,354 kB]
Get:9 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial/multiverse amd64 Packages [144 kB]
Get:10 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial/multiverse Translation-en [106 kB]
Get:11 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [1,194 kB]
Get:12 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/main Translation-en [446 kB]
Get:13 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/restricted amd64 Packages [7,576 B]
Get:14 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [804 kB]
Get:15 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/universe Translation-en [337 kB]
Get:16 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [17.1 kB]
Get:17 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-updates/multiverse Translation-en [8,632 B]
Get:18 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-backports/main amd64 Packages [7,280 B]
Get:19 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-backports/main Translation-en [4,456 B]
Get:20 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-backports/universe amd64 Packages [8,316 B]
Get:21 http://us-central1.gce.archive.ubuntu.com/ubuntu xenial-backports/universe Translation-en [4,476 B]
Get:22 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [922 kB]
Get:23 http://security.ubuntu.com/ubuntu xenial-security/main Translation-en [342 kB]
Get:24 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [501 kB]
Get:25 http://security.ubuntu.com/ubuntu xenial-security/universe Translation-en [206 kB]
Get:26 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [6,084 B]
Get:27 http://security.ubuntu.com/ubuntu xenial-security/multiverse Translation-en [2,888 B]
Get:28 http://archive.canonical.com/ubuntu xenial/partner amd64 Packages [3,124 B]
Get:29 http://archive.canonical.com/ubuntu xenial/partner Translation-en [1,672 B]
Get:30 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 Packages [44.3 kB]
Get:31 http://archive.ubuntu.com/ubuntu xenial-proposed/main Translation-en [19.1 kB]
Fetched 17.6 MB in 3s (5,053 kB/s)
Reading package lists...
root@falcon-test:/home/ubuntu# apt-get install -qy cloud-init
Reading package lists...
Building dependency tree...
Reading state information...
The following package was automatically installed and is no longer required:
  grub-pc-bin
Use 'sudo apt autoremove' to remove it.
The following packages will be upgraded:
  cloud-init
1 upgraded, 0 newly installed, 0 to remove and 75 not upgraded.
Need to get 439 kB of archives.
After this operation, 144 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 20.3-2-g371b392c-0ubuntu1~16.04.1 [439 kB]
Fetched 439 kB in 0s (610 kB/s)
Preconfiguring packages ...
(Reading database ... 70872 files and directories currently installed.)
Preparing to unpack .../cloud-init_20.3-2-g371b392c-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) over (19.4-33-gbb4131a2-0ubuntu1~16.04.1) ...
Processing triggers for ureadahead (0.100.0-19.1) ...
Setting up cloud-init (20.3-2-g371b392c-0ubuntu1~16.04.1) ...
Installing new version of config file /etc/cloud/cloud.cfg.d/05_logging.cfg ...
Installing new version of config file /etc/cloud/templates/chef_client.rb.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.freebsd.tmpl ...
Installing new version of config file /etc/cloud/templates/hosts.suse.tmpl ...
Installing new version of config file /etc/cloud/templates/resolv.conf.tmpl ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
root@falcon-test:/home/ubuntu# debconf-show grub-pc | grep "install_devices:"
* grub-pc/install_devices: /dev/sda
root@falcon-test:/home/ubuntu# reboot
Connection to 34.123.193.86 closed by remote host.
Connection to 34.123.193.86 closed.
newt:~ $ ssh ubuntu@34.123.193.86
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.15.0-1077-gcp x86_64)
# motd message
newt:~ $ gcloud compute instances delete falcon-test